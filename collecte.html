<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoVerif QC ‚Äî Contribuer √† l'historique v√©hiculaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        :root {
            --primary: #080e1a;
            --primary-light: #111b2e;
            --accent: #00b4d8;
            --accent-dark: #0096b7;
            --gold: #f4a61c;
            --gold-dark: #d4910a;
            --red: #e63946;
            --green: #2a9d8f;
            --bg: #0b1120;
            --bg-light: #0f1729;
            --card: rgba(255,255,255,0.04);
            --text: #e8ecf2;
            --text-light: #8892a4;
            --border: rgba(255,255,255,0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg); color: var(--text);
            line-height: 1.6; overflow-x: hidden;
        }

        /* NAV */
        nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            background: rgba(15, 43, 70, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0 40px; display: flex; align-items: center;
            justify-content: space-between; height: 64px;
        }
        .nav-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.6rem; font-weight: 700; color: white;
            letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 10px; text-decoration: none;
        }
        .nav-logo .logo-icon { width: 38px; height: 38px; flex-shrink: 0; }
        .nav-logo .nav-auto { color: white; font-weight: 800; letter-spacing: -0.5px; }
        .nav-logo .nav-verif {
            background: linear-gradient(135deg, #00b4d8, #2a9d8f);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        .nav-logo .nav-qc {
            font-size: 0.5rem; font-weight: 800;
            background: linear-gradient(135deg, #f4a61c, #e63946);
            color: white; -webkit-text-fill-color: white;
            padding: 2px 6px; border-radius: 4px;
            margin-left: 5px; vertical-align: middle; letter-spacing: 1px;
        }
        .nav-right { display: flex; gap: 12px; align-items: center; }
        .nav-link {
            color: rgba(255,255,255,0.6); text-decoration: none;
            font-size: 0.85rem; font-weight: 500; padding: 6px 14px;
            border-radius: 8px; transition: all 0.3s;
        }
        .nav-link:hover { color: white; background: rgba(255,255,255,0.08); }
        .nav-link.active { color: var(--accent); background: rgba(0,180,216,0.1); }
        .nav-badge {
            background: var(--gold); color: var(--primary);
            padding: 6px 16px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 700; text-decoration: none;
        }

        /* PARTICLES */
        #particles { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

        /* HERO */
        .hero {
            min-height: 50vh; position: relative; z-index: 1;
            background: linear-gradient(160deg, #060e1a 0%, var(--primary) 40%, #0d2137 100%);
            display: flex; align-items: center; justify-content: center;
            padding: 110px 20px 50px; overflow: hidden; text-align: center;
        }
        .hero::before {
            content: ''; position: absolute; inset: 0;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(0,180,216,0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(244,166,28,0.08) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 80%, rgba(42,157,143,0.06) 0%, transparent 40%);
        }
        .glow-orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.15; pointer-events: none; }
        .glow-orb.blue { width: 400px; height: 400px; background: var(--accent); top: 10%; left: 5%; }
        .glow-orb.gold { width: 300px; height: 300px; background: var(--gold); bottom: 10%; right: 10%; }
        .hero-content { position: relative; z-index: 2; max-width: 700px; }
        .hero .badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(42,157,143,0.12); border: 1px solid rgba(42,157,143,0.25);
            padding: 6px 18px; border-radius: 30px; font-size: 0.8rem;
            color: var(--green); font-weight: 600; margin-bottom: 20px;
        }
        .badge .live-dot {
            width: 7px; height: 7px; border-radius: 50%; background: var(--green);
            animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100%{opacity:1}50%{opacity:.3} }
        .hero h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(1.8rem,4.5vw,2.6rem); font-weight: 900;
            color: white; line-height: 1.15; margin-bottom: 14px; letter-spacing: -1px;
        }
        .hero h1 .grad {
            background: linear-gradient(135deg, var(--accent), var(--gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .hero p { color: rgba(255,255,255,0.5); font-size: 0.95rem; max-width: 520px; margin: 0 auto 28px; }
        .hero-stats {
            display: flex; gap: 32px; justify-content: center; flex-wrap: wrap;
        }
        .hero-stat {
            text-align: center;
        }
        .hero-stat .number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.8rem; font-weight: 800; color: var(--accent);
        }
        .hero-stat .label {
            font-size: 0.72rem; color: var(--text-light); text-transform: uppercase;
            letter-spacing: 1px; font-weight: 600;
        }

        /* WIZARD SECTION */
        .wizard-section {
            position: relative; z-index: 1;
            padding: 0 20px 80px; margin-top: -30px;
        }
        .wizard-container { max-width: 680px; margin: 0 auto; }

        /* GLASS CARD */
        .glass-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px; padding: 36px;
            backdrop-filter: blur(24px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.06);
        }

        /* PROGRESS STEPS */
        .wizard-progress {
            display: flex; align-items: center; justify-content: center;
            gap: 0; margin-bottom: 36px;
        }
        .wp-step {
            display: flex; align-items: center; gap: 0;
        }
        .wp-dot {
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(255,255,255,0.06); border: 2px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; color: rgba(255,255,255,0.3);
            font-weight: 700; transition: all 0.5s; flex-shrink: 0;
        }
        .wp-dot.active {
            background: var(--accent); border-color: var(--accent); color: white;
            box-shadow: 0 0 20px rgba(0,180,216,0.4);
            animation: pulse-dot 1.2s infinite;
        }
        .wp-dot.done {
            background: var(--green); border-color: var(--green); color: white;
        }
        @keyframes pulse-dot {
            0%,100%{box-shadow:0 0 0 0 rgba(0,180,216,0.4)}
            50%{box-shadow:0 0 0 10px rgba(0,180,216,0)}
        }
        .wp-line {
            width: 60px; height: 2px; background: rgba(255,255,255,0.08);
            transition: background 0.5s;
        }
        .wp-line.done { background: var(--green); }
        .wp-label {
            display: block; font-size: 0.65rem; color: rgba(255,255,255,0.3);
            text-align: center; margin-top: 6px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .wp-step.active .wp-label { color: var(--accent); }
        .wp-step.done .wp-label { color: var(--green); }

        /* STEP PANELS */
        .step-panel { display: none; }
        .step-panel.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)} }

        .step-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem; font-weight: 800; color: white;
            margin-bottom: 6px;
        }
        .step-subtitle {
            font-size: 0.85rem; color: var(--text-light); margin-bottom: 28px;
        }

        /* FORM INPUTS */
        .form-group { margin-bottom: 20px; }
        .form-label {
            display: block; color: rgba(255,255,255,0.5); font-size: 0.72rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 8px;
        }
        .form-input {
            width: 100%; padding: 14px 18px;
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem; font-weight: 500;
            outline: none; transition: all 0.4s;
        }
        .form-input:focus {
            border-color: var(--accent);
            background: rgba(0,180,216,0.06);
            box-shadow: 0 0 20px rgba(0,180,216,0.08);
        }
        .form-input::placeholder { color: rgba(255,255,255,0.25); }

        .form-select {
            width: 100%; padding: 14px 18px;
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem; font-weight: 500;
            outline: none; transition: all 0.4s;
            appearance: none; cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='rgba(255,255,255,0.4)' viewBox='0 0 16 16'%3E%3Cpath d='M1.5 5.5l6.5 6.5 6.5-6.5'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }
        .form-select:focus {
            border-color: var(--accent);
            background-color: rgba(0,180,216,0.06);
        }
        .form-select option { background: #111b2e; color: white; }

        .form-textarea {
            width: 100%; padding: 14px 18px;
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem; font-weight: 500;
            outline: none; transition: all 0.4s;
            min-height: 90px; resize: vertical;
        }
        .form-textarea:focus {
            border-color: var(--accent);
            background: rgba(0,180,216,0.06);
        }
        .form-textarea::placeholder { color: rgba(255,255,255,0.25); }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        /* VIN INPUT */
        .vin-input {
            width: 100%; padding: 18px 20px;
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 14px; color: white;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 1.35rem; font-weight: 700;
            letter-spacing: 4px; text-transform: uppercase;
            text-align: center; outline: none; transition: all 0.4s;
        }
        .vin-input::placeholder {
            color: rgba(255,255,255,0.18); letter-spacing: 2px; font-size: 0.95rem;
        }
        .vin-input:focus {
            border-color: var(--accent);
            background: rgba(0,180,216,0.06);
            box-shadow: 0 0 40px rgba(0,180,216,0.12), 0 0 0 4px rgba(0,180,216,0.08);
        }
        .vin-status {
            text-align: center; font-size: 0.82rem; margin-top: 8px;
            font-weight: 600; min-height: 20px;
        }
        .vin-status.loading { color: var(--accent); }
        .vin-status.success { color: var(--green); }
        .vin-status.error { color: var(--red); }

        /* VEHICLE CARD */
        .vehicle-card {
            display: none; margin-top: 20px;
            background: rgba(42,157,143,0.06); border: 1px solid rgba(42,157,143,0.2);
            border-radius: 16px; padding: 20px; animation: fadeIn 0.5s ease;
        }
        .vehicle-card.visible { display: block; }
        .vc-header {
            display: flex; align-items: center; gap: 16px; margin-bottom: 16px;
        }
        .vc-img {
            width: 140px; height: 90px; border-radius: 10px; object-fit: cover;
            background: rgba(255,255,255,0.05);
        }
        .vc-info h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.15rem; font-weight: 800; color: white;
        }
        .vc-info .vc-vin {
            font-family: monospace; font-size: 0.78rem; color: var(--accent);
            letter-spacing: 2px; margin-top: 2px;
        }
        .vc-info .vc-badge {
            display: inline-block; margin-top: 6px;
            font-size: 0.68rem; font-weight: 700; text-transform: uppercase;
            padding: 3px 10px; border-radius: 8px; letter-spacing: 0.5px;
        }
        .vc-badge.known { background: rgba(42,157,143,0.15); color: var(--green); }
        .vc-badge.new { background: rgba(0,180,216,0.15); color: var(--accent); }
        .vc-details {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }
        .vc-detail {
            font-size: 0.78rem;
        }
        .vc-detail .dl { color: var(--text-light); text-transform: uppercase; font-size: 0.65rem; font-weight: 700; letter-spacing: 0.5px; }
        .vc-detail .dv { color: white; font-weight: 600; }

        /* RADIO CARDS */
        .radio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .radio-card {
            background: rgba(255,255,255,0.04);
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 14px; padding: 16px; text-align: center;
            cursor: pointer; transition: all 0.3s; position: relative;
        }
        .radio-card:hover { border-color: rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); }
        .radio-card.selected {
            border-color: var(--accent); background: rgba(0,180,216,0.08);
            box-shadow: 0 0 20px rgba(0,180,216,0.1);
        }
        .radio-card .rc-icon { font-size: 1.5rem; margin-bottom: 6px; }
        .radio-card .rc-label { font-size: 0.82rem; font-weight: 700; color: white; }
        .radio-card .rc-desc { font-size: 0.72rem; color: var(--text-light); margin-top: 2px; }
        .radio-card input[type="radio"] { display: none; }

        /* TYPE CARDS (step 2) */
        .type-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .type-card {
            background: rgba(255,255,255,0.04);
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 24px 16px; text-align: center;
            cursor: pointer; transition: all 0.3s;
        }
        .type-card:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-2px); }
        .type-card.selected {
            border-color: var(--accent); background: rgba(0,180,216,0.08);
            box-shadow: 0 0 25px rgba(0,180,216,0.12);
        }
        .type-card .tc-icon { font-size: 2rem; margin-bottom: 10px; }
        .type-card .tc-title { font-size: 0.9rem; font-weight: 800; color: white; margin-bottom: 4px; }
        .type-card .tc-desc { font-size: 0.75rem; color: var(--text-light); line-height: 1.4; }
        .type-card:nth-child(5) { grid-column: 1 / -1; max-width: 300px; margin: 0 auto; }

        /* SEVERITY CARDS */
        .severity-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .severity-card {
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 12px; padding: 14px 10px; text-align: center;
            cursor: pointer; transition: all 0.3s;
        }
        .severity-card:hover { transform: translateY(-2px); }
        .severity-card.minor { background: rgba(42,157,143,0.06); }
        .severity-card.minor.selected { border-color: var(--green); background: rgba(42,157,143,0.12); box-shadow: 0 0 15px rgba(42,157,143,0.2); }
        .severity-card.moderate { background: rgba(244,166,28,0.06); }
        .severity-card.moderate.selected { border-color: var(--gold); background: rgba(244,166,28,0.12); box-shadow: 0 0 15px rgba(244,166,28,0.2); }
        .severity-card.major { background: rgba(230,57,70,0.06); }
        .severity-card.major.selected { border-color: var(--red); background: rgba(230,57,70,0.12); box-shadow: 0 0 15px rgba(230,57,70,0.2); }
        .severity-card .sc-icon { font-size: 1.3rem; }
        .severity-card .sc-label { font-size: 0.78rem; font-weight: 700; margin-top: 4px; }
        .severity-card.minor .sc-label { color: var(--green); }
        .severity-card.moderate .sc-label { color: var(--gold); }
        .severity-card.major .sc-label { color: var(--red); }

        /* IMPACT CARDS */
        .impact-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .impact-card {
            background: rgba(255,255,255,0.04);
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 12px; padding: 12px 8px; text-align: center;
            cursor: pointer; transition: all 0.3s; font-size: 0.78rem; font-weight: 600;
        }
        .impact-card:hover { border-color: rgba(255,255,255,0.15); }
        .impact-card.selected { border-color: var(--accent); background: rgba(0,180,216,0.08); color: var(--accent); }
        .impact-card .ic-icon { font-size: 1.2rem; margin-bottom: 3px; }

        /* TOGGLE */
        .toggle-group { display: flex; gap: 10px; }
        .toggle-btn {
            flex: 1; padding: 12px; border: 2px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.04); border-radius: 12px;
            cursor: pointer; font-weight: 700; font-size: 0.85rem;
            transition: all 0.3s; color: var(--text-light); text-align: center;
            font-family: 'Inter', sans-serif;
        }
        .toggle-btn:hover { border-color: rgba(255,255,255,0.15); }
        .toggle-btn.active-yes { border-color: var(--green); color: var(--green); background: rgba(42,157,143,0.08); }
        .toggle-btn.active-no { border-color: var(--red); color: var(--red); background: rgba(230,57,70,0.08); }
        .toggle-btn.active-pass { border-color: var(--green); color: var(--green); background: rgba(42,157,143,0.1); }
        .toggle-btn.active-fail { border-color: var(--red); color: var(--red); background: rgba(230,57,70,0.1); }

        /* PHOTO ZONE */
        .photo-zone {
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 14px; padding: 24px; text-align: center;
            cursor: pointer; transition: all 0.3s;
        }
        .photo-zone:hover { border-color: var(--accent); background: rgba(0,180,216,0.04); }
        .photo-zone .pz-icon { font-size: 2rem; margin-bottom: 6px; }
        .photo-zone p { color: rgba(255,255,255,0.35); font-size: 0.82rem; }
        .photo-zone .pz-small { font-size: 0.7rem; margin-top: 4px; }
        .photo-thumbs { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
        .photo-thumb {
            width: 70px; height: 70px; border-radius: 10px; object-fit: cover;
            border: 2px solid rgba(255,255,255,0.1);
        }

        /* REVIEW TABLE */
        .review-section { margin-bottom: 24px; }
        .review-section .rs-title {
            font-size: 0.72rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--accent); margin-bottom: 12px;
            padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .review-row {
            display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .review-row .rr-label { color: var(--text-light); font-size: 0.82rem; font-weight: 500; }
        .review-row .rr-value { color: white; font-size: 0.85rem; font-weight: 600; text-align: right; }

        /* CHECKBOX */
        .confirm-check {
            display: flex; align-items: flex-start; gap: 12px;
            margin: 24px 0 20px; cursor: pointer;
        }
        .confirm-check input { display: none; }
        .check-box {
            width: 22px; height: 22px; border-radius: 6px; flex-shrink: 0;
            border: 2px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.04);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; font-size: 0.75rem; color: transparent;
        }
        .confirm-check input:checked + .check-box {
            border-color: var(--green); background: rgba(42,157,143,0.15);
            color: var(--green);
        }
        .confirm-check .check-text {
            font-size: 0.82rem; color: var(--text-light); line-height: 1.5;
        }

        /* BUTTONS */
        .btn {
            padding: 16px 32px; border: none; border-radius: 14px;
            font-family: 'Inter'; font-size: 1rem; font-weight: 800;
            cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;
        }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #0096b7);
            color: white; width: 100%;
        }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,180,216,0.35); }
        .btn-secondary {
            background: transparent; border: 2px solid rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.6); width: 100%;
        }
        .btn-secondary:hover { border-color: rgba(255,255,255,0.3); color: white; }
        .btn-green {
            background: linear-gradient(135deg, var(--green), #1a8a7e);
            color: white; width: 100%;
        }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 28px; }
        .btn-full { margin-top: 28px; }
        .btn .shimmer {
            position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer { 100%{left:100%} }

        /* SUCCESS SCREEN */
        .success-screen { display: none; text-align: center; padding: 40px 20px; animation: fadeIn 0.6s ease; }
        .success-screen.visible { display: block; }
        .success-check {
            width: 80px; height: 80px; border-radius: 50%;
            background: linear-gradient(135deg, var(--green), #1a8a7e);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 20px; font-size: 2.2rem;
            box-shadow: 0 0 40px rgba(42,157,143,0.3);
        }
        .success-screen h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem; font-weight: 800; color: white; margin-bottom: 8px;
        }
        .success-screen .ss-ref {
            font-family: monospace; color: var(--accent); font-size: 0.9rem;
            font-weight: 700; margin-bottom: 8px;
        }
        .success-screen .ss-note {
            color: var(--text-light); font-size: 0.85rem; margin-bottom: 28px;
        }
        .success-btns { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .success-btns .btn { width: auto; padding: 14px 28px; }

        /* FOOTER */
        footer {
            position: relative; z-index: 1;
            text-align: center; padding: 40px 20px;
            border-top: 1px solid rgba(255,255,255,0.05);
            color: var(--text-light); font-size: 0.78rem;
        }
        footer a { color: var(--accent); text-decoration: none; }

        /* MOBILE */
        @media (max-width: 768px) {
            nav { padding: 0 16px; height: 56px; }
            .nav-logo { font-size: 1.3rem; }
            .nav-link { display: none; }
            .hero { padding: 90px 16px 40px; min-height: auto; }
            .hero h1 { font-size: 1.6rem; }
            .hero-stats { gap: 20px; }
            .hero-stat .number { font-size: 1.4rem; }
            .wizard-section { padding: 0 12px 60px; }
            .glass-card { padding: 24px 18px; border-radius: 18px; }
            .vin-input { font-size: 1rem; letter-spacing: 2px; padding: 14px 12px; }
            .form-row { grid-template-columns: 1fr; }
            .radio-grid { grid-template-columns: 1fr 1fr; }
            .type-grid { grid-template-columns: 1fr; }
            .type-card:nth-child(5) { max-width: 100%; }
            .severity-grid { grid-template-columns: 1fr; }
            .impact-grid { grid-template-columns: repeat(3, 1fr); }
            .btn-row { grid-template-columns: 1fr; }
            .wp-line { width: 30px; }
            .vc-header { flex-direction: column; text-align: center; }
            .vc-details { grid-template-columns: 1fr; }
            .review-row { flex-direction: column; gap: 2px; }
            .review-row .rr-value { text-align: left; }
        }
    </style>
</head>
<body>

<!-- NAV -->
<nav>
    <a href="index.html" class="nav-logo">
        <svg class="logo-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="46" stroke="url(#navGrad)" stroke-width="4" fill="none" opacity="0.3"/>
            <circle cx="50" cy="50" r="36" stroke="url(#navGrad)" stroke-width="3" fill="none" opacity="0.5"/>
            <circle cx="50" cy="50" r="26" stroke="url(#navGrad)" stroke-width="2.5" fill="none" opacity="0.7"/>
            <circle cx="50" cy="50" r="8" fill="url(#navGrad)"/>
            <line x1="50" y1="10" x2="50" y2="24" stroke="#00b4d8" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="50" y1="76" x2="50" y2="90" stroke="#2a9d8f" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="10" y1="50" x2="24" y2="50" stroke="#f4a61c" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="76" y1="50" x2="90" y2="50" stroke="#e63946" stroke-width="2.5" stroke-linecap="round"/>
            <defs><linearGradient id="navGrad" x1="0" y1="0" x2="100" y2="100"><stop stop-color="#00b4d8"/><stop offset="1" stop-color="#2a9d8f"/></linearGradient></defs>
        </svg>
        <span class="nav-auto">Auto</span><span class="nav-verif">Verif</span><span class="nav-qc">QC</span>
    </a>
    <div class="nav-right">
        <a href="rapport-vps.html" class="nav-link">Scanner</a>
        <a href="collecte.html" class="nav-link active">Contribuer</a>
        <a href="index.html" class="nav-link">Plan d'affaires</a>
        <a href="rapport-vps.html" class="nav-badge">Scanner un VIN</a>
    </div>
</nav>

<!-- PARTICLES -->
<canvas id="particles"></canvas>

<!-- HERO -->
<section class="hero">
    <div class="glow-orb blue"></div>
    <div class="glow-orb gold"></div>
    <div class="hero-content">
        <div class="badge"><span class="live-dot"></span> Base de donn√©es communautaire</div>
        <h1>Contribuez √† l'<span class="grad">historique v√©hiculaire</span> du Qu√©bec</h1>
        <p>Garages, concessionnaires, assureurs et particuliers ‚Äî soumettez vos donn√©es pour b√¢tir la plus grande base de donn√©es v√©hiculaire qu√©b√©coise.</p>
        <div class="hero-stats">
            <div class="hero-stat"><div class="number" id="statSubmissions">0</div><div class="label">Contributions</div></div>
            <div class="hero-stat"><div class="number" id="statVehicles">0</div><div class="label">V√©hicules</div></div>
            <div class="hero-stat"><div class="number" id="statContributors">0</div><div class="label">Contributeurs</div></div>
        </div>
        <div id="chainBadge" style="margin-top:20px;display:inline-flex;align-items:center;gap:8px;background:rgba(42,157,143,0.1);border:1px solid rgba(42,157,143,0.25);padding:8px 18px;border-radius:30px;font-size:0.75rem;color:var(--green);font-weight:600;">
            üîí Cha√Æne cryptographique int√®gre ‚Äî <span id="chainLength">0</span> blocs v√©rifi√©s
        </div>
    </div>
</section>

<!-- WIZARD -->
<section class="wizard-section">
    <div class="wizard-container">
        <div class="glass-card">

            <!-- PROGRESS -->
            <div class="wizard-progress">
                <div class="wp-step active" data-step="1">
                    <div class="wp-dot active">1</div>
                    <div class="wp-label">VIN</div>
                </div>
                <div class="wp-line" data-line="1"></div>
                <div class="wp-step" data-step="2">
                    <div class="wp-dot">2</div>
                    <div class="wp-label">Type</div>
                </div>
                <div class="wp-line" data-line="2"></div>
                <div class="wp-step" data-step="3">
                    <div class="wp-dot">3</div>
                    <div class="wp-label">D√©tails</div>
                </div>
                <div class="wp-line" data-line="3"></div>
                <div class="wp-step" data-step="4">
                    <div class="wp-dot">4</div>
                    <div class="wp-label">Confirmer</div>
                </div>
            </div>

            <!-- STEP 1: VIN + Identity -->
            <div class="step-panel active" id="step1">
                <div class="step-title">Identification du v√©hicule</div>
                <div class="step-subtitle">Entrez le VIN (num√©ro d'identification du v√©hicule) √† 17 caract√®res.</div>

                <div class="form-group">
                    <label class="form-label">Num√©ro VIN</label>
                    <input type="text" class="vin-input" id="vinInput" maxlength="17" placeholder="Ex: 2HGFC2F59MH528491" autocomplete="off" spellcheck="false">
                    <div class="vin-status" id="vinStatus"></div>
                </div>

                <div class="vehicle-card" id="vehicleCard">
                    <div class="vc-header">
                        <img class="vc-img" id="vcImg" src="" alt="V√©hicule">
                        <div class="vc-info">
                            <h3 id="vcTitle"></h3>
                            <div class="vc-vin" id="vcVin"></div>
                            <div class="vc-badge" id="vcBadge"></div>
                        </div>
                    </div>
                    <div class="vc-details" id="vcDetails"></div>
                </div>

                <div style="margin-top: 28px;">
                    <div class="step-title" style="font-size: 1rem;">Qui √™tes-vous ?</div>
                    <div class="step-subtitle">S√©lectionnez votre type de profil.</div>
                    <div class="radio-grid" id="submitterTypeGrid">
                        <div class="radio-card" data-value="garage" onclick="selectSubmitterType(this)">
                            <div class="rc-icon">üîß</div>
                            <div class="rc-label">Garage</div>
                        </div>
                        <div class="radio-card" data-value="dealer" onclick="selectSubmitterType(this)">
                            <div class="rc-icon">üè¢</div>
                            <div class="rc-label">Concessionnaire</div>
                        </div>
                        <div class="radio-card" data-value="insurance" onclick="selectSubmitterType(this)">
                            <div class="rc-icon">üõ°Ô∏è</div>
                            <div class="rc-label">Assurance</div>
                        </div>
                        <div class="radio-card" data-value="individual" onclick="selectSubmitterType(this)">
                            <div class="rc-icon">üë§</div>
                            <div class="rc-label">Particulier</div>
                        </div>
                    </div>
                </div>

                <div class="form-row" style="margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" id="subName" placeholder="Jean Tremblay">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Courriel</label>
                        <input type="email" class="form-input" id="subEmail" placeholder="jean@example.com">
                    </div>
                </div>
                <div class="form-group" id="companyGroup">
                    <label class="form-label">Entreprise</label>
                    <input type="text" class="form-input" id="subCompany" placeholder="Nom de votre entreprise">
                </div>

                <div class="btn-full">
                    <button class="btn btn-primary" id="btnStep1" onclick="goToStep(2)" disabled>
                        Suivant <span class="shimmer"></span>
                    </button>
                </div>
            </div>

            <!-- STEP 2: Report Type -->
            <div class="step-panel" id="step2">
                <div class="step-title">Type de rapport</div>
                <div class="step-subtitle">Quel type de donn√©es voulez-vous soumettre ?</div>

                <div class="type-grid" id="typeGrid">
                    <div class="type-card" data-type="accident" onclick="selectReportType(this)">
                        <div class="tc-icon">üí•</div>
                        <div class="tc-title">Accident</div>
                        <div class="tc-desc">D√©clarer un accident ou une collision</div>
                    </div>
                    <div class="type-card" data-type="service" onclick="selectReportType(this)">
                        <div class="tc-icon">üîß</div>
                        <div class="tc-title">Entretien / R√©paration</div>
                        <div class="tc-desc">Ajouter un service ou une r√©paration</div>
                    </div>
                    <div class="type-card" data-type="ownership" onclick="selectReportType(this)">
                        <div class="tc-icon">üîë</div>
                        <div class="tc-title">Changement de propri√©taire</div>
                        <div class="tc-desc">Enregistrer un transfert de propri√©t√©</div>
                    </div>
                    <div class="type-card" data-type="inspection" onclick="selectReportType(this)">
                        <div class="tc-icon">üìã</div>
                        <div class="tc-title">Inspection SAAQ</div>
                        <div class="tc-desc">R√©sultat d'inspection m√©canique</div>
                    </div>
                    <div class="type-card" data-type="recall_completion" onclick="selectReportType(this)">
                        <div class="tc-icon">üõ°Ô∏è</div>
                        <div class="tc-title">Rappel compl√©t√©</div>
                        <div class="tc-desc">Confirmer la compl√©tion d'un rappel</div>
                    </div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="goToStep(1)">Retour</button>
                    <button class="btn btn-primary" id="btnStep2" onclick="goToStep(3)" disabled>Suivant <span class="shimmer"></span></button>
                </div>
            </div>

            <!-- STEP 3: Details -->
            <div class="step-panel" id="step3">
                <div class="step-title" id="step3Title">D√©tails</div>
                <div class="step-subtitle" id="step3Subtitle">Remplissez les informations ci-dessous.</div>
                <div id="step3Fields"></div>
                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="goToStep(2)">Retour</button>
                    <button class="btn btn-primary" id="btnStep3" onclick="goToStep(4)">V√©rifier <span class="shimmer"></span></button>
                </div>
            </div>

            <!-- STEP 4: Review -->
            <div class="step-panel" id="step4">
                <div class="step-title">V√©rification</div>
                <div class="step-subtitle">V√©rifiez vos informations avant de soumettre.</div>
                <div id="reviewContent"></div>
                <label class="confirm-check" id="confirmLabel">
                    <input type="checkbox" id="confirmCheck" onchange="toggleSubmit()">
                    <div class="check-box">‚úì</div>
                    <div class="check-text">Je confirme que ces informations sont exactes et que je suis autoris√©(e) √† les soumettre.</div>
                </label>
                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="goToStep(3)">Modifier</button>
                    <button class="btn btn-green" id="btnSubmit" onclick="submitForm()" disabled>Soumettre <span class="shimmer"></span></button>
                </div>
            </div>

            <!-- SUCCESS -->
            <div class="success-screen" id="successScreen">
                <div class="success-check">‚úì</div>
                <h2>Contribution enregistr√©e !</h2>
                <div class="ss-ref" id="ssRef"></div>
                <div class="ss-hash" id="ssHash" style="margin:12px 0;padding:14px 18px;background:rgba(42,157,143,0.08);border:1px solid rgba(42,157,143,0.2);border-radius:12px;text-align:left;">
                    <div style="font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--green);margin-bottom:6px;">üîí Empreinte d'int√©grit√© SHA-256</div>
                    <div id="ssHashValue" style="font-family:'JetBrains Mono','Fira Code',monospace;font-size:0.72rem;color:var(--accent);word-break:break-all;letter-spacing:0.5px;line-height:1.6;"></div>
                    <div style="font-size:0.68rem;color:var(--text-light);margin-top:8px;">Cette empreinte cryptographique garantit que vos donn√©es ne peuvent pas √™tre alt√©r√©es. Chaque soumission est cha√Æn√©e √† la pr√©c√©dente.</div>
                </div>
                <div class="ss-note">Votre soumission sera v√©rifi√©e sous 24-48h. Merci pour votre contribution !</div>
                <div class="success-btns">
                    <button class="btn btn-primary" onclick="resetWizard()">Soumettre une autre</button>
                    <a href="rapport-vps.html" class="btn btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">Scanner un VIN</a>
                </div>
            </div>

        </div>
    </div>
</section>

<!-- FOOTER -->
<footer>
    <p>AutoVerif QC ‚Äî Propuls√© par <a href="https://seoparai.com" target="_blank">SeoAI</a></p>
    <p style="margin-top: 6px; font-size: 0.7rem; color: rgba(255,255,255,0.25);">Les donn√©es soumises sont v√©rifi√©es avant publication. Aucune information personnelle n'est partag√©e.</p>
</footer>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ
let currentStep = 1;
let vehicleData = null;
let selectedSubmitterType = null;
let selectedReportType = null;
let formData = {};

const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:8930'
    : '/autoverif';

// ‚îÄ‚îÄ‚îÄ Particles ‚îÄ‚îÄ‚îÄ
(function() {
    const c = document.getElementById('particles');
    const ctx = c.getContext('2d');
    let w, h, dots = [];
    function resize() { w = c.width = innerWidth; h = c.height = innerHeight; }
    resize(); addEventListener('resize', resize);
    for (let i = 0; i < 50; i++) dots.push({
        x: Math.random() * w, y: Math.random() * h,
        vx: (Math.random() - 0.5) * 0.3, vy: (Math.random() - 0.5) * 0.3,
        r: Math.random() * 1.5 + 0.5
    });
    function draw() {
        ctx.clearRect(0, 0, w, h);
        dots.forEach(d => {
            d.x += d.vx; d.y += d.vy;
            if (d.x < 0 || d.x > w) d.vx *= -1;
            if (d.y < 0 || d.y > h) d.vy *= -1;
            ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0,180,216,0.15)'; ctx.fill();
        });
        for (let i = 0; i < dots.length; i++) {
            for (let j = i + 1; j < dots.length; j++) {
                const dx = dots[i].x - dots[j].x, dy = dots[i].y - dots[j].y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < 120) {
                    ctx.beginPath();
                    ctx.moveTo(dots[i].x, dots[i].y);
                    ctx.lineTo(dots[j].x, dots[j].y);
                    ctx.strokeStyle = `rgba(0,180,216,${0.04 * (1 - dist / 120)})`;
                    ctx.stroke();
                }
            }
        }
        requestAnimationFrame(draw);
    }
    draw();
})();

// ‚îÄ‚îÄ‚îÄ Load stats + chain verification ‚îÄ‚îÄ‚îÄ
(async function() {
    try {
        const r = await fetch(API_BASE + '/api/collecte/stats');
        const d = await r.json();
        animateNumber('statSubmissions', d.total_submissions || 0);
        animateNumber('statVehicles', d.total_vehicles || 0);
        animateNumber('statContributors', d.total_contributors || 0);
    } catch(e) { console.log('Stats unavailable'); }
    // Verify chain integrity
    try {
        const r2 = await fetch(API_BASE + '/api/collecte/verify');
        const v = await r2.json();
        const badge = document.getElementById('chainBadge');
        document.getElementById('chainLength').textContent = v.chain_length || 0;
        if (v.valid) {
            badge.style.borderColor = 'rgba(42,157,143,0.25)';
            badge.style.color = 'var(--green)';
        } else {
            badge.innerHTML = '‚ö†Ô∏è Alerte: anomalie d√©tect√©e dans la cha√Æne';
            badge.style.borderColor = 'rgba(230,57,70,0.25)';
            badge.style.color = 'var(--red)';
            badge.style.background = 'rgba(230,57,70,0.1)';
        }
    } catch(e) { console.log('Chain verify unavailable'); }
})();

function animateNumber(id, target) {
    const el = document.getElementById(id);
    if (!el) return;
    let current = 0;
    const step = Math.max(1, Math.floor(target / 30));
    const interval = setInterval(() => {
        current += step;
        if (current >= target) { current = target; clearInterval(interval); }
        el.textContent = current.toLocaleString('fr-CA');
    }, 30);
}

// ‚îÄ‚îÄ‚îÄ VIN Input ‚îÄ‚îÄ‚îÄ
const vinInput = document.getElementById('vinInput');
let vinTimeout = null;

vinInput.addEventListener('input', function() {
    this.value = this.value.toUpperCase().replace(/[^A-HJ-NPR-Z0-9]/g, '');
    document.getElementById('vehicleCard').classList.remove('visible');
    vehicleData = null;
    validateStep1();
    if (this.value.length === 17) {
        clearTimeout(vinTimeout);
        vinTimeout = setTimeout(() => decodeVIN(this.value), 300);
    } else {
        document.getElementById('vinStatus').textContent = '';
        document.getElementById('vinStatus').className = 'vin-status';
    }
});

async function decodeVIN(vin) {
    const status = document.getElementById('vinStatus');
    status.textContent = 'D√©codage en cours...';
    status.className = 'vin-status loading';

    try {
        const r = await fetch(API_BASE + '/api/collecte/vin-check/' + vin);
        const d = await r.json();
        if (d.error) {
            status.textContent = d.error;
            status.className = 'vin-status error';
            return;
        }
        vehicleData = d;
        status.textContent = 'V√©hicule identifi√© !';
        status.className = 'vin-status success';
        showVehicleCard(d);
        validateStep1();
    } catch(e) {
        status.textContent = 'Erreur de connexion au serveur.';
        status.className = 'vin-status error';
    }
}

function showVehicleCard(d) {
    const card = document.getElementById('vehicleCard');
    const v = d.vehicle;
    document.getElementById('vcImg').src = d.image_url || '';
    document.getElementById('vcTitle').textContent = `${v.year} ${v.make} ${v.model}`;
    document.getElementById('vcVin').textContent = vinInput.value;
    const badge = document.getElementById('vcBadge');
    if (d.found) {
        badge.textContent = `V√©hicule connu ‚Äî ${d.existing_records} rapport(s)`;
        badge.className = 'vc-badge known';
    } else {
        badge.textContent = 'Nouveau v√©hicule';
        badge.className = 'vc-badge new';
    }
    const details = document.getElementById('vcDetails');
    const fields = [
        ['Carrosserie', v.body], ['Moteur', v.engine ? v.engine + 'L' : ''],
        ['Carburant', v.fuel], ['Transmission', v.transmission],
        ['Traction', v.drive], ['Assembl√©', v.plant_country]
    ];
    details.innerHTML = fields.filter(f => f[1]).map(f =>
        `<div class="vc-detail"><div class="dl">${f[0]}</div><div class="dv">${f[1]}</div></div>`
    ).join('');
    card.classList.add('visible');
}

// ‚îÄ‚îÄ‚îÄ Submitter type ‚îÄ‚îÄ‚îÄ
function selectSubmitterType(el) {
    document.querySelectorAll('#submitterTypeGrid .radio-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    selectedSubmitterType = el.dataset.value;
    // Show/hide company field
    document.getElementById('companyGroup').style.display = selectedSubmitterType === 'individual' ? 'none' : 'block';
    validateStep1();
}

function validateStep1() {
    const valid = vehicleData && selectedSubmitterType &&
        document.getElementById('subName').value.trim() &&
        document.getElementById('subEmail').value.trim();
    document.getElementById('btnStep1').disabled = !valid;
}

document.getElementById('subName').addEventListener('input', validateStep1);
document.getElementById('subEmail').addEventListener('input', validateStep1);

// ‚îÄ‚îÄ‚îÄ Report type ‚îÄ‚îÄ‚îÄ
function selectReportType(el) {
    document.querySelectorAll('#typeGrid .type-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    selectedReportType = el.dataset.type;
    document.getElementById('btnStep2').disabled = false;
}

// ‚îÄ‚îÄ‚îÄ Step navigation ‚îÄ‚îÄ‚îÄ
function goToStep(n) {
    if (n === 2 && !vehicleData) return;
    if (n === 3 && !selectedReportType) return;
    if (n === 3) renderStep3();
    if (n === 4) buildReview();

    // Hide all panels
    document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('step' + n).classList.add('active');

    // Update progress dots
    document.querySelectorAll('.wp-step').forEach(s => {
        const sn = parseInt(s.dataset.step);
        s.classList.remove('active', 'done');
        s.querySelector('.wp-dot').classList.remove('active', 'done');
        if (sn < n) { s.classList.add('done'); s.querySelector('.wp-dot').classList.add('done'); }
        else if (sn === n) { s.classList.add('active'); s.querySelector('.wp-dot').classList.add('active'); }
    });
    document.querySelectorAll('.wp-line').forEach(l => {
        const ln = parseInt(l.dataset.line);
        l.classList.toggle('done', ln < n);
    });

    currentStep = n;
    window.scrollTo({ top: document.querySelector('.wizard-section').offsetTop - 80, behavior: 'smooth' });
}

// ‚îÄ‚îÄ‚îÄ Step 3: Render fields ‚îÄ‚îÄ‚îÄ
function renderStep3() {
    const container = document.getElementById('step3Fields');
    const titles = {
        accident: ['D√©tails de l\'accident', 'D√©crivez l\'accident survenu.'],
        service: ['D√©tails de l\'entretien', 'D√©crivez le service ou la r√©paration effectu√©e.'],
        ownership: ['Changement de propri√©taire', 'D√©tails du transfert de propri√©t√©.'],
        inspection: ['Inspection SAAQ', 'R√©sultat de l\'inspection m√©canique.'],
        recall_completion: ['Rappel compl√©t√©', 'Confirmation de la compl√©tion du rappel.'],
    };
    document.getElementById('step3Title').textContent = titles[selectedReportType][0];
    document.getElementById('step3Subtitle').textContent = titles[selectedReportType][1];

    let html = '';

    if (selectedReportType === 'accident') {
        html = `
            <div class="form-group">
                <label class="form-label">Date de l'accident</label>
                <input type="date" class="form-input" id="fDate">
            </div>
            <div class="form-group">
                <label class="form-label">S√©v√©rit√©</label>
                <div class="severity-grid">
                    <div class="severity-card minor" onclick="selectSeverity(this, 'minor')">
                        <div class="sc-icon">üü¢</div><div class="sc-label">Mineur</div>
                    </div>
                    <div class="severity-card moderate" onclick="selectSeverity(this, 'moderate')">
                        <div class="sc-icon">üü°</div><div class="sc-label">Mod√©r√©</div>
                    </div>
                    <div class="severity-card major" onclick="selectSeverity(this, 'major')">
                        <div class="sc-icon">üî¥</div><div class="sc-label">Majeur</div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Point d'impact</label>
                <div class="impact-grid">
                    <div class="impact-card" onclick="selectImpact(this, 'front')"><div class="ic-icon">‚¨ÜÔ∏è</div>Avant</div>
                    <div class="impact-card" onclick="selectImpact(this, 'rear')"><div class="ic-icon">‚¨áÔ∏è</div>Arri√®re</div>
                    <div class="impact-card" onclick="selectImpact(this, 'left')"><div class="ic-icon">‚¨ÖÔ∏è</div>Gauche</div>
                    <div class="impact-card" onclick="selectImpact(this, 'right')"><div class="ic-icon">‚û°Ô∏è</div>Droite</div>
                    <div class="impact-card" onclick="selectImpact(this, 'rollover')"><div class="ic-icon">üîÑ</div>Tonneau</div>
                    <div class="impact-card" onclick="selectImpact(this, 'multiple')"><div class="ic-icon">üí•</div>Multiple</div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Coussins gonflables d√©ploy√©s ?</label>
                    <div class="toggle-group">
                        <div class="toggle-btn" onclick="setToggle('airbag', true, this)">Oui</div>
                        <div class="toggle-btn" onclick="setToggle('airbag', false, this)">Non</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Dommages structurels ?</label>
                    <div class="toggle-group">
                        <div class="toggle-btn" onclick="setToggle('structural', true, this)">Oui</div>
                        <div class="toggle-btn" onclick="setToggle('structural', false, this)">Non</div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Co√ªt estim√© des r√©parations ($)</label>
                <input type="number" class="form-input" id="fCost" placeholder="Ex: 5000" min="0">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="fDesc" placeholder="D√©crivez les circonstances de l'accident..." maxlength="500"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Photos (optionnel)</label>
                <div class="photo-zone" onclick="document.getElementById('photoInput').click()">
                    <div class="pz-icon">üì∑</div>
                    <p>Cliquez ou d√©posez des photos ici</p>
                    <p class="pz-small">Max 5 photos, 5 Mo chacune (JPG, PNG, WebP)</p>
                </div>
                <input type="file" id="photoInput" multiple accept="image/*" style="display:none" onchange="handlePhotos(this.files)">
                <div class="photo-thumbs" id="photoThumbs"></div>
            </div>`;
    } else if (selectedReportType === 'service') {
        html = `
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Date du service</label>
                    <input type="date" class="form-input" id="fDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Lecture odom√®tre (km)</label>
                    <input type="number" class="form-input" id="fOdometer" placeholder="Ex: 85000" min="0">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Type de service</label>
                <select class="form-select" id="fServiceType">
                    <option value="">‚Äî S√©lectionnez ‚Äî</option>
                    <option value="oil_change">Changement d'huile</option>
                    <option value="brakes">Freins</option>
                    <option value="transmission">Transmission</option>
                    <option value="engine">Moteur</option>
                    <option value="tires">Pneus</option>
                    <option value="general_maintenance">Entretien g√©n√©ral</option>
                    <option value="electrical">√âlectrique</option>
                    <option value="suspension">Suspension</option>
                    <option value="other">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Nom de l'atelier</label>
                <input type="text" class="form-input" id="fFacility" placeholder="Ex: Garage Tremblay">
            </div>
            <div class="form-group">
                <label class="form-label">Description des travaux</label>
                <textarea class="form-textarea" id="fDesc" placeholder="D√©crivez les travaux effectu√©s..." maxlength="500"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Co√ªt ($)</label>
                    <input type="number" class="form-input" id="fCost" placeholder="Optionnel" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Pi√®ces utilis√©es</label>
                    <div class="toggle-group">
                        <div class="toggle-btn" onclick="setParts('oem', this)" style="font-size:0.75rem">OEM</div>
                        <div class="toggle-btn" onclick="setParts('aftermarket', this)" style="font-size:0.75rem">Apr√®s-march√©</div>
                        <div class="toggle-btn" onclick="setParts('used', this)" style="font-size:0.75rem">Usag√©es</div>
                    </div>
                </div>
            </div>`;
    } else if (selectedReportType === 'ownership') {
        html = `
            <div class="form-group">
                <label class="form-label">Date du changement</label>
                <input type="date" class="form-input" id="fDate">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type ancien propri√©taire</label>
                    <select class="form-select" id="fPrevOwner">
                        <option value="personal">Personnel</option>
                        <option value="commercial">Commercial</option>
                        <option value="fleet">Flotte</option>
                        <option value="rental">Location</option>
                        <option value="government">Gouvernement</option>
                        <option value="unknown">Inconnu</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Type nouveau propri√©taire</label>
                    <select class="form-select" id="fNewOwner">
                        <option value="personal">Personnel</option>
                        <option value="commercial">Commercial</option>
                        <option value="fleet">Flotte</option>
                        <option value="rental">Location</option>
                        <option value="government">Gouvernement</option>
                        <option value="unknown">Inconnu</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Province d'immatriculation</label>
                    <select class="form-select" id="fProvince">
                        <option value="QC">Qu√©bec</option>
                        <option value="ON">Ontario</option>
                        <option value="AB">Alberta</option>
                        <option value="BC">Colombie-Britannique</option>
                        <option value="MB">Manitoba</option>
                        <option value="SK">Saskatchewan</option>
                        <option value="NB">Nouveau-Brunswick</option>
                        <option value="NS">Nouvelle-√âcosse</option>
                        <option value="PE">√éle-du-Prince-√âdouard</option>
                        <option value="NL">Terre-Neuve</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Prix de vente ($)</label>
                    <input type="number" class="form-input" id="fSalePrice" placeholder="Optionnel" min="0">
                </div>
            </div>`;
    } else if (selectedReportType === 'inspection') {
        html = `
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Date de l'inspection</label>
                    <input type="date" class="form-input" id="fDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Lecture odom√®tre (km)</label>
                    <input type="number" class="form-input" id="fOdometer" placeholder="Ex: 85000" min="0">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">R√©sultat</label>
                <div class="toggle-group">
                    <div class="toggle-btn" onclick="setInspectionResult('pass', this)" style="font-size:1rem;padding:20px;">‚úÖ R√©ussi</div>
                    <div class="toggle-btn" onclick="setInspectionResult('fail', this)" style="font-size:1rem;padding:20px;">‚ùå √âchou√©</div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea class="form-textarea" id="fNotes" placeholder="Notes de l'inspecteur (optionnel)..." maxlength="500"></textarea>
            </div>`;
    } else if (selectedReportType === 'recall_completion') {
        html = `
            <div class="form-group">
                <label class="form-label">Num√©ro du rappel</label>
                <input type="text" class="form-input" id="fRecallNum" placeholder="Ex: 2024-123">
            </div>
            <div class="form-group">
                <label class="form-label">Date de compl√©tion</label>
                <input type="date" class="form-input" id="fDate">
            </div>
            <div class="form-group">
                <label class="form-label">Nom de l'√©tablissement</label>
                <input type="text" class="form-input" id="fFacility" placeholder="Ex: Concessionnaire Honda Laval">
            </div>`;
    }

    container.innerHTML = html;
    formData = {};
}

// ‚îÄ‚îÄ‚îÄ Step 3 helpers ‚îÄ‚îÄ‚îÄ
function selectSeverity(el, val) {
    document.querySelectorAll('.severity-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    formData.severity = val;
}
function selectImpact(el, val) {
    document.querySelectorAll('.impact-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    formData.impact_point = val;
}
function setToggle(key, val, el) {
    const group = el.parentElement;
    group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active-yes', 'active-no'));
    el.classList.add(val ? 'active-yes' : 'active-no');
    formData[key === 'airbag' ? 'airbag_deployed' : 'structural_damage'] = val;
}
function setParts(val, el) {
    el.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active-yes'));
    el.classList.add('active-yes');
    formData.parts_type = val;
}
function setInspectionResult(val, el) {
    el.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active-pass', 'active-fail'));
    el.classList.add(val === 'pass' ? 'active-pass' : 'active-fail');
    formData.result = val;
}

let uploadedPhotos = [];
function handlePhotos(files) {
    const thumbs = document.getElementById('photoThumbs');
    const maxFiles = 5;
    for (let i = 0; i < files.length && uploadedPhotos.length < maxFiles; i++) {
        const f = files[i];
        if (!f.type.startsWith('image/') || f.size > 5 * 1024 * 1024) continue;
        uploadedPhotos.push(f);
        const reader = new FileReader();
        reader.onload = e => {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'photo-thumb';
            thumbs.appendChild(img);
        };
        reader.readAsDataURL(f);
    }
}

// ‚îÄ‚îÄ‚îÄ Collect form data for step 3 ‚îÄ‚îÄ‚îÄ
function collectFormData() {
    const data = { ...formData };
    const fDate = document.getElementById('fDate');
    if (fDate) data.date = fDate.value;
    const fDesc = document.getElementById('fDesc');
    if (fDesc) data.description = fDesc.value;
    const fCost = document.getElementById('fCost');
    if (fCost && fCost.value) data.estimated_cost = parseFloat(fCost.value);
    if (fCost && fCost.value && selectedReportType === 'service') data.cost = parseFloat(fCost.value);
    const fOdo = document.getElementById('fOdometer');
    if (fOdo && fOdo.value) data.odometer_km = parseInt(fOdo.value);
    const fST = document.getElementById('fServiceType');
    if (fST) data.service_type = fST.value;
    const fFac = document.getElementById('fFacility');
    if (fFac) data.facility_name = fFac.value;
    const fPrev = document.getElementById('fPrevOwner');
    if (fPrev) data.previous_owner_type = fPrev.value;
    const fNew = document.getElementById('fNewOwner');
    if (fNew) data.new_owner_type = fNew.value;
    const fProv = document.getElementById('fProvince');
    if (fProv) data.province = fProv.value;
    const fPrice = document.getElementById('fSalePrice');
    if (fPrice && fPrice.value) data.sale_price = parseFloat(fPrice.value);
    const fNotes = document.getElementById('fNotes');
    if (fNotes) data.notes = fNotes.value;
    const fRecall = document.getElementById('fRecallNum');
    if (fRecall) data.recall_number = fRecall.value;
    return data;
}

// ‚îÄ‚îÄ‚îÄ Step 4: Build review ‚îÄ‚îÄ‚îÄ
function buildReview() {
    const data = collectFormData();
    formData = data;
    const v = vehicleData.vehicle;
    const typeLabels = {
        accident: 'Accident', service: 'Entretien / R√©paration',
        ownership: 'Changement de propri√©taire', inspection: 'Inspection SAAQ',
        recall_completion: 'Rappel compl√©t√©'
    };
    const subTypeLabels = { garage: 'Garage', dealer: 'Concessionnaire', insurance: 'Assurance', individual: 'Particulier' };
    const severityLabels = { minor: 'Mineur', moderate: 'Mod√©r√©', major: 'Majeur' };
    const impactLabels = { front: 'Avant', rear: 'Arri√®re', left: 'Gauche', right: 'Droite', rollover: 'Tonneau', multiple: 'Multiple' };
    const serviceLabels = { oil_change: 'Changement d\'huile', brakes: 'Freins', transmission: 'Transmission', engine: 'Moteur', tires: 'Pneus', general_maintenance: 'Entretien g√©n√©ral', electrical: '√âlectrique', suspension: 'Suspension', other: 'Autre' };
    const ownerLabels = { personal: 'Personnel', commercial: 'Commercial', fleet: 'Flotte', rental: 'Location', government: 'Gouvernement', unknown: 'Inconnu' };
    const partsLabels = { oem: 'OEM', aftermarket: 'Apr√®s-march√©', used: 'Usag√©es', na: 'N/A' };

    let html = `
        <div class="review-section">
            <div class="rs-title">V√©hicule</div>
            <div class="review-row"><span class="rr-label">VIN</span><span class="rr-value" style="font-family:monospace;letter-spacing:1px;">${vinInput.value}</span></div>
            <div class="review-row"><span class="rr-label">V√©hicule</span><span class="rr-value">${v.year} ${v.make} ${v.model}</span></div>
        </div>
        <div class="review-section">
            <div class="rs-title">Contributeur</div>
            <div class="review-row"><span class="rr-label">Type</span><span class="rr-value">${subTypeLabels[selectedSubmitterType] || selectedSubmitterType}</span></div>
            <div class="review-row"><span class="rr-label">Nom</span><span class="rr-value">${document.getElementById('subName').value}</span></div>
            <div class="review-row"><span class="rr-label">Courriel</span><span class="rr-value">${document.getElementById('subEmail').value}</span></div>
            ${selectedSubmitterType !== 'individual' ? `<div class="review-row"><span class="rr-label">Entreprise</span><span class="rr-value">${document.getElementById('subCompany').value || '‚Äî'}</span></div>` : ''}
        </div>
        <div class="review-section">
            <div class="rs-title">${typeLabels[selectedReportType]}</div>`;

    if (data.date) html += `<div class="review-row"><span class="rr-label">Date</span><span class="rr-value">${data.date}</span></div>`;

    if (selectedReportType === 'accident') {
        if (data.severity) html += `<div class="review-row"><span class="rr-label">S√©v√©rit√©</span><span class="rr-value">${severityLabels[data.severity]}</span></div>`;
        if (data.impact_point) html += `<div class="review-row"><span class="rr-label">Point d'impact</span><span class="rr-value">${impactLabels[data.impact_point]}</span></div>`;
        if (data.airbag_deployed !== undefined) html += `<div class="review-row"><span class="rr-label">Coussins gonflables</span><span class="rr-value">${data.airbag_deployed ? 'Oui' : 'Non'}</span></div>`;
        if (data.structural_damage !== undefined) html += `<div class="review-row"><span class="rr-label">Dommages structurels</span><span class="rr-value">${data.structural_damage ? 'Oui' : 'Non'}</span></div>`;
        if (data.estimated_cost) html += `<div class="review-row"><span class="rr-label">Co√ªt estim√©</span><span class="rr-value">${parseFloat(data.estimated_cost).toLocaleString('fr-CA')} $</span></div>`;
        if (data.description) html += `<div class="review-row"><span class="rr-label">Description</span><span class="rr-value" style="max-width:300px">${data.description}</span></div>`;
    } else if (selectedReportType === 'service') {
        if (data.odometer_km) html += `<div class="review-row"><span class="rr-label">Odom√®tre</span><span class="rr-value">${parseInt(data.odometer_km).toLocaleString('fr-CA')} km</span></div>`;
        if (data.service_type) html += `<div class="review-row"><span class="rr-label">Type de service</span><span class="rr-value">${serviceLabels[data.service_type] || data.service_type}</span></div>`;
        if (data.facility_name) html += `<div class="review-row"><span class="rr-label">Atelier</span><span class="rr-value">${data.facility_name}</span></div>`;
        if (data.description) html += `<div class="review-row"><span class="rr-label">Travaux</span><span class="rr-value" style="max-width:300px">${data.description}</span></div>`;
        if (data.cost) html += `<div class="review-row"><span class="rr-label">Co√ªt</span><span class="rr-value">${parseFloat(data.cost).toLocaleString('fr-CA')} $</span></div>`;
        if (data.parts_type) html += `<div class="review-row"><span class="rr-label">Pi√®ces</span><span class="rr-value">${partsLabels[data.parts_type]}</span></div>`;
    } else if (selectedReportType === 'ownership') {
        if (data.previous_owner_type) html += `<div class="review-row"><span class="rr-label">Ancien proprio</span><span class="rr-value">${ownerLabels[data.previous_owner_type]}</span></div>`;
        if (data.new_owner_type) html += `<div class="review-row"><span class="rr-label">Nouveau proprio</span><span class="rr-value">${ownerLabels[data.new_owner_type]}</span></div>`;
        if (data.province) html += `<div class="review-row"><span class="rr-label">Province</span><span class="rr-value">${data.province}</span></div>`;
        if (data.sale_price) html += `<div class="review-row"><span class="rr-label">Prix de vente</span><span class="rr-value">${parseFloat(data.sale_price).toLocaleString('fr-CA')} $</span></div>`;
    } else if (selectedReportType === 'inspection') {
        if (data.result) html += `<div class="review-row"><span class="rr-label">R√©sultat</span><span class="rr-value" style="color:${data.result === 'pass' ? 'var(--green)' : 'var(--red)'};font-weight:800;">${data.result === 'pass' ? '‚úÖ R√©ussi' : '‚ùå √âchou√©'}</span></div>`;
        if (data.odometer_km) html += `<div class="review-row"><span class="rr-label">Odom√®tre</span><span class="rr-value">${parseInt(data.odometer_km).toLocaleString('fr-CA')} km</span></div>`;
        if (data.notes) html += `<div class="review-row"><span class="rr-label">Notes</span><span class="rr-value" style="max-width:300px">${data.notes}</span></div>`;
    } else if (selectedReportType === 'recall_completion') {
        if (data.recall_number) html += `<div class="review-row"><span class="rr-label">Num√©ro du rappel</span><span class="rr-value">${data.recall_number}</span></div>`;
        if (data.facility_name) html += `<div class="review-row"><span class="rr-label">√âtablissement</span><span class="rr-value">${data.facility_name}</span></div>`;
    }

    html += `</div>`;
    document.getElementById('reviewContent').innerHTML = html;
    document.getElementById('confirmCheck').checked = false;
    document.getElementById('btnSubmit').disabled = true;
}

function toggleSubmit() {
    document.getElementById('btnSubmit').disabled = !document.getElementById('confirmCheck').checked;
}

// ‚îÄ‚îÄ‚îÄ Submit ‚îÄ‚îÄ‚îÄ
async function submitForm() {
    const btn = document.getElementById('btnSubmit');
    btn.disabled = true;
    btn.textContent = 'Envoi en cours...';

    const payload = {
        vin: vinInput.value,
        report_type: selectedReportType,
        submitter: {
            name: document.getElementById('subName').value.trim(),
            email: document.getElementById('subEmail').value.trim(),
            type: selectedSubmitterType,
            company: document.getElementById('subCompany').value.trim(),
        },
        data: formData,
    };

    try {
        const r = await fetch(API_BASE + '/api/collecte/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });
        const d = await r.json();
        if (d.success) {
            document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
            document.querySelector('.wizard-progress').style.display = 'none';
            const ss = document.getElementById('successScreen');
            ss.classList.add('visible');
            document.getElementById('ssRef').textContent = `R√©f√©rence: #AV-${String(d.submission_id).padStart(5, '0')}`;
            if (d.integrity_hash) {
                document.getElementById('ssHashValue').textContent = d.integrity_hash;
                document.getElementById('ssHash').style.display = 'block';
            } else {
                document.getElementById('ssHash').style.display = 'none';
            }
        } else {
            alert(d.error || 'Erreur lors de la soumission.');
            btn.disabled = false;
            btn.innerHTML = 'Soumettre <span class="shimmer"></span>';
        }
    } catch(e) {
        alert('Erreur de connexion au serveur.');
        btn.disabled = false;
        btn.innerHTML = 'Soumettre <span class="shimmer"></span>';
    }
}

// ‚îÄ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ
function resetWizard() {
    currentStep = 1;
    vehicleData = null;
    selectedSubmitterType = null;
    selectedReportType = null;
    formData = {};
    uploadedPhotos = [];
    vinInput.value = '';
    document.getElementById('vinStatus').textContent = '';
    document.getElementById('vehicleCard').classList.remove('visible');
    document.getElementById('subName').value = '';
    document.getElementById('subEmail').value = '';
    document.getElementById('subCompany').value = '';
    document.getElementById('companyGroup').style.display = 'block';
    document.querySelectorAll('.radio-card').forEach(c => c.classList.remove('selected'));
    document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
    document.getElementById('btnStep1').disabled = true;
    document.getElementById('btnStep2').disabled = true;
    document.getElementById('step3Fields').innerHTML = '';
    document.getElementById('reviewContent').innerHTML = '';
    document.getElementById('successScreen').classList.remove('visible');
    document.querySelector('.wizard-progress').style.display = 'flex';
    document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('step1').classList.add('active');
    document.querySelectorAll('.wp-step').forEach(s => {
        s.classList.remove('active', 'done');
        s.querySelector('.wp-dot').classList.remove('active', 'done');
    });
    document.querySelectorAll('.wp-line').forEach(l => l.classList.remove('done'));
    document.querySelector('.wp-step[data-step="1"]').classList.add('active');
    document.querySelector('.wp-step[data-step="1"] .wp-dot').classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚îÄ‚îÄ‚îÄ GSAP reveal ‚îÄ‚îÄ‚îÄ
gsap.from('.hero-content', { y: 40, opacity: 0, duration: 1, ease: 'power3.out', delay: 0.2 });
gsap.from('.glass-card', { y: 30, opacity: 0, duration: 0.8, ease: 'power3.out', delay: 0.5 });
</script>
</body>
</html>
