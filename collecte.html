<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoVerif QC — Contribuer à l'historique véhiculaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #080e1a;
            --primary-light: #111b2e;
            --accent: #00b4d8;
            --accent-dark: #0096b7;
            --gold: #f4a61c;
            --gold-dark: #d4910a;
            --red: #e63946;
            --green: #2a9d8f;
            --purple: #8b5cf6;
            --bg: #0b1120;
            --bg-light: #0f1729;
            --card: rgba(255,255,255,0.04);
            --text: #e8ecf2;
            --text-light: #8892a4;
            --border: rgba(255,255,255,0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg); color: var(--text);
            line-height: 1.6; overflow-x: hidden;
        }

        /* NAV */
        nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            background: rgba(15, 43, 70, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0 40px; display: flex; align-items: center;
            justify-content: space-between; height: 64px;
        }
        .nav-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.6rem; font-weight: 700; color: white;
            letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 10px; text-decoration: none;
        }
        .nav-logo .logo-icon { width: 38px; height: 38px; flex-shrink: 0; }
        .nav-logo .nav-auto { color: white; font-weight: 800; }
        .nav-logo .nav-verif { color: var(--accent); font-weight: 800; }
        .nav-logo .nav-qc { color: var(--gold); font-size: 0.7em; font-weight: 600; margin-left: 4px; }
        .nav-right { display: flex; align-items: center; gap: 16px; }
        .nav-right a {
            color: rgba(255,255,255,0.7); text-decoration: none; font-size: 0.9rem;
            font-weight: 500; transition: color 0.2s;
        }
        .nav-right a:hover { color: white; }
        .nav-right a.active { color: var(--accent); }

        /* HERO MINI */
        .hero-mini {
            padding: 100px 40px 40px; text-align: center;
            background: linear-gradient(180deg, rgba(0,180,216,0.06) 0%, transparent 100%);
        }
        .hero-mini h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.4rem; font-weight: 800; margin-bottom: 8px;
        }
        .hero-mini h1 .accent { color: var(--accent); }
        .hero-mini h1 .gold { color: var(--gold); }
        .hero-mini p { color: var(--text-light); font-size: 1.05rem; max-width: 600px; margin: 0 auto 20px; }
        .stats-row { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; }
        .stat-item { text-align: center; }
        .stat-item .stat-num {
            font-family: 'Orbitron', monospace; font-size: 1.4rem; font-weight: 700; color: var(--accent);
        }
        .stat-item .stat-label {
            font-size: 0.75rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px;
        }

        /* FORM CONTAINER */
        .form-container { max-width: 920px; margin: 0 auto; padding: 0 20px 60px; }

        /* GLASS SECTION */
        .section {
            background: var(--card); border: 1px solid var(--border); border-radius: 20px;
            padding: 28px 32px; margin-bottom: 20px; backdrop-filter: blur(12px);
            transition: border-color 0.3s;
        }
        .section:hover { border-color: rgba(0,180,216,0.15); }
        .section-header {
            display: flex; align-items: center; gap: 12px; margin-bottom: 20px;
            cursor: pointer; user-select: none;
        }
        .section-icon {
            width: 42px; height: 42px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3rem; flex-shrink: 0;
        }
        .section-icon.cyan { background: rgba(0,180,216,0.15); }
        .section-icon.gold { background: rgba(244,166,28,0.15); }
        .section-icon.red { background: rgba(230,57,70,0.15); }
        .section-icon.green { background: rgba(42,157,143,0.15); }
        .section-icon.purple { background: rgba(139,92,246,0.15); }
        .section-icon.orange { background: rgba(251,146,60,0.15); }
        .section-title {
            font-family: 'Space Grotesk', sans-serif; font-size: 1.15rem; font-weight: 700; flex: 1;
        }
        .section-badge {
            font-size: 0.7rem; padding: 3px 10px; border-radius: 20px;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .badge-required { background: rgba(230,57,70,0.15); color: var(--red); }
        .badge-optional { background: rgba(42,157,143,0.15); color: var(--green); }
        .section-toggle {
            width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--border);
            background: transparent; color: var(--text-light); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; transition: all 0.3s;
        }
        .section-toggle:hover { border-color: var(--accent); color: var(--accent); }
        .section-body { overflow: hidden; transition: max-height 0.4s ease, opacity 0.3s; }
        .section.collapsed .section-body { max-height: 0 !important; opacity: 0; padding: 0; }
        .section.collapsed .section-toggle { transform: rotate(-90deg); }

        /* FORM ELEMENTS */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
        .form-row.single { grid-template-columns: 1fr; }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group label {
            font-size: 0.8rem; font-weight: 600; color: var(--text-light);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .field-label {
            font-size: 0.8rem; font-weight: 600; color: var(--text-light);
            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block;
        }
        input, select, textarea {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            border-radius: 10px; padding: 12px 16px; color: var(--text);
            font-family: 'Inter', sans-serif; font-size: 0.95rem; outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,180,216,0.12);
        }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.25); }
        select {
            cursor: pointer; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238892a4' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px;
        }
        select option { background: #1a2332; color: var(--text); }
        textarea { resize: vertical; min-height: 80px; }
        .vin-input {
            font-family: 'JetBrains Mono', monospace; font-size: 1.3rem;
            text-transform: uppercase; letter-spacing: 2px; text-align: center;
            padding: 16px; font-weight: 600;
        }

        /* VEHICLE CARD */
        .vehicle-card {
            display: none; background: rgba(0,180,216,0.06);
            border: 1px solid rgba(0,180,216,0.2); border-radius: 16px;
            padding: 20px; margin-top: 16px; align-items: center; gap: 20px;
        }
        .vehicle-card.show { display: flex; }
        .vehicle-card img { width: 200px; height: auto; border-radius: 12px; object-fit: cover; flex-shrink: 0; }
        .vehicle-info h3 { font-family: 'Space Grotesk', sans-serif; font-size: 1.3rem; font-weight: 700; margin-bottom: 4px; }
        .vehicle-info .vin-display { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent); margin-bottom: 8px; }
        .vehicle-specs { display: flex; flex-wrap: wrap; gap: 8px; }
        .spec-tag { font-size: 0.75rem; padding: 4px 10px; border-radius: 6px; background: rgba(255,255,255,0.06); color: var(--text-light); }

        /* CHECKBOX GRID */
        .check-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 16px; }
        .check-item {
            display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 10px;
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            cursor: pointer; transition: all 0.2s; user-select: none;
        }
        .check-item:hover { border-color: rgba(0,180,216,0.3); background: rgba(0,180,216,0.04); }
        .check-item.checked { border-color: var(--accent); background: rgba(0,180,216,0.08); }
        .check-item input[type="checkbox"] { display: none; }
        .check-box {
            width: 20px; height: 20px; border-radius: 6px; border: 2px solid var(--border); flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .check-item.checked .check-box { border-color: var(--accent); background: var(--accent); }
        .check-box::after {
            content: ''; display: block; width: 6px; height: 10px;
            border: solid white; border-width: 0 2px 2px 0;
            transform: rotate(45deg) scale(0); transition: transform 0.15s;
        }
        .check-item.checked .check-box::after { transform: rotate(45deg) scale(1); }
        .check-label { font-size: 0.88rem; font-weight: 500; }

        /* RADIO CARDS */
        .radio-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; margin-bottom: 16px; }
        .radio-card {
            padding: 14px; border-radius: 12px; border: 1px solid var(--border);
            background: rgba(255,255,255,0.03); cursor: pointer; text-align: center;
            transition: all 0.2s; user-select: none;
        }
        .radio-card:hover { border-color: rgba(0,180,216,0.3); }
        .radio-card.selected { border-color: var(--accent); background: rgba(0,180,216,0.08); box-shadow: 0 0 20px rgba(0,180,216,0.1); }
        .radio-card input { display: none; }
        .radio-card .rc-icon { font-size: 1.6rem; margin-bottom: 6px; }
        .radio-card .rc-text { font-size: 0.85rem; font-weight: 600; }

        /* SEVERITY */
        .severity-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 16px; }
        .severity-btn {
            padding: 14px; border-radius: 12px; text-align: center; cursor: pointer;
            border: 2px solid var(--border); background: rgba(255,255,255,0.03);
            transition: all 0.2s; user-select: none;
        }
        .severity-btn.sel-minor { border-color: var(--green); background: rgba(42,157,143,0.12); }
        .severity-btn.sel-moderate { border-color: var(--gold); background: rgba(244,166,28,0.12); }
        .severity-btn.sel-major { border-color: var(--red); background: rgba(230,57,70,0.12); }
        .severity-btn .sv-icon { font-size: 1.5rem; margin-bottom: 4px; }
        .severity-btn .sv-label { font-size: 0.85rem; font-weight: 700; }
        .severity-btn .sv-desc { font-size: 0.72rem; color: var(--text-light); margin-top: 2px; }

        /* IMPACT DIAGRAM */
        .impact-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 60px);
            gap: 6px; max-width: 300px; margin: 0 auto 16px;
        }
        .impact-zone {
            border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.03);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 600; color: var(--text-light); transition: all 0.2s; user-select: none;
        }
        .impact-zone:hover { border-color: rgba(230,57,70,0.4); }
        .impact-zone.hit { border-color: var(--red); background: rgba(230,57,70,0.2); color: var(--red); }
        .impact-center { grid-column: 2; grid-row: 2; border: 1px dashed var(--border); background: rgba(255,255,255,0.02); font-size: 1.4rem; cursor: default; }

        /* TOGGLE */
        .toggle-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .toggle {
            width: 44px; height: 24px; border-radius: 12px; background: rgba(255,255,255,0.1);
            cursor: pointer; position: relative; transition: background 0.3s; flex-shrink: 0;
        }
        .toggle::after {
            content: ''; position: absolute; left: 3px; top: 3px;
            width: 18px; height: 18px; border-radius: 50%; background: white; transition: transform 0.3s;
        }
        .toggle.on { background: var(--accent); }
        .toggle.on.red { background: var(--red); }
        .toggle.on::after { transform: translateX(20px); }
        .toggle-label { font-size: 0.9rem; font-weight: 500; }

        /* PHOTO UPLOAD */
        .photo-zone {
            border: 2px dashed var(--border); border-radius: 16px; padding: 30px; text-align: center;
            cursor: pointer; transition: all 0.3s; margin-bottom: 16px; position: relative; overflow: hidden;
        }
        .photo-zone:hover { border-color: var(--accent); background: rgba(0,180,216,0.03); }
        .photo-zone.drag-over { border-color: var(--accent); background: rgba(0,180,216,0.06); }
        .photo-zone input { display: none; }
        .photo-zone .pz-icon { font-size: 2.2rem; margin-bottom: 8px; }
        .photo-zone .pz-text { font-size: 0.9rem; color: var(--text-light); }
        .photo-zone .pz-hint { font-size: 0.75rem; color: rgba(255,255,255,0.3); margin-top: 4px; }
        .photo-preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
        .photo-thumb { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; border: 2px solid var(--border); }
        .photo-thumb-wrap { position: relative; width: 80px; height: 80px; }
        .photo-thumb-wrap .photo-remove {
            position: absolute; top: -6px; right: -6px; width: 20px; height: 20px; border-radius: 50%;
            background: var(--red); color: white; border: none; font-size: 0.7rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center; z-index: 2;
        }

        /* SUBMIT */
        .submit-section { text-align: center; padding: 32px; }
        .submit-confirm { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; cursor: pointer; user-select: none; }
        .submit-confirm .check-box { width: 22px; height: 22px; }
        .submit-confirm span { font-size: 0.95rem; color: var(--text-light); }
        .btn-submit {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white; border: none; padding: 16px 48px; border-radius: 14px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s;
            font-family: 'Space Grotesk', sans-serif; letter-spacing: 0.5px;
            box-shadow: 0 4px 24px rgba(0,180,216,0.25);
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,180,216,0.35); }
        .btn-submit:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

        /* SUCCESS OVERLAY */
        .success-overlay {
            display: none; position: fixed; inset: 0; z-index: 9999;
            background: rgba(11,17,32,0.95); backdrop-filter: blur(20px);
            align-items: center; justify-content: center;
        }
        .success-overlay.show { display: flex; }
        .success-card {
            background: var(--card); border: 1px solid rgba(42,157,143,0.3); border-radius: 24px;
            padding: 48px; text-align: center; max-width: 500px; width: 90%;
        }
        .success-check {
            width: 80px; height: 80px; border-radius: 50%; background: rgba(42,157,143,0.15);
            margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;
        }
        .success-card h2 { font-family: 'Space Grotesk', sans-serif; font-size: 1.6rem; color: var(--green); margin-bottom: 8px; }
        .success-card .ref-number { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--accent); margin-bottom: 8px; }
        .success-card .hash-display {
            font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-light);
            word-break: break-all; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin: 12px 0;
        }
        .hash-label { font-size: 0.7rem; color: var(--gold); font-weight: 600; margin-bottom: 4px; }
        .btn-new {
            margin-top: 20px; background: rgba(255,255,255,0.08); color: var(--text);
            border: 1px solid var(--border); padding: 12px 32px; border-radius: 10px;
            font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .btn-new:hover { border-color: var(--accent); color: var(--accent); }

        /* SPINNER */
        .spinner {
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid rgba(255,255,255,0.3); border-top-color: white;
            border-radius: 50%; animation: spin 0.8s linear infinite;
            margin-right: 8px; vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* TYPE SECTIONS */
        .type-section { display: none; }
        .type-section.active { display: block; }

        /* FOOTER */
        footer { text-align: center; padding: 40px 20px 30px; border-top: 1px solid var(--border); }
        footer .footer-brand { font-family: 'Space Grotesk', sans-serif; font-size: 0.9rem; color: var(--text-light); }
        footer .footer-brand strong { color: var(--accent); }
        footer .footer-legal { font-size: 0.72rem; color: rgba(255,255,255,0.3); margin-top: 8px; max-width: 600px; margin-left: auto; margin-right: auto; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            nav { padding: 0 16px; }
            .nav-right a:not(.active) { display: none; }
            .hero-mini { padding: 90px 20px 30px; }
            .hero-mini h1 { font-size: 1.6rem; }
            .stats-row { gap: 20px; }
            .section { padding: 20px 18px; border-radius: 16px; }
            .form-row, .form-row.three { grid-template-columns: 1fr; }
            .check-grid { grid-template-columns: 1fr; }
            .radio-cards { grid-template-columns: 1fr 1fr; }
            .severity-row { grid-template-columns: 1fr; }
            .impact-grid { max-width: 240px; }
            .vehicle-card { flex-direction: column; text-align: center; }
            .vehicle-card img { width: 160px; }
        }
        @media (max-width: 480px) { .radio-cards { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<!-- NAV -->
<nav>
    <a class="nav-logo" href="https://seoparai.com/autoverif/rapport-vps.html">
        <svg class="logo-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="100" height="100" rx="22" fill="url(#g1)"/>
            <path d="M50 18L26 78h12l4-12h16l4 12h12L50 18zm-4 38l4-14 4 14H46z" fill="white"/>
            <path d="M68 68l8 12" stroke="#00b4d8" stroke-width="4" stroke-linecap="round"/>
            <circle cx="62" cy="58" r="16" stroke="#00b4d8" stroke-width="3" fill="none"/>
            <defs><linearGradient id="g1" x1="0" y1="0" x2="100" y2="100"><stop stop-color="#0f2b46"/><stop offset="1" stop-color="#081828"/></linearGradient></defs>
        </svg>
        <span><span class="nav-auto">Auto</span><span class="nav-verif">Verif</span><span class="nav-qc">QC</span></span>
    </a>
    <div class="nav-right">
        <a href="https://seoparai.com/autoverif/rapport-vps.html">Scanner VIN</a>
        <a href="https://seoparai.com/autoverif/collecte.html" class="active">Contribuer</a>
    </div>
</nav>

<!-- HERO MINI -->
<div class="hero-mini">
    <h1><span class="accent">Contribuer</span> à l'historique <span class="gold">véhiculaire</span></h1>
    <p>Aidez-nous à bâtir la plus grande base de données véhiculaire du Québec. Chaque contribution compte.</p>
    <div class="stats-row">
        <div class="stat-item"><div class="stat-num" id="stat-submissions">--</div><div class="stat-label">Soumissions</div></div>
        <div class="stat-item"><div class="stat-num" id="stat-vehicles">--</div><div class="stat-label">Véhicules</div></div>
        <div class="stat-item"><div class="stat-num" id="stat-contributors">--</div><div class="stat-label">Contributeurs</div></div>
    </div>
</div>

<!-- FORM -->
<div class="form-container">

    <!-- S1: VIN -->
    <div class="section" id="sec-vin">
        <div class="section-header" onclick="toggleSection('sec-vin')">
            <div class="section-icon cyan">&#128270;</div>
            <div class="section-title">Identification du véhicule</div>
            <span class="section-badge badge-required">Requis</span>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row single">
                <div class="form-group">
                    <label>Numéro VIN (17 caractères)</label>
                    <input type="text" class="vin-input" id="vin-input" maxlength="17" placeholder="Ex: 2HGFC2F59MH528491" oninput="handleVinInput(this)">
                    <div id="vin-status" style="font-size:0.8rem;margin-top:4px;"></div>
                </div>
            </div>
            <div class="vehicle-card" id="vehicle-card">
                <img id="vehicle-img" src="" alt="Véhicule" onerror="this.style.display='none'">
                <div class="vehicle-info">
                    <h3 id="vehicle-name">--</h3>
                    <div class="vin-display" id="vehicle-vin">--</div>
                    <div class="vehicle-specs" id="vehicle-specs"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- S2: QUI ÊTES-VOUS -->
    <div class="section" id="sec-submitter">
        <div class="section-header" onclick="toggleSection('sec-submitter')">
            <div class="section-icon gold">&#128100;</div>
            <div class="section-title">Qui êtes-vous?</div>
            <span class="section-badge badge-required">Requis</span>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="radio-cards" id="submitter-type">
                <div class="radio-card" onclick="selectRadio(this,'submitter-type','garage')"><input type="radio" name="sub_type" value="garage"><div class="rc-icon">&#128295;</div><div class="rc-text">Garage</div></div>
                <div class="radio-card" onclick="selectRadio(this,'submitter-type','concessionnaire')"><input type="radio" name="sub_type" value="concessionnaire"><div class="rc-icon">&#127970;</div><div class="rc-text">Concessionnaire</div></div>
                <div class="radio-card" onclick="selectRadio(this,'submitter-type','assurance')"><input type="radio" name="sub_type" value="assurance"><div class="rc-icon">&#128203;</div><div class="rc-text">Assurance</div></div>
                <div class="radio-card" onclick="selectRadio(this,'submitter-type','particulier')"><input type="radio" name="sub_type" value="particulier"><div class="rc-icon">&#128587;</div><div class="rc-text">Particulier</div></div>
                <div class="radio-card" onclick="selectRadio(this,'submitter-type','saaq')"><input type="radio" name="sub_type" value="saaq"><div class="rc-icon">&#127963;</div><div class="rc-text">SAAQ / Gouv</div></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Nom complet</label><input type="text" id="sub-name" placeholder="Jean Tremblay"></div>
                <div class="form-group"><label>Courriel</label><input type="email" id="sub-email" placeholder="jean@garage.ca"></div>
            </div>
            <div class="form-row single">
                <div class="form-group"><label>Entreprise / Établissement</label><input type="text" id="sub-company" placeholder="Garage Tremblay Inc."></div>
            </div>
        </div>
    </div>

    <!-- S3: TYPE DE RAPPORT (multi-select) -->
    <div class="section" id="sec-type">
        <div class="section-header" onclick="toggleSection('sec-type')">
            <div class="section-icon green">&#128221;</div>
            <div class="section-title">Type(s) de rapport</div>
            <span class="section-badge badge-required">Requis</span>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:14px;">Sélectionnez un ou plusieurs types de rapport à soumettre.</p>
            <div class="check-grid" id="report-types">
                <label class="check-item" onclick="toggleCheck(this,'accident')"><input type="checkbox" value="accident"><div class="check-box"></div><span class="check-label">&#128165; Accident</span></label>
                <label class="check-item" onclick="toggleCheck(this,'service')"><input type="checkbox" value="service"><div class="check-box"></div><span class="check-label">&#128736; Entretien / Réparation</span></label>
                <label class="check-item" onclick="toggleCheck(this,'ownership')"><input type="checkbox" value="ownership"><div class="check-box"></div><span class="check-label">&#128100; Changement propriétaire</span></label>
                <label class="check-item" onclick="toggleCheck(this,'inspection')"><input type="checkbox" value="inspection"><div class="check-box"></div><span class="check-label">&#9989; Inspection</span></label>
                <label class="check-item" onclick="toggleCheck(this,'recall_completion')"><input type="checkbox" value="recall_completion"><div class="check-box"></div><span class="check-label">&#128276; Rappel complété</span></label>
                <label class="check-item" onclick="toggleCheck(this,'title_brand')"><input type="checkbox" value="title_brand"><div class="check-box"></div><span class="check-label">&#128196; Titre / Branding</span></label>
                <label class="check-item" onclick="toggleCheck(this,'lien')"><input type="checkbox" value="lien"><div class="check-box"></div><span class="check-label">&#128179; Lien / Financement</span></label>
                <label class="check-item" onclick="toggleCheck(this,'theft')"><input type="checkbox" value="theft"><div class="check-box"></div><span class="check-label">&#128274; Vol / Récupération</span></label>
                <label class="check-item" onclick="toggleCheck(this,'obd_diagnostic')"><input type="checkbox" value="obd_diagnostic"><div class="check-box"></div><span class="check-label">&#128268; OBD-II / Diagnostic</span></label>
                <label class="check-item" onclick="toggleCheck(this,'auction')"><input type="checkbox" value="auction"><div class="check-box"></div><span class="check-label">&#128296; Enchères</span></label>
                <label class="check-item" onclick="toggleCheck(this,'fleet_history')"><input type="checkbox" value="fleet_history"><div class="check-box"></div><span class="check-label">&#128666; Flotte / Location</span></label>
                <label class="check-item" onclick="toggleCheck(this,'import_export')"><input type="checkbox" value="import_export"><div class="check-box"></div><span class="check-label">&#127758; Import / Export</span></label>
                <label class="check-item" onclick="toggleCheck(this,'emissions')"><input type="checkbox" value="emissions"><div class="check-box"></div><span class="check-label">&#127811; Émissions</span></label>
                <label class="check-item" onclick="toggleCheck(this,'modification')"><input type="checkbox" value="modification"><div class="check-box"></div><span class="check-label">&#128295; Modification</span></label>
            </div>
        </div>
    </div>

    <!-- S4: ACCIDENT -->
    <div class="section type-section" id="sec-accident" data-type="accident">
        <div class="section-header" onclick="toggleSection('sec-accident')">
            <div class="section-icon red">&#128165;</div>
            <div class="section-title">Détails de l'accident</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date de l'accident</label><input type="date" id="acc-date"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="acc-odo" placeholder="Ex: 85000" min="0"></div>
                <div class="form-group"><label>Coût estimé ($)</label><input type="number" id="acc-cost" placeholder="Ex: 5000" min="0"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Lieu de l'accident</label><input type="text" id="acc-location" placeholder="Ex: Montréal, QC"></div>
                <div class="form-group"><label>No. rapport police</label><input type="text" id="acc-police" placeholder="Optionnel"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Compagnie d'assurance</label><input type="text" id="acc-insurance-co" placeholder="Ex: Desjardins, Intact..."></div>
                <div class="form-group"><label>No. réclamation assurance</label><input type="text" id="acc-insurance-num" placeholder="Optionnel"></div>
            </div>

            <span class="field-label">Sévérité</span>
            <div class="severity-row" id="severity-sel">
                <div class="severity-btn" onclick="selectSeverity(this,'minor')"><div class="sv-icon">&#9898;</div><div class="sv-label" style="color:var(--green)">Mineur</div><div class="sv-desc">Cosmétique, bosses, égratignures</div></div>
                <div class="severity-btn" onclick="selectSeverity(this,'moderate')"><div class="sv-icon">&#128992;</div><div class="sv-label" style="color:var(--gold)">Modéré</div><div class="sv-desc">Panneaux remplacés, mécanique</div></div>
                <div class="severity-btn" onclick="selectSeverity(this,'major')"><div class="sv-icon">&#128308;</div><div class="sv-label" style="color:var(--red)">Majeur</div><div class="sv-desc">Structurel, perte totale</div></div>
            </div>

            <span class="field-label">Point(s) d'impact</span>
            <div class="impact-grid" id="impact-grid">
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="front-left">AV-G</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="front">AVANT</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="front-right">AV-D</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="left">GAUCHE</div>
                <div class="impact-center">&#128663;</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="right">DROITE</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="rear-left">AR-G</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="rear">ARRIÈRE</div>
                <div class="impact-zone" onclick="toggleImpact(this)" data-zone="rear-right">AR-D</div>
            </div>

            <span class="field-label">Détails</span>
            <div class="check-grid">
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-airbag"><div class="check-box"></div><span class="check-label">Coussins gonflables déployés</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-structural"><div class="check-box"></div><span class="check-label">Dommages structurels / cadre</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-flood"><div class="check-box"></div><span class="check-label">Dommages par eau / inondation</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-fire"><div class="check-box"></div><span class="check-label">Dommages par feu</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-hail"><div class="check-box"></div><span class="check-label">Dommages par grêle</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-theft"><div class="check-box"></div><span class="check-label">Vol / vandalisme</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-towing"><div class="check-box"></div><span class="check-label">Remorquage requis</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-rollover"><div class="check-box"></div><span class="check-label">Tonneau / capotage</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" id="acc-totalloss"><div class="check-box"></div><span class="check-label">Perte totale déclarée</span></label>
            </div>

            <div class="toggle-row">
                <div class="toggle" id="acc-drivable-toggle" onclick="toggleDrivable(this)"></div>
                <span class="toggle-label">Véhicule roulable après l'accident</span>
            </div>

            <div class="form-row single">
                <div class="form-group"><label>Description</label><textarea id="acc-desc" placeholder="Décrivez les circonstances de l'accident..."></textarea></div>
            </div>

            <span class="field-label">Photos de l'accident</span>
            <div class="photo-zone" onclick="document.getElementById('file-accident').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleDrop(event,'accident')">
                <input type="file" id="file-accident" multiple accept="image/*" onchange="handleFiles(this.files,'accident')">
                <div class="pz-icon">&#128247;</div><div class="pz-text">Glissez vos photos ou cliquez</div><div class="pz-hint">PNG, JPG, WEBP — max 5 fichiers, 5 Mo chacun</div>
            </div>
            <div class="photo-preview" id="preview-accident"></div>
        </div>
    </div>

    <!-- S5: SERVICE -->
    <div class="section type-section" id="sec-service" data-type="service">
        <div class="section-header" onclick="toggleSection('sec-service')">
            <div class="section-icon gold">&#128736;</div>
            <div class="section-title">Détails de l'entretien / réparation</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date du service</label><input type="date" id="svc-date"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="svc-odo" placeholder="Ex: 85000" min="0"></div>
                <div class="form-group"><label>Coût total ($)</label><input type="number" id="svc-cost" placeholder="Ex: 850" min="0"></div>
            </div>

            <span class="field-label">Type(s) de service effectué</span>
            <div class="check-grid" id="svc-types">
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="oil_change"><div class="check-box"></div><span class="check-label">Changement d'huile</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="brakes"><div class="check-box"></div><span class="check-label">Freins</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="tires"><div class="check-box"></div><span class="check-label">Pneus</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="transmission"><div class="check-box"></div><span class="check-label">Transmission</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="engine"><div class="check-box"></div><span class="check-label">Moteur</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="suspension"><div class="check-box"></div><span class="check-label">Suspension</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="exhaust"><div class="check-box"></div><span class="check-label">Échappement</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="electrical"><div class="check-box"></div><span class="check-label">Électrique</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="ac_heating"><div class="check-box"></div><span class="check-label">A/C / Chauffage</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="body_paint"><div class="check-box"></div><span class="check-label">Carrosserie / Peinture</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="battery"><div class="check-box"></div><span class="check-label">Batterie</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="timing_belt"><div class="check-box"></div><span class="check-label">Courroie distribution</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="alignment"><div class="check-box"></div><span class="check-label">Alignement</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="glass"><div class="check-box"></div><span class="check-label">Pare-brise / Vitres</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="steering"><div class="check-box"></div><span class="check-label">Direction</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="other"><div class="check-box"></div><span class="check-label">Autre</span></label>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Établissement / Garage</label><input type="text" id="svc-facility" placeholder="Nom du garage"></div>
                <div class="form-group"><label>Pièces utilisées</label>
                    <select id="svc-parts"><option value="na">— Non spécifié —</option><option value="oem">OEM (Manufacturier)</option><option value="aftermarket">Aftermarket</option><option value="used">Usagées</option><option value="mixed">Mélange</option></select>
                </div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Description des travaux</label><textarea id="svc-desc" placeholder="Détails des travaux effectués..."></textarea></div></div>

            <span class="field-label">Photos / Factures</span>
            <div class="photo-zone" onclick="document.getElementById('file-service').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleDrop(event,'service')">
                <input type="file" id="file-service" multiple accept="image/*" onchange="handleFiles(this.files,'service')">
                <div class="pz-icon">&#128247;</div><div class="pz-text">Glissez vos photos ou cliquez</div><div class="pz-hint">PNG, JPG, WEBP — max 5 fichiers, 5 Mo chacun</div>
            </div>
            <div class="photo-preview" id="preview-service"></div>

            <span class="field-label" style="margin-top:16px;">Véhicule électrique / Hybride (si applicable)</span>
            <div class="form-row three">
                <div class="form-group"><label>Santé batterie (SOH %)</label><input type="number" id="svc-ev-soh" placeholder="Ex: 92" min="0" max="100" step="0.1"></div>
                <div class="form-group"><label>Capacité batterie (kWh)</label><input type="number" id="svc-ev-kwh" placeholder="Ex: 62.5" min="0" step="0.1"></div>
                <div class="form-group"><label>Type service EV</label>
                    <select id="svc-ev-type"><option value="">— N/A —</option><option value="battery_check">Diagnostic batterie</option><option value="battery_replace">Remplacement batterie</option><option value="charge_port">Port de charge</option><option value="motor">Moteur électrique</option><option value="inverter">Onduleur</option><option value="cooling">Refroidissement batterie</option></select>
                </div>
            </div>
        </div>
    </div>

    <!-- S6: OWNERSHIP -->
    <div class="section type-section" id="sec-ownership" data-type="ownership">
        <div class="section-header" onclick="toggleSection('sec-ownership')">
            <div class="section-icon purple">&#128100;</div>
            <div class="section-title">Changement de propriétaire</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date du transfert</label><input type="date" id="own-date"></div>
                <div class="form-group"><label>Prix de vente ($)</label><input type="number" id="own-price" placeholder="Ex: 15000" min="0"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="own-odo" placeholder="Ex: 120000" min="0"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Ancien propriétaire</label>
                    <select id="own-prev"><option value="unknown">— Non spécifié —</option><option value="particulier">Particulier</option><option value="concessionnaire">Concessionnaire</option><option value="location">Compagnie de location</option><option value="flotte">Flotte commerciale</option><option value="gouvernement">Gouvernement</option><option value="assurance">Assurance (reconstruction)</option><option value="taxi">Taxi / Rideshare</option><option value="ecole">École de conduite</option></select>
                </div>
                <div class="form-group"><label>Nouveau propriétaire</label>
                    <select id="own-new"><option value="unknown">— Non spécifié —</option><option value="particulier">Particulier</option><option value="concessionnaire">Concessionnaire</option><option value="location">Compagnie de location</option><option value="flotte">Flotte commerciale</option><option value="gouvernement">Gouvernement</option><option value="taxi">Taxi / Rideshare</option></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Province</label>
                    <select id="own-province"><option value="QC">Québec</option><option value="ON">Ontario</option><option value="NB">Nouveau-Brunswick</option><option value="NS">Nouvelle-Écosse</option><option value="PE">Île-du-Prince-Édouard</option><option value="NL">Terre-Neuve</option><option value="MB">Manitoba</option><option value="SK">Saskatchewan</option><option value="AB">Alberta</option><option value="BC">Colombie-Britannique</option><option value="YT">Yukon</option><option value="NT">Territoires du Nord-Ouest</option><option value="NU">Nunavut</option><option value="US">États-Unis</option><option value="OTHER">Autre pays</option></select>
                </div>
                <div class="form-group"><label>Usage du véhicule</label>
                    <select id="own-usage"><option value="">— Non spécifié —</option><option value="personnel">Personnel</option><option value="commercial">Commercial</option><option value="location">Location</option><option value="taxi">Taxi / Uber / Lyft</option><option value="livraison">Livraison</option><option value="police">Police / Urgence</option><option value="flotte">Flotte d'entreprise</option><option value="ecole_conduite">École de conduite</option></select>
                </div>
            </div>

            <span class="field-label">Photos / Documents</span>
            <div class="photo-zone" onclick="document.getElementById('file-ownership').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleDrop(event,'ownership')">
                <input type="file" id="file-ownership" multiple accept="image/*" onchange="handleFiles(this.files,'ownership')">
                <div class="pz-icon">&#128247;</div><div class="pz-text">Glissez vos photos ou cliquez</div><div class="pz-hint">PNG, JPG, WEBP — max 5 fichiers, 5 Mo chacun</div>
            </div>
            <div class="photo-preview" id="preview-ownership"></div>
        </div>
    </div>

    <!-- S7: INSPECTION (expanded) -->
    <div class="section type-section" id="sec-inspection" data-type="inspection">
        <div class="section-header" onclick="toggleSection('sec-inspection')">
            <div class="section-icon green">&#9989;</div>
            <div class="section-title">Inspection</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <span class="field-label">Type d'inspection</span>
            <div class="radio-cards" id="insp-type-sel">
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','saaq_mecanique')"><input type="radio" name="insp_type" value="saaq_mecanique"><div class="rc-icon">&#127963;</div><div class="rc-text">SAAQ Mécanique</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','pre_achat')"><input type="radio" name="insp_type" value="pre_achat"><div class="rc-icon">&#128269;</div><div class="rc-text">Pré-achat</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','securite')"><input type="radio" name="insp_type" value="securite"><div class="rc-icon">&#128737;</div><div class="rc-text">Sécurité (ON/AB)</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','emissions')"><input type="radio" name="insp_type" value="emissions"><div class="rc-icon">&#127811;</div><div class="rc-text">Émissions</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','hors_province')"><input type="radio" name="insp_type" value="hors_province"><div class="rc-icon">&#128666;</div><div class="rc-text">Hors-province</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-type-sel','commercial')"><input type="radio" name="insp_type" value="commercial"><div class="rc-icon">&#128666;</div><div class="rc-text">Véhicule commercial</div></div>
            </div>

            <div class="form-row three">
                <div class="form-group"><label>Date de l'inspection</label><input type="date" id="insp-date"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="insp-odo" placeholder="Ex: 95000" min="0"></div>
                <div class="form-group"><label>No. formulaire SAAQ</label><input type="text" id="insp-form" placeholder="Optionnel"></div>
            </div>

            <span class="field-label">Résultat</span>
            <div class="radio-cards" id="insp-result" style="max-width:500px;">
                <div class="radio-card" onclick="selectRadio(this,'insp-result','pass')" style="border-color:rgba(42,157,143,0.3)"><input type="radio" name="insp_result" value="pass"><div class="rc-icon" style="color:var(--green)">&#9989;</div><div class="rc-text" style="color:var(--green)">Réussi</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-result','conditional')" style="border-color:rgba(244,166,28,0.3)"><input type="radio" name="insp_result" value="conditional"><div class="rc-icon" style="color:var(--gold)">&#9888;</div><div class="rc-text" style="color:var(--gold)">Conditionnel</div></div>
                <div class="radio-card" onclick="selectRadio(this,'insp-result','fail')" style="border-color:rgba(230,57,70,0.3)"><input type="radio" name="insp_result" value="fail"><div class="rc-icon" style="color:var(--red)">&#10060;</div><div class="rc-text" style="color:var(--red)">Échoué</div></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Inspecteur (nom)</label><input type="text" id="insp-inspector" placeholder="Nom de l'inspecteur"></div>
                <div class="form-group"><label>No. permis mandataire SAAQ</label><input type="text" id="insp-permit" placeholder="Optionnel"></div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Établissement</label><input type="text" id="insp-facility" placeholder="Nom du garage mandataire"></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes / Défaillances</label><textarea id="insp-notes" placeholder="Points vérifiés, défaillances observées..."></textarea></div></div>

            <span class="field-label">Photos du rapport</span>
            <div class="photo-zone" onclick="document.getElementById('file-inspection').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleDrop(event,'inspection')">
                <input type="file" id="file-inspection" multiple accept="image/*" onchange="handleFiles(this.files,'inspection')">
                <div class="pz-icon">&#128247;</div><div class="pz-text">Glissez vos photos ou cliquez</div><div class="pz-hint">PNG, JPG, WEBP — max 5 fichiers, 5 Mo chacun</div>
            </div>
            <div class="photo-preview" id="preview-inspection"></div>
        </div>
    </div>

    <!-- S8: RECALL -->
    <div class="section type-section" id="sec-recall" data-type="recall_completion">
        <div class="section-header" onclick="toggleSection('sec-recall')">
            <div class="section-icon cyan">&#128276;</div>
            <div class="section-title">Rappel complété</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Numéro du rappel</label><input type="text" id="rec-number" placeholder="Ex: 2024-123"></div>
                <div class="form-group"><label>Date de complétion</label><input type="date" id="rec-date"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="rec-odo" placeholder="Optionnel" min="0"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Établissement</label><input type="text" id="rec-facility" placeholder="Concessionnaire ou garage"></div>
                <div class="form-group"><label>Composant affecté</label><input type="text" id="rec-component" placeholder="Ex: Système de freinage"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Type de remède</label>
                    <select id="rec-remedy"><option value="">— Non spécifié —</option><option value="repair">Réparation</option><option value="replace">Remplacement pièce</option><option value="software">Mise à jour logicielle</option><option value="refund">Remboursement</option></select>
                </div>
                <div class="form-group"><label>&nbsp;</label></div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Description du rappel</label><textarea id="rec-desc" placeholder="Description du problème et de la correction..."></textarea></div></div>
        </div>
    </div>

    <!-- S9: TITLE BRAND (NEW) -->
    <div class="section type-section" id="sec-title" data-type="title_brand">
        <div class="section-header" onclick="toggleSection('sec-title')">
            <div class="section-icon orange">&#128196;</div>
            <div class="section-title">Titre / Branding véhiculaire</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <span class="field-label">Type de branding</span>
            <div class="radio-cards" id="brand-type-sel">
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','clean')" style="border-color:rgba(42,157,143,0.3)"><input type="radio" name="brand_type" value="clean"><div class="rc-icon" style="color:var(--green)">&#9989;</div><div class="rc-text" style="color:var(--green)">Clean / Normal</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','salvage')"><input type="radio" name="brand_type" value="salvage"><div class="rc-icon" style="color:var(--red)">&#9888;</div><div class="rc-text" style="color:var(--red)">Salvage</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','rebuilt')"><input type="radio" name="brand_type" value="rebuilt"><div class="rc-icon" style="color:var(--gold)">&#128295;</div><div class="rc-text" style="color:var(--gold)">Rebuilt / Reconstruit</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','vga')"><input type="radio" name="brand_type" value="vga"><div class="rc-icon" style="color:var(--red)">&#127988;</div><div class="rc-text" style="color:var(--red)">VGA (SAAQ)</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','irreparable')"><input type="radio" name="brand_type" value="irreparable"><div class="rc-icon">&#10060;</div><div class="rc-text">Irréparable</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','flood')"><input type="radio" name="brand_type" value="flood"><div class="rc-icon">&#127754;</div><div class="rc-text">Inondation</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','fire')"><input type="radio" name="brand_type" value="fire"><div class="rc-icon">&#128293;</div><div class="rc-text">Incendie</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','lemon')"><input type="radio" name="brand_type" value="lemon"><div class="rc-icon">&#127819;</div><div class="rc-text">Lemon / Rachat</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','stolen')"><input type="radio" name="brand_type" value="stolen"><div class="rc-icon">&#128274;</div><div class="rc-text">Volé / Récupéré</div></div>
                <div class="radio-card" onclick="selectRadio(this,'brand-type-sel','odometer')"><input type="radio" name="brand_type" value="odometer"><div class="rc-icon">&#128200;</div><div class="rc-text">Odomètre suspect</div></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Date du branding</label><input type="date" id="brand-date"></div>
                <div class="form-group"><label>Province / État source</label>
                    <select id="brand-province"><option value="QC">Québec</option><option value="ON">Ontario</option><option value="AB">Alberta</option><option value="BC">Colombie-Britannique</option><option value="MB">Manitoba</option><option value="SK">Saskatchewan</option><option value="NB">Nouveau-Brunswick</option><option value="NS">Nouvelle-Écosse</option><option value="US">États-Unis</option><option value="OTHER">Autre</option></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Compagnie d'assurance</label><input type="text" id="brand-insurance" placeholder="Si perte totale déclarée"></div>
                <div class="form-group"><label>Montant perte totale ($)</label><input type="number" id="brand-amount" placeholder="Optionnel" min="0"></div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Source de l'information</label><input type="text" id="brand-source" placeholder="Ex: SAAQ, RDPRM, assurance..."></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="brand-notes" placeholder="Détails supplémentaires..."></textarea></div></div>
        </div>
    </div>

    <!-- S10: LIEN / FINANCEMENT (NEW) -->
    <div class="section type-section" id="sec-lien" data-type="lien">
        <div class="section-header" onclick="toggleSection('sec-lien')">
            <div class="section-icon gold">&#128179;</div>
            <div class="section-title">Lien / Financement (RDPRM / PPSA)</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row">
                <div class="form-group"><label>Créancier / Institution</label><input type="text" id="lien-holder" placeholder="Ex: Desjardins, RBC, TD..."></div>
                <div class="form-group"><label>Type de lien</label>
                    <select id="lien-type"><option value="">— Non spécifié —</option><option value="hypotheque">Hypothèque mobilière</option><option value="reservation">Réservation de propriété</option><option value="leasing">Location (leasing)</option><option value="pret">Prêt auto</option></select>
                </div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>Montant ($)</label><input type="number" id="lien-amount" placeholder="Ex: 25000" min="0"></div>
                <div class="form-group"><label>Date d'inscription</label><input type="date" id="lien-reg-date"></div>
                <div class="form-group"><label>Date de radiation</label><input type="date" id="lien-discharge-date"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Statut</label>
                    <select id="lien-status"><option value="active">Actif</option><option value="discharged">Radié / Payé</option><option value="renewed">Renouvelé</option></select>
                </div>
                <div class="form-group"><label>Province</label>
                    <select id="lien-province"><option value="QC">Québec (RDPRM)</option><option value="ON">Ontario (PPSA)</option><option value="AB">Alberta (PPSA)</option><option value="BC">Colombie-Britannique (PPSA)</option><option value="OTHER">Autre</option></select>
                </div>
            </div>
            <div class="form-row single"><div class="form-group"><label>No. inscription RDPRM / PPSA</label><input type="text" id="lien-reg-num" placeholder="Optionnel"></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="lien-notes" placeholder="Détails supplémentaires..."></textarea></div></div>
        </div>
    </div>

    <!-- S11: THEFT / RECOVERY (NEW) -->
    <div class="section type-section" id="sec-theft" data-type="theft">
        <div class="section-header" onclick="toggleSection('sec-theft')">
            <div class="section-icon red">&#128274;</div>
            <div class="section-title">Vol / Récupération</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row">
                <div class="form-group"><label>Date du vol</label><input type="date" id="theft-date-stolen"></div>
                <div class="form-group"><label>Date de récupération</label><input type="date" id="theft-date-recovered"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>No. rapport police</label><input type="text" id="theft-police" placeholder="Numéro du rapport"></div>
                <div class="form-group"><label>Corps policier</label><input type="text" id="theft-jurisdiction" placeholder="Ex: SPVM, SQ, GRC..."></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Lieu de récupération</label><input type="text" id="theft-recovery-loc" placeholder="Ville, province"></div>
                <div class="form-group"><label>État à la récupération</label>
                    <select id="theft-condition"><option value="">— Non spécifié —</option><option value="undamaged">Intact / Sans dommages</option><option value="damaged">Endommagé</option><option value="stripped">Dépouillé (pièces manquantes)</option><option value="burned">Incendié</option></select>
                </div>
            </div>

            <div class="toggle-row">
                <div class="toggle" id="theft-insurance-toggle" onclick="toggleGeneric(this,'theft-insurance')"></div>
                <span class="toggle-label">Réclamation d'assurance déposée</span>
                <input type="hidden" id="theft-insurance" value="false">
            </div>

            <div class="form-row single"><div class="form-group"><label>Pièces manquantes</label><textarea id="theft-parts" placeholder="Liste des pièces manquantes à la récupération..."></textarea></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="theft-notes" placeholder="Détails supplémentaires..."></textarea></div></div>
        </div>
    </div>

    <!-- S12: OBD-II / DIAGNOSTIC -->
    <div class="section type-section" id="sec-obd" data-type="obd_diagnostic">
        <div class="section-header" onclick="toggleSection('sec-obd')">
            <div class="section-icon cyan">&#128268;</div>
            <div class="section-title">OBD-II / Diagnostic</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date du scan</label><input type="date" id="obd-date"></div>
                <div class="form-group"><label>Odomètre (km)</label><input type="number" id="obd-odo" placeholder="Tableau de bord" min="0"></div>
                <div class="form-group"><label>Odomètre ECU (km)</label><input type="number" id="obd-ecu-odo" placeholder="Lecture ECU" min="0"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Outil de scan</label><input type="text" id="obd-tool" placeholder="Ex: Launch X431, Autel MS906..."></div>
                <div class="form-group"><label>&nbsp;</label></div>
            </div>

            <div class="toggle-row">
                <div class="toggle" id="obd-mil-toggle" onclick="toggleGeneric(this,'obd-mil')"></div>
                <span class="toggle-label">MIL (Check Engine Light) allumé</span>
                <input type="hidden" id="obd-mil" value="false">
            </div>

            <div class="form-row single"><div class="form-group"><label>Codes DTC actifs</label><input type="text" id="obd-dtc-active" placeholder="Ex: P0300, P0171, P0420 (séparés par virgule)"></div></div>
            <div class="form-row single"><div class="form-group"><label>Codes DTC pending</label><input type="text" id="obd-dtc-pending" placeholder="Codes en attente de confirmation"></div></div>
            <div class="form-row single"><div class="form-group"><label>Codes DTC permanents</label><input type="text" id="obd-dtc-permanent" placeholder="Codes ne pouvant être effacés"></div></div>

            <span class="field-label">Readiness Monitors</span>
            <div class="check-grid" id="obd-monitors">
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="catalyst"><div class="check-box"></div><span class="check-label">Catalyseur</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="evap"><div class="check-box"></div><span class="check-label">Système évaporatif</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="o2_sensor"><div class="check-box"></div><span class="check-label">Sonde O2</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="egr"><div class="check-box"></div><span class="check-label">EGR</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="misfire"><div class="check-box"></div><span class="check-label">Ratés d'allumage</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="fuel_system"><div class="check-box"></div><span class="check-label">Système carburant</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="secondary_air"><div class="check-box"></div><span class="check-label">Air secondaire</span></label>
                <label class="check-item" onclick="toggleCheckSimple(this)"><input type="checkbox" value="ac_refrigerant"><div class="check-box"></div><span class="check-label">Réfrigérant A/C</span></label>
            </div>

            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="obd-notes" placeholder="Observations, freeze frame data..."></textarea></div></div>
        </div>
    </div>

    <!-- S13: ENCHÈRES -->
    <div class="section type-section" id="sec-auction" data-type="auction">
        <div class="section-header" onclick="toggleSection('sec-auction')">
            <div class="section-icon gold">&#128296;</div>
            <div class="section-title">Données d'enchères</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date de vente</label><input type="date" id="auc-date"></div>
                <div class="form-group"><label>Maison d'enchères</label>
                    <select id="auc-house"><option value="">— Sélectionner —</option><option value="Manheim">Manheim</option><option value="ADESA">ADESA / OPENLANE</option><option value="Copart">Copart</option><option value="IAAI">IAAI (Insurance Auto Auctions)</option><option value="Impact">Impact Auto Auctions</option><option value="Other">Autre</option></select>
                </div>
                <div class="form-group"><label>No. lot</label><input type="text" id="auc-lot" placeholder="Optionnel"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Lieu</label><input type="text" id="auc-location" placeholder="Ex: Montréal, QC"></div>
                <div class="form-group"><label>Prix de vente ($)</label><input type="number" id="auc-price" placeholder="Optionnel" min="0"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Type de vente</label>
                    <select id="auc-sale-type"><option value="">— Non spécifié —</option><option value="wholesale">Wholesale (gros)</option><option value="salvage">Salvage</option><option value="donation">Donation</option><option value="government">Gouvernement</option><option value="repo">Reprise de possession</option></select>
                </div>
                <div class="form-group"><label>Type de vendeur</label>
                    <select id="auc-seller"><option value="">— Non spécifié —</option><option value="dealer">Concessionnaire</option><option value="fleet">Flotte</option><option value="rental">Location</option><option value="insurance">Assurance</option><option value="manufacturer">Manufacturier</option><option value="government">Gouvernement</option><option value="private">Particulier</option></select>
                </div>
            </div>

            <span class="field-label">Rapport de condition</span>
            <div class="form-row three">
                <div class="form-group"><label>Grade NAAA (1.0-5.0)</label><input type="number" id="auc-grade" placeholder="Ex: 3.5" min="1" max="5" step="0.1"></div>
                <div class="form-group"><label>Extérieur</label>
                    <select id="auc-ext"><option value="">—</option><option value="excellent">Excellent</option><option value="good">Bon</option><option value="fair">Moyen</option><option value="poor">Mauvais</option></select>
                </div>
                <div class="form-group"><label>Intérieur</label>
                    <select id="auc-int"><option value="">—</option><option value="excellent">Excellent</option><option value="good">Bon</option><option value="fair">Moyen</option><option value="poor">Mauvais</option></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Mécanique</label>
                    <select id="auc-mech"><option value="">—</option><option value="excellent">Excellent</option><option value="good">Bon</option><option value="fair">Moyen</option><option value="poor">Mauvais</option></select>
                </div>
                <div class="form-group"><label>Odeur</label>
                    <select id="auc-odor"><option value="">Aucune</option><option value="smoke">Fumée</option><option value="pet">Animal</option><option value="mildew">Moisissure</option><option value="chemical">Chimique</option></select>
                </div>
            </div>

            <span class="field-label">Profondeur pneus (mm)</span>
            <div class="form-row" style="grid-template-columns:1fr 1fr 1fr 1fr;">
                <div class="form-group"><label>AV-G</label><input type="number" id="auc-tire-fl" placeholder="mm" min="0" max="15" step="0.1"></div>
                <div class="form-group"><label>AV-D</label><input type="number" id="auc-tire-fr" placeholder="mm" min="0" max="15" step="0.1"></div>
                <div class="form-group"><label>AR-G</label><input type="number" id="auc-tire-rl" placeholder="mm" min="0" max="15" step="0.1"></div>
                <div class="form-group"><label>AR-D</label><input type="number" id="auc-tire-rr" placeholder="mm" min="0" max="15" step="0.1"></div>
            </div>

            <div class="form-row">
                <div class="form-group"><label>Nb. clés</label><input type="number" id="auc-keys" placeholder="Ex: 2" min="0" max="10"></div>
                <div class="form-group"><label>&nbsp;</label></div>
            </div>
            <div class="toggle-row">
                <div class="toggle on" id="auc-run-toggle" onclick="toggleGeneric(this,'auc-run')"></div>
                <span class="toggle-label">Véhicule roule et démarre (Run & Drive)</span>
                <input type="hidden" id="auc-run" value="true">
            </div>
            <div class="form-row single"><div class="form-group"><label>Annonces de dommages</label><textarea id="auc-damage" placeholder="Damage announcements..."></textarea></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="auc-notes" placeholder="Notes additionnelles..."></textarea></div></div>
        </div>
    </div>

    <!-- S14: FLOTTE / LOCATION -->
    <div class="section type-section" id="sec-fleet" data-type="fleet_history">
        <div class="section-header" onclick="toggleSection('sec-fleet')">
            <div class="section-icon purple">&#128666;</div>
            <div class="section-title">Historique flotte / Location / Usage commercial</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <span class="field-label">Type d'usage</span>
            <div class="radio-cards" id="fleet-usage-sel">
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','rental')"><input type="radio" name="fleet_usage" value="rental"><div class="rc-icon">&#128663;</div><div class="rc-text">Location</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','taxi')"><input type="radio" name="fleet_usage" value="taxi"><div class="rc-icon">&#128661;</div><div class="rc-text">Taxi / Uber</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','police')"><input type="radio" name="fleet_usage" value="police"><div class="rc-icon">&#128660;</div><div class="rc-text">Police / Urgence</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','delivery')"><input type="radio" name="fleet_usage" value="delivery"><div class="rc-icon">&#128230;</div><div class="rc-text">Livraison</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','fleet')"><input type="radio" name="fleet_usage" value="fleet"><div class="rc-icon">&#127970;</div><div class="rc-text">Flotte entreprise</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','driving_school')"><input type="radio" name="fleet_usage" value="driving_school"><div class="rc-icon">&#128218;</div><div class="rc-text">École conduite</div></div>
                <div class="radio-card" onclick="selectRadio(this,'fleet-usage-sel','government')"><input type="radio" name="fleet_usage" value="government"><div class="rc-icon">&#127963;</div><div class="rc-text">Gouvernement</div></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Compagnie</label><input type="text" id="fleet-company" placeholder="Ex: Enterprise, Uber, SPVM..."></div>
                <div class="form-group"><label>Province</label>
                    <select id="fleet-province"><option value="QC">Québec</option><option value="ON">Ontario</option><option value="AB">Alberta</option><option value="BC">Colombie-Britannique</option><option value="OTHER">Autre</option></select>
                </div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>Date entrée flotte</label><input type="date" id="fleet-date-in"></div>
                <div class="form-group"><label>Date sortie flotte</label><input type="date" id="fleet-date-out"></div>
                <div class="form-group"><label>Km pendant la flotte</label><input type="number" id="fleet-mileage" placeholder="Optionnel" min="0"></div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Nb. conducteurs estimé</label><input type="number" id="fleet-drivers" placeholder="Optionnel" min="0"></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="fleet-notes" placeholder="Détails supplémentaires..."></textarea></div></div>
        </div>
    </div>

    <!-- S15: IMPORT / EXPORT -->
    <div class="section type-section" id="sec-import" data-type="import_export">
        <div class="section-header" onclick="toggleSection('sec-import')">
            <div class="section-icon green">&#127758;</div>
            <div class="section-title">Import / Export cross-border</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <span class="field-label">Direction</span>
            <div class="radio-cards" id="ie-direction-sel" style="max-width:400px;">
                <div class="radio-card" onclick="selectRadio(this,'ie-direction-sel','import')"><input type="radio" name="ie_dir" value="import"><div class="rc-icon">&#11015;</div><div class="rc-text">Import vers Canada</div></div>
                <div class="radio-card" onclick="selectRadio(this,'ie-direction-sel','export')"><input type="radio" name="ie_dir" value="export"><div class="rc-icon">&#11014;</div><div class="rc-text">Export hors Canada</div></div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>Date du transfert</label><input type="date" id="ie-date"></div>
                <div class="form-group"><label>Pays d'origine</label>
                    <select id="ie-origin"><option value="US">États-Unis</option><option value="CA">Canada</option><option value="MX">Mexique</option><option value="OTHER">Autre</option></select>
                </div>
                <div class="form-group"><label>Pays de destination</label>
                    <select id="ie-dest"><option value="CA">Canada</option><option value="US">États-Unis</option><option value="OTHER">Autre</option></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>No. RIV</label><input type="text" id="ie-riv" placeholder="Registrar of Imported Vehicles"></div>
                <div class="form-group"><label>No. déclaration douane CBSA</label><input type="text" id="ie-customs" placeholder="Optionnel"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Odomètre à l'import</label><input type="number" id="ie-odo" placeholder="Valeur au moment du transfert" min="0"></div>
                <div class="form-group"><label>Unité odomètre</label>
                    <select id="ie-odo-unit"><option value="km">Kilomètres (km)</option><option value="miles">Miles</option></select>
                </div>
            </div>
            <div class="toggle-row">
                <div class="toggle" id="ie-tc-toggle" onclick="toggleGeneric(this,'ie-tc')"></div>
                <span class="toggle-label">Conforme Transport Canada</span>
                <input type="hidden" id="ie-tc" value="false">
            </div>
            <div class="toggle-row">
                <div class="toggle" id="ie-recalls-toggle" onclick="toggleGeneric(this,'ie-recalls')"></div>
                <span class="toggle-label">Rappels complétés avant import</span>
                <input type="hidden" id="ie-recalls" value="false">
            </div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="ie-notes" placeholder="Détails du transfert..."></textarea></div></div>
        </div>
    </div>

    <!-- S16: ÉMISSIONS -->
    <div class="section type-section" id="sec-emissions" data-type="emissions">
        <div class="section-header" onclick="toggleSection('sec-emissions')">
            <div class="section-icon green">&#127811;</div>
            <div class="section-title">Test d'émissions</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <div class="form-row three">
                <div class="form-group"><label>Date du test</label><input type="date" id="em-date"></div>
                <div class="form-group"><label>Type de test</label>
                    <select id="em-type"><option value="obd2">OBD-II</option><option value="visual">Visuel</option><option value="tailpipe">Sonde (tailpipe)</option><option value="exempt">Exempté</option></select>
                </div>
                <div class="form-group"><label>Résultat</label>
                    <select id="em-result"><option value="pass">Réussi</option><option value="fail">Échoué</option><option value="conditional">Conditionnel</option><option value="exempt">Exempté</option></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Station</label><input type="text" id="em-station" placeholder="Nom de la station"></div>
                <div class="form-group"><label>No. station</label><input type="text" id="em-station-num" placeholder="Optionnel"></div>
            </div>
            <span class="field-label">Lectures émissions</span>
            <div class="form-row" style="grid-template-columns:1fr 1fr 1fr 1fr 1fr;">
                <div class="form-group"><label>HC (ppm)</label><input type="number" id="em-hc" placeholder="—" min="0" step="0.01"></div>
                <div class="form-group"><label>CO (%)</label><input type="number" id="em-co" placeholder="—" min="0" step="0.01"></div>
                <div class="form-group"><label>NOx (ppm)</label><input type="number" id="em-nox" placeholder="—" min="0" step="0.01"></div>
                <div class="form-group"><label>CO2 (%)</label><input type="number" id="em-co2" placeholder="—" min="0" step="0.01"></div>
                <div class="form-group"><label>O2 (%)</label><input type="number" id="em-o2" placeholder="—" min="0" step="0.01"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>No. certificat</label><input type="text" id="em-cert" placeholder="Optionnel"></div>
                <div class="form-group"><label>Expiration certificat</label><input type="date" id="em-cert-exp"></div>
            </div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="em-notes" placeholder="Observations..."></textarea></div></div>
        </div>
    </div>

    <!-- S17: MODIFICATIONS -->
    <div class="section type-section" id="sec-mod" data-type="modification">
        <div class="section-header" onclick="toggleSection('sec-mod')">
            <div class="section-icon orange">&#128295;</div>
            <div class="section-title">Modification véhiculaire</div>
            <button class="section-toggle">&#9660;</button>
        </div>
        <div class="section-body">
            <span class="field-label">Type de modification</span>
            <div class="radio-cards" id="mod-type-sel">
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','performance')"><input type="radio" name="mod_type" value="performance"><div class="rc-icon">&#9889;</div><div class="rc-text">Performance</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','suspension')"><input type="radio" name="mod_type" value="suspension"><div class="rc-icon">&#128663;</div><div class="rc-text">Suspension / Lift</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','exhaust')"><input type="radio" name="mod_type" value="exhaust"><div class="rc-icon">&#128168;</div><div class="rc-text">Échappement</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','turbo')"><input type="radio" name="mod_type" value="turbo"><div class="rc-icon">&#128296;</div><div class="rc-text">Turbo / Super</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','ecu_tune')"><input type="radio" name="mod_type" value="ecu_tune"><div class="rc-icon">&#128187;</div><div class="rc-text">ECU Tune</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','cosmetic')"><input type="radio" name="mod_type" value="cosmetic"><div class="rc-icon">&#127912;</div><div class="rc-text">Cosmétique</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','audio')"><input type="radio" name="mod_type" value="audio"><div class="rc-icon">&#127925;</div><div class="rc-text">Audio / Électronique</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','towing')"><input type="radio" name="mod_type" value="towing"><div class="rc-icon">&#128666;</div><div class="rc-text">Remorquage</div></div>
                <div class="radio-card" onclick="selectRadio(this,'mod-type-sel','accessibility')"><input type="radio" name="mod_type" value="accessibility"><div class="rc-icon">&#9855;</div><div class="rc-text">Accessibilité</div></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Date de modification</label><input type="date" id="mod-date"></div>
                <div class="form-group"><label>Installé par</label><input type="text" id="mod-installer" placeholder="Garage ou auto-installé"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Marque / Fabricant pièce</label><input type="text" id="mod-brand" placeholder="Ex: K&N, Borla, APR..."></div>
                <div class="form-group"><label>No. pièce</label><input type="text" id="mod-part-num" placeholder="Optionnel"></div>
            </div>
            <div class="toggle-row">
                <div class="toggle" id="mod-homolog-toggle" onclick="toggleGeneric(this,'mod-homolog')"></div>
                <span class="toggle-label">Homologué / Certifié</span>
                <input type="hidden" id="mod-homolog" value="false">
            </div>
            <div class="toggle-row">
                <div class="toggle" id="mod-saaq-toggle" onclick="toggleGeneric(this,'mod-saaq')"></div>
                <span class="toggle-label">Approuvé SAAQ</span>
                <input type="hidden" id="mod-saaq" value="false">
            </div>
            <div class="toggle-row">
                <div class="toggle" id="mod-insurance-toggle" onclick="toggleGeneric(this,'mod-insurance')"></div>
                <span class="toggle-label">Assurance notifiée</span>
                <input type="hidden" id="mod-insurance" value="false">
            </div>
            <div class="form-row single"><div class="form-group"><label>Description</label><textarea id="mod-desc" placeholder="Détails de la modification..."></textarea></div></div>
            <div class="form-row single"><div class="form-group"><label>Notes</label><textarea id="mod-notes" placeholder="Impact sur garantie, performance..."></textarea></div></div>
        </div>
    </div>

    <!-- SUBMIT -->
    <div class="section" id="sec-submit">
        <div class="submit-section">
            <div class="submit-confirm" onclick="toggleConfirm()">
                <div class="check-box" id="confirm-box"></div>
                <span>Je confirme que ces informations sont exactes et vérifiables.</span>
            </div>
            <button class="btn-submit" id="btn-submit" disabled onclick="submitForm()">Soumettre la contribution</button>
            <div id="submit-status" style="margin-top:12px;font-size:0.85rem;"></div>
        </div>
    </div>

</div>

<!-- SUCCESS OVERLAY -->
<div class="success-overlay" id="success-overlay">
    <div class="success-card">
        <div class="success-check">&#9989;</div>
        <h2>Contribution enregistrée!</h2>
        <p style="color:var(--text-light);margin-bottom:12px;">Merci pour votre contribution à la base de données véhiculaire du Québec.</p>
        <div class="ref-number" id="success-ref">REF: --</div>
        <div class="hash-label">Empreinte cryptographique SHA-256</div>
        <div class="hash-display" id="success-hash">--</div>
        <p style="font-size:0.75rem;color:var(--text-light);">Cette empreinte garantit l'intégrité et l'authenticité de votre soumission.</p>
        <button class="btn-new" onclick="resetForm()">Nouvelle contribution</button>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-brand">Propulsé par <strong>AutoVerif QC</strong> — SeoAI</div>
    <div class="footer-legal">Les données soumises sont protégées par un système d'intégrité cryptographique SHA-256 à chaîne de blocs. Chaque soumission est liée de manière immuable à la précédente, garantissant l'inaltérabilité de l'historique.</div>
</footer>

<script>
const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:8930' : 'https://seoparai.com/autoverif';

// STATE
let vehicleData = null, selectedTypes = new Set(), selectedSeverity = null, selectedImpacts = new Set();
let selectedSubmitterType = null, inspectionResult = null, inspectionType = null, brandType = null;
let fleetUsageType = null, ieDirection = null, modType = null;
let confirmed = false, drivableState = true;
let photoFiles = { accident:[], service:[], ownership:[], inspection:[] };

// LOAD STATS
(async()=>{try{const r=await fetch(`${API_BASE}/api/collecte/stats`);const d=await r.json();document.getElementById('stat-submissions').textContent=d.total_submissions||0;document.getElementById('stat-vehicles').textContent=d.total_vehicles||0;document.getElementById('stat-contributors').textContent=d.total_contributors||0;}catch(e){}})();

// VIN INPUT
let vinTimeout=null;
function handleVinInput(el){
    el.value=el.value.toUpperCase().replace(/[^A-HJ-NPR-Z0-9]/g,'');
    const vin=el.value,status=document.getElementById('vin-status');
    if(vin.length<17){status.innerHTML=`<span style="color:var(--text-light)">${vin.length}/17 caractères</span>`;document.getElementById('vehicle-card').classList.remove('show');vehicleData=null;return;}
    status.innerHTML='<span style="color:var(--accent)"><span class="spinner"></span>Décodage VIN...</span>';
    clearTimeout(vinTimeout);
    vinTimeout=setTimeout(async()=>{try{const r=await fetch(`${API_BASE}/api/collecte/vin-check/${vin}`);const d=await r.json();
        if(d.error){status.innerHTML=`<span style="color:var(--red)">${d.error}</span>`;vehicleData=null;return;}
        vehicleData=d;const v=d.vehicle;
        document.getElementById('vehicle-name').textContent=`${v.year} ${v.make} ${v.model}`;
        document.getElementById('vehicle-vin').textContent=vin;
        document.getElementById('vehicle-img').src=d.image_url;document.getElementById('vehicle-img').style.display='';
        const specs=document.getElementById('vehicle-specs');specs.innerHTML='';
        [v.body,v.engine?v.engine+'L':'',v.fuel,v.drive,v.transmission].filter(Boolean).forEach(t=>{specs.innerHTML+=`<span class="spec-tag">${t}</span>`;});
        if(d.existing_records>0)specs.innerHTML+=`<span class="spec-tag" style="background:rgba(0,180,216,0.15);color:var(--accent)">${d.existing_records} rapport(s)</span>`;
        document.getElementById('vehicle-card').classList.add('show');
        status.innerHTML='<span style="color:var(--green)">&#9989; Véhicule identifié</span>';
    }catch(e){status.innerHTML='<span style="color:var(--red)">Erreur de connexion</span>';vehicleData=null;}},300);
}

// SECTION TOGGLE
function toggleSection(id){document.getElementById(id).classList.toggle('collapsed');}

// RADIO CARDS
function selectRadio(el,groupId,value){
    document.getElementById(groupId).querySelectorAll('.radio-card').forEach(c=>c.classList.remove('selected'));
    el.classList.add('selected');el.querySelector('input').checked=true;
    if(groupId==='submitter-type')selectedSubmitterType=value;
    if(groupId==='insp-result')inspectionResult=value;
    if(groupId==='insp-type-sel')inspectionType=value;
    if(groupId==='brand-type-sel')brandType=value;
    if(groupId==='fleet-usage-sel')fleetUsageType=value;
    if(groupId==='ie-direction-sel')ieDirection=value;
    if(groupId==='mod-type-sel')modType=value;
}

// REPORT TYPE TOGGLE
function toggleCheck(el,type){
    el.classList.toggle('checked');const cb=el.querySelector('input');cb.checked=!cb.checked;
    if(cb.checked)selectedTypes.add(type);else selectedTypes.delete(type);
    document.querySelectorAll('.type-section').forEach(s=>{s.classList.toggle('active',selectedTypes.has(s.dataset.type));});
}
function toggleCheckSimple(el){el.classList.toggle('checked');const cb=el.querySelector('input');cb.checked=!cb.checked;}

// SEVERITY
function selectSeverity(el,level){
    document.querySelectorAll('#severity-sel .severity-btn').forEach(b=>b.className='severity-btn');
    el.classList.add('sel-'+level);selectedSeverity=level;
}

// IMPACT
function toggleImpact(el){el.classList.toggle('hit');const z=el.dataset.zone;if(selectedImpacts.has(z))selectedImpacts.delete(z);else selectedImpacts.add(z);}

// TOGGLES
function toggleDrivable(el){drivableState=!drivableState;el.classList.toggle('on',!drivableState);el.classList.toggle('red',!drivableState);}
function toggleGeneric(el,inputId){const inp=document.getElementById(inputId);const val=inp.value==='true'?'false':'true';inp.value=val;el.classList.toggle('on',val==='true');}

// CONFIRM
function toggleConfirm(){
    confirmed=!confirmed;const box=document.getElementById('confirm-box');
    box.style.borderColor=confirmed?'var(--accent)':'';box.style.background=confirmed?'var(--accent)':'';
    document.getElementById('btn-submit').disabled=!confirmed;
}

// PHOTOS
function handleFiles(files,cat){const max=5,maxS=5*1024*1024,ex=photoFiles[cat]||[];
    for(let i=0;i<files.length&&ex.length<max;i++){if(files[i].size>maxS||!files[i].type.startsWith('image/'))continue;ex.push(files[i]);}
    photoFiles[cat]=ex;renderPreviews(cat);
}
function handleDrop(e,cat){e.preventDefault();e.currentTarget.classList.remove('drag-over');handleFiles(e.dataTransfer.files,cat);}
function renderPreviews(cat){
    const c=document.getElementById('preview-'+cat);c.innerHTML='';
    photoFiles[cat].forEach((f,i)=>{const w=document.createElement('div');w.className='photo-thumb-wrap';
        const img=document.createElement('img');img.className='photo-thumb';img.src=URL.createObjectURL(f);
        const btn=document.createElement('button');btn.className='photo-remove';btn.innerHTML='&#10005;';
        btn.onclick=e=>{e.stopPropagation();photoFiles[cat].splice(i,1);renderPreviews(cat);};
        w.appendChild(img);w.appendChild(btn);c.appendChild(w);
    });
}

// GET SERVICE TYPES
function getServiceTypes(){const t=[];document.querySelectorAll('#svc-types .check-item').forEach(item=>{const cb=item.querySelector('input');if(item.classList.contains('checked')||cb.checked)t.push(cb.value);});return t;}

// BUILD REPORT DATA
function buildReportData(type){
    const d={};
    if(type==='accident'){
        d.date=document.getElementById('acc-date').value||null;
        d.severity=selectedSeverity||'minor';
        d.impact_point=Array.from(selectedImpacts).join(',')||'unknown';
        d.airbag_deployed=!!document.getElementById('acc-airbag')?.checked;
        d.structural_damage=!!document.getElementById('acc-structural')?.checked;
        d.flood_damage=!!document.getElementById('acc-flood')?.checked;
        d.fire_damage=!!document.getElementById('acc-fire')?.checked;
        d.hail_damage=!!document.getElementById('acc-hail')?.checked;
        d.theft_vandalism=!!document.getElementById('acc-theft')?.checked;
        d.towing_required=!!document.getElementById('acc-towing')?.checked;
        d.rollover=!!document.getElementById('acc-rollover')?.checked;
        d.total_loss=!!document.getElementById('acc-totalloss')?.checked;
        d.drivable=drivableState;
        d.estimated_cost=parseFloat(document.getElementById('acc-cost').value)||null;
        d.odometer_km=parseInt(document.getElementById('acc-odo').value)||null;
        d.accident_location=document.getElementById('acc-location').value.trim();
        d.police_report_number=document.getElementById('acc-police').value.trim();
        d.insurance_company=document.getElementById('acc-insurance-co').value.trim();
        d.insurance_claim_number=document.getElementById('acc-insurance-num').value.trim();
        d.description=document.getElementById('acc-desc').value.trim();
    }
    else if(type==='service'){
        d.date=document.getElementById('svc-date').value||null;
        d.odometer_km=parseInt(document.getElementById('svc-odo').value)||null;
        d.service_type=getServiceTypes().join(', ')||'other';
        d.facility_name=document.getElementById('svc-facility').value.trim();
        d.cost=parseFloat(document.getElementById('svc-cost').value)||null;
        d.parts_type=document.getElementById('svc-parts').value;
        d.description=document.getElementById('svc-desc').value.trim();
        d.ev_battery_soh=parseFloat(document.getElementById('svc-ev-soh').value)||null;
        d.ev_battery_kwh=parseFloat(document.getElementById('svc-ev-kwh').value)||null;
        d.ev_service_type=document.getElementById('svc-ev-type').value;
    }
    else if(type==='ownership'){
        d.date=document.getElementById('own-date').value||null;
        d.sale_price=parseFloat(document.getElementById('own-price').value)||null;
        d.odometer_km=parseInt(document.getElementById('own-odo').value)||null;
        d.previous_owner_type=document.getElementById('own-prev').value;
        d.new_owner_type=document.getElementById('own-new').value;
        d.province=document.getElementById('own-province').value;
        d.usage_type=document.getElementById('own-usage').value;
    }
    else if(type==='inspection'){
        d.date=document.getElementById('insp-date').value||null;
        d.result=inspectionResult||'pass';
        d.inspection_type=inspectionType||'saaq_mecanique';
        d.odometer_km=parseInt(document.getElementById('insp-odo').value)||null;
        d.inspector_name=document.getElementById('insp-inspector').value.trim();
        d.facility_name=document.getElementById('insp-facility').value.trim();
        d.facility_permit=document.getElementById('insp-permit').value.trim();
        d.notes=document.getElementById('insp-notes').value.trim();
    }
    else if(type==='recall_completion'){
        d.recall_number=document.getElementById('rec-number').value.trim();
        d.date=document.getElementById('rec-date').value||null;
        d.facility_name=document.getElementById('rec-facility').value.trim();
        d.component=document.getElementById('rec-component').value.trim();
        d.remedy_type=document.getElementById('rec-remedy').value;
        d.recall_description=document.getElementById('rec-desc').value.trim();
        d.odometer_km=parseInt(document.getElementById('rec-odo').value)||null;
    }
    else if(type==='title_brand'){
        d.brand_type=brandType||'clean';
        d.date=document.getElementById('brand-date').value||null;
        d.province=document.getElementById('brand-province').value;
        d.insurance_company=document.getElementById('brand-insurance').value.trim();
        d.total_loss_amount=parseFloat(document.getElementById('brand-amount').value)||null;
        d.source=document.getElementById('brand-source').value.trim();
        d.notes=document.getElementById('brand-notes').value.trim();
    }
    else if(type==='lien'){
        d.lien_holder=document.getElementById('lien-holder').value.trim();
        d.lien_type=document.getElementById('lien-type').value;
        d.lien_amount=parseFloat(document.getElementById('lien-amount').value)||null;
        d.registration_date=document.getElementById('lien-reg-date').value||null;
        d.discharge_date=document.getElementById('lien-discharge-date').value||null;
        d.lien_status=document.getElementById('lien-status').value;
        d.province=document.getElementById('lien-province').value;
        d.registration_number=document.getElementById('lien-reg-num').value.trim();
        d.notes=document.getElementById('lien-notes').value.trim();
    }
    else if(type==='theft'){
        d.date_stolen=document.getElementById('theft-date-stolen').value||null;
        d.date_recovered=document.getElementById('theft-date-recovered').value||null;
        d.police_report_number=document.getElementById('theft-police').value.trim();
        d.police_jurisdiction=document.getElementById('theft-jurisdiction').value.trim();
        d.recovery_location=document.getElementById('theft-recovery-loc').value.trim();
        d.condition_at_recovery=document.getElementById('theft-condition').value;
        d.insurance_claim=document.getElementById('theft-insurance').value==='true';
        d.parts_missing=document.getElementById('theft-parts').value.trim();
        d.notes=document.getElementById('theft-notes').value.trim();
    }
    else if(type==='obd_diagnostic'){
        d.date=document.getElementById('obd-date').value||null;
        d.odometer_km=parseInt(document.getElementById('obd-odo').value)||null;
        d.ecu_odometer_km=parseInt(document.getElementById('obd-ecu-odo').value)||null;
        d.scan_tool=document.getElementById('obd-tool').value.trim();
        d.mil_status=document.getElementById('obd-mil').value==='true';
        d.dtc_active=document.getElementById('obd-dtc-active').value.trim();
        d.dtc_pending=document.getElementById('obd-dtc-pending').value.trim();
        d.dtc_permanent=document.getElementById('obd-dtc-permanent').value.trim();
        const monitors={};document.querySelectorAll('#obd-monitors .check-item').forEach(item=>{const cb=item.querySelector('input');monitors[cb.value]=item.classList.contains('checked');});
        d.readiness_monitors=monitors;
        d.notes=document.getElementById('obd-notes').value.trim();
    }
    else if(type==='auction'){
        d.date=document.getElementById('auc-date').value||null;
        d.auction_house=document.getElementById('auc-house').value;
        d.auction_location=document.getElementById('auc-location').value.trim();
        d.lot_number=document.getElementById('auc-lot').value.trim();
        d.sale_price=parseFloat(document.getElementById('auc-price').value)||null;
        d.sale_type=document.getElementById('auc-sale-type').value;
        d.seller_type=document.getElementById('auc-seller').value;
        d.naaa_grade=parseFloat(document.getElementById('auc-grade').value)||null;
        d.exterior_grade=document.getElementById('auc-ext').value;
        d.interior_grade=document.getElementById('auc-int').value;
        d.mechanical_grade=document.getElementById('auc-mech').value;
        d.tire_tread_fl=parseFloat(document.getElementById('auc-tire-fl').value)||null;
        d.tire_tread_fr=parseFloat(document.getElementById('auc-tire-fr').value)||null;
        d.tire_tread_rl=parseFloat(document.getElementById('auc-tire-rl').value)||null;
        d.tire_tread_rr=parseFloat(document.getElementById('auc-tire-rr').value)||null;
        d.odor=document.getElementById('auc-odor').value;
        d.keys_count=parseInt(document.getElementById('auc-keys').value)||null;
        d.run_drive=document.getElementById('auc-run').value==='true';
        d.damage_announcements=document.getElementById('auc-damage').value.trim();
        d.notes=document.getElementById('auc-notes').value.trim();
    }
    else if(type==='fleet_history'){
        d.usage_type=fleetUsageType||'';
        d.company_name=document.getElementById('fleet-company').value.trim();
        d.province=document.getElementById('fleet-province').value;
        d.date_entered=document.getElementById('fleet-date-in').value||null;
        d.date_left=document.getElementById('fleet-date-out').value||null;
        d.mileage_during=parseInt(document.getElementById('fleet-mileage').value)||null;
        d.estimated_drivers=parseInt(document.getElementById('fleet-drivers').value)||null;
        d.notes=document.getElementById('fleet-notes').value.trim();
    }
    else if(type==='import_export'){
        d.direction=ieDirection||'import';
        d.date=document.getElementById('ie-date').value||null;
        d.country_origin=document.getElementById('ie-origin').value;
        d.country_destination=document.getElementById('ie-dest').value;
        d.riv_number=document.getElementById('ie-riv').value.trim();
        d.customs_declaration=document.getElementById('ie-customs').value.trim();
        d.odometer_at_import=parseInt(document.getElementById('ie-odo').value)||null;
        d.odometer_unit=document.getElementById('ie-odo-unit').value;
        d.tc_compliance=document.getElementById('ie-tc').value==='true';
        d.recalls_cleared=document.getElementById('ie-recalls').value==='true';
        d.notes=document.getElementById('ie-notes').value.trim();
    }
    else if(type==='emissions'){
        d.date=document.getElementById('em-date').value||null;
        d.test_type=document.getElementById('em-type').value;
        d.result=document.getElementById('em-result').value;
        d.station_name=document.getElementById('em-station').value.trim();
        d.station_number=document.getElementById('em-station-num').value.trim();
        d.hc_ppm=parseFloat(document.getElementById('em-hc').value)||null;
        d.co_percent=parseFloat(document.getElementById('em-co').value)||null;
        d.nox_ppm=parseFloat(document.getElementById('em-nox').value)||null;
        d.co2_percent=parseFloat(document.getElementById('em-co2').value)||null;
        d.o2_percent=parseFloat(document.getElementById('em-o2').value)||null;
        d.certificate_number=document.getElementById('em-cert').value.trim();
        d.certificate_expiry=document.getElementById('em-cert-exp').value||null;
        d.notes=document.getElementById('em-notes').value.trim();
    }
    else if(type==='modification'){
        d.mod_type=modType||'';
        d.date=document.getElementById('mod-date').value||null;
        d.installed_by=document.getElementById('mod-installer').value.trim();
        d.part_brand=document.getElementById('mod-brand').value.trim();
        d.part_number=document.getElementById('mod-part-num').value.trim();
        d.homologated=document.getElementById('mod-homolog').value==='true';
        d.saaq_approved=document.getElementById('mod-saaq').value==='true';
        d.insurance_notified=document.getElementById('mod-insurance').value==='true';
        d.description=document.getElementById('mod-desc').value.trim();
        d.notes=document.getElementById('mod-notes').value.trim();
    }
    return d;
}

// SUBMIT
async function submitForm(){
    const vin=document.getElementById('vin-input').value.trim().toUpperCase();
    if(!vin||vin.length!==17){showStatus('Veuillez entrer un VIN valide de 17 caractères.','red');return;}
    if(!selectedSubmitterType){showStatus('Veuillez indiquer qui vous êtes.','red');return;}
    if(selectedTypes.size===0){showStatus('Veuillez sélectionner au moins un type de rapport.','red');return;}

    const btn=document.getElementById('btn-submit');btn.disabled=true;
    btn.innerHTML='<span class="spinner"></span>Soumission en cours...';
    const submitter={name:document.getElementById('sub-name').value.trim(),email:document.getElementById('sub-email').value.trim(),type:selectedSubmitterType,company:document.getElementById('sub-company').value.trim()};

    let lastResult=null,errorOccurred=false;
    for(const rt of selectedTypes){
        const data=buildReportData(rt);
        try{
            const r=await fetch(`${API_BASE}/api/collecte/submit`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vin,report_type:rt,submitter,data})});
            const result=await r.json();
            if(result.error){showStatus(`Erreur (${rt}): ${result.error}`,'red');errorOccurred=true;break;}
            lastResult=result;
            if(photoFiles[rt]&&photoFiles[rt].length>0){
                const fd=new FormData();fd.append('submission_id',result.submission_id);
                photoFiles[rt].forEach(f=>fd.append('photos',f));
                try{await fetch(`${API_BASE}/api/collecte/upload`,{method:'POST',body:fd});}catch(e){}
            }
        }catch(e){showStatus('Erreur de connexion au serveur.','red');errorOccurred=true;break;}
    }
    if(!errorOccurred&&lastResult){
        document.getElementById('success-ref').textContent=`REF: AVQ-${String(lastResult.submission_id).padStart(6,'0')}`;
        document.getElementById('success-hash').textContent=lastResult.integrity_hash;
        document.getElementById('success-overlay').classList.add('show');
    }
    btn.disabled=false;btn.textContent='Soumettre la contribution';
}

function showStatus(msg,color){const el=document.getElementById('submit-status');el.innerHTML=`<span style="color:var(--${color})">${msg}</span>`;setTimeout(()=>el.innerHTML='',5000);}

// RESET
function resetForm(){
    document.getElementById('success-overlay').classList.remove('show');
    document.getElementById('vin-input').value='';document.getElementById('vehicle-card').classList.remove('show');
    vehicleData=null;selectedTypes.clear();selectedSeverity=null;selectedImpacts.clear();
    selectedSubmitterType=null;inspectionResult=null;inspectionType=null;brandType=null;
    fleetUsageType=null;ieDirection=null;modType=null;
    confirmed=false;drivableState=true;
    photoFiles={accident:[],service:[],ownership:[],inspection:[]};
    document.querySelectorAll('.check-item.checked').forEach(el=>el.classList.remove('checked'));
    document.querySelectorAll('.check-item input').forEach(cb=>cb.checked=false);
    document.querySelectorAll('.radio-card.selected').forEach(el=>el.classList.remove('selected'));
    document.querySelectorAll('.severity-btn').forEach(b=>b.className='severity-btn');
    document.querySelectorAll('.impact-zone.hit').forEach(el=>el.classList.remove('hit'));
    document.querySelectorAll('input[type="text"],input[type="number"],input[type="email"],input[type="date"],textarea').forEach(el=>el.value='');
    document.querySelectorAll('select').forEach(el=>el.selectedIndex=0);
    ['accident','service','ownership','inspection'].forEach(c=>{const p=document.getElementById('preview-'+c);if(p)p.innerHTML='';});
    document.getElementById('confirm-box').style.borderColor='';document.getElementById('confirm-box').style.background='';
    document.getElementById('btn-submit').disabled=true;
    document.querySelectorAll('.type-section').forEach(s=>s.classList.remove('active'));
    document.getElementById('vin-status').innerHTML='';
    document.querySelectorAll('.toggle.on').forEach(t=>{t.classList.remove('on','red');});
    window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
