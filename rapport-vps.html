<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoVerif QC — Demo Rapport Vehiculaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #080e1a;
            --primary-light: #111b2e;
            --accent: #00b4d8;
            --accent-dark: #0096b7;
            --gold: #f4a61c;
            --gold-dark: #d4910a;
            --red: #e63946;
            --green: #2a9d8f;
            --bg: #0b1120;
            --bg-light: #0f1729;
            --card: rgba(255,255,255,0.04);
            --text: #e8ecf2;
            --text-light: #8892a4;
            --border: rgba(255,255,255,0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg); color: var(--text);
            line-height: 1.6; overflow-x: hidden;
        }

        /* NAV */
        nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            background: rgba(15, 43, 70, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0 40px; display: flex; align-items: center;
            justify-content: space-between; height: 64px;
        }
        .nav-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.6rem; font-weight: 700; color: white;
            letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 10px; text-decoration: none;
        }
        .nav-logo .logo-icon {
            width: 38px; height: 38px; flex-shrink: 0;
        }
        .nav-logo .nav-auto {
            color: white; font-weight: 800; letter-spacing: -0.5px;
        }
        .nav-logo .nav-verif {
            background: linear-gradient(135deg, #00b4d8, #2a9d8f);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        .nav-logo .nav-qc {
            font-size: 0.5rem; font-weight: 800;
            background: linear-gradient(135deg, #f4a61c, #e63946);
            color: white; -webkit-text-fill-color: white;
            padding: 2px 6px; border-radius: 4px;
            margin-left: 5px; vertical-align: middle; letter-spacing: 1px;
        }
        .nav-right { display: flex; gap: 12px; }
        .nav-link {
            color: rgba(255,255,255,0.6); text-decoration: none;
            font-size: 0.85rem; font-weight: 500; padding: 6px 14px;
            border-radius: 8px; transition: all 0.3s;
        }
        .nav-link:hover { color: white; background: rgba(255,255,255,0.08); }
        .nav-badge {
            background: var(--gold); color: var(--primary);
            padding: 6px 16px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 700; text-decoration: none;
        }

        /* PARTICLES CANVAS */
        #particles {
            position: fixed; inset: 0; z-index: 0; pointer-events: none;
        }

        /* SCANNER HERO */
        .scanner-hero {
            min-height: 100vh; position: relative; z-index: 1;
            background: linear-gradient(160deg, #060e1a 0%, var(--primary) 40%, #0d2137 100%);
            display: flex; align-items: center; justify-content: center;
            padding: 100px 20px 60px; overflow: hidden;
        }
        .scanner-hero::before {
            content: ''; position: absolute; inset: 0;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(0,180,216,0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(244,166,28,0.08) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 80%, rgba(42,157,143,0.06) 0%, transparent 40%);
        }
        .glow-orb {
            position: absolute; border-radius: 50%; filter: blur(80px);
            opacity: 0.15; pointer-events: none;
        }
        .glow-orb.blue { width: 400px; height: 400px; background: var(--accent); top: 10%; left: 5%; }
        .glow-orb.gold { width: 300px; height: 300px; background: var(--gold); bottom: 10%; right: 10%; }

        .scanner-wrap {
            position: relative; max-width: 580px; width: 100%; z-index: 2;
        }
        .scanner-header {
            text-align: center; margin-bottom: 40px;
        }
        .scanner-header .badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(0,180,216,0.12); border: 1px solid rgba(0,180,216,0.25);
            padding: 6px 18px; border-radius: 30px; font-size: 0.8rem;
            color: var(--accent); font-weight: 600; margin-bottom: 20px;
        }
        .badge .live-dot {
            width: 7px; height: 7px; border-radius: 50%; background: var(--green);
            animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100%{opacity:1}50%{opacity:.3} }
        .scanner-header h1 {
            font-size: clamp(1.8rem,4.5vw,2.6rem); font-weight: 900;
            color: white; line-height: 1.1; margin-bottom: 14px; letter-spacing: -1px;
        }
        .scanner-header h1 .grad {
            background: linear-gradient(135deg, var(--accent), var(--gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .scanner-header p { color: rgba(255,255,255,0.5); font-size: 0.95rem; }

        /* GLASS CARD */
        .glass-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px; padding: 36px;
            backdrop-filter: blur(24px);
            box-shadow: 0 8px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.06);
            position: relative; z-index: 10;
        }
        .input-label {
            display: block; color: rgba(255,255,255,0.5); font-size: 0.72rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 8px;
        }
        .vin-input {
            width: 100%; padding: 18px 20px;
            background: rgba(255,255,255,0.06);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 14px; color: white;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 1.35rem; font-weight: 700;
            letter-spacing: 4px; text-transform: uppercase;
            text-align: center; outline: none; transition: all 0.4s;
        }
        .vin-input::placeholder {
            color: rgba(255,255,255,0.18); letter-spacing: 2px; font-size: 0.95rem;
        }
        .vin-input:focus {
            border-color: var(--accent);
            background: rgba(0,180,216,0.06);
            box-shadow: 0 0 40px rgba(0,180,216,0.12), 0 0 0 4px rgba(0,180,216,0.08);
        }

        .photo-zone {
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 14px; padding: 20px; text-align: center;
            cursor: pointer; transition: all 0.3s; margin: 20px 0 28px;
        }
        .photo-zone:hover {
            border-color: var(--accent); background: rgba(0,180,216,0.04);
        }
        .photo-zone .cam { font-size: 1.8rem; margin-bottom: 4px; }
        .photo-zone p { color: rgba(255,255,255,0.35); font-size: 0.82rem; }

        .btn-scan {
            width: 100%; padding: 18px; border: none; border-radius: 14px;
            font-family: 'Inter'; font-size: 1.1rem; font-weight: 800;
            cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;
        }
        .btn-scan.primary {
            background: linear-gradient(135deg, var(--accent), #0096b7);
            color: white;
        }
        .btn-scan.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,180,216,0.35);
        }
        .btn-scan.gold {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--primary); margin-top: 12px; font-size: 0.95rem;
        }
        .btn-scan .shimmer {
            position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer { 100%{left:100%} }

        /* ========== LOADING ========== */
        .loading-screen {
            display: none; position: fixed; inset: 0;
            background: #060e1a; z-index: 3000;
            flex-direction: column; align-items: center;
            justify-content: center; padding: 40px 20px;
        }
        .loading-screen.active { display: flex; }

        .scanner-anim {
            width: 160px; height: 160px; position: relative;
            margin-bottom: 36px;
        }
        .ring-outer {
            position: absolute; inset: 0;
            border: 3px solid rgba(0,180,216,0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }
        .ring-middle {
            position: absolute; inset: 14px;
            border: 3px solid rgba(244,166,28,0.1);
            border-bottom: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 2s linear infinite reverse;
        }
        .ring-inner {
            position: absolute; inset: 28px;
            border: 3px solid rgba(42,157,143,0.1);
            border-top: 3px solid var(--green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .ring-center {
            position: absolute; inset: 42px;
            background: rgba(0,180,216,0.06);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 900; color: var(--accent);
            font-family: 'Inter';
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-title {
            font-size: 1.4rem; font-weight: 800; color: white;
            margin-bottom: 6px; text-align: center;
        }
        .loading-vin {
            font-family: monospace; font-size: 1rem;
            color: var(--accent); font-weight: 700;
            letter-spacing: 3px; margin-bottom: 36px;
        }

        .steps-list { max-width: 460px; width: 100%; }
        .step-row {
            display: flex; align-items: center; gap: 14px;
            padding: 9px 0; opacity: 0.2; transition: all 0.6s;
        }
        .step-row.active { opacity: 1; }
        .step-row.done { opacity: 0.5; }
        .step-dot {
            width: 30px; height: 30px; border-radius: 50%;
            background: rgba(255,255,255,0.06); border: 2px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; color: rgba(255,255,255,0.4);
            font-weight: 700; flex-shrink: 0; transition: all 0.5s;
        }
        .step-row.active .step-dot {
            background: var(--accent); border-color: var(--accent);
            color: white;
            box-shadow: 0 0 20px rgba(0,180,216,0.4);
            animation: pulse-dot 1.2s infinite;
        }
        .step-row.done .step-dot {
            background: var(--green); border-color: var(--green); color: white;
        }
        @keyframes pulse-dot {
            0%,100%{box-shadow:0 0 0 0 rgba(0,180,216,0.4)}
            50%{box-shadow:0 0 0 10px rgba(0,180,216,0)}
        }
        .step-text {
            color: rgba(255,255,255,0.4); font-size: 0.85rem;
            font-weight: 500; transition: all 0.5s;
        }
        .step-row.active .step-text { color: white; font-weight: 600; }

        .progress-track {
            max-width: 460px; width: 100%; height: 3px;
            background: rgba(255,255,255,0.06); border-radius: 3px;
            margin-top: 28px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--gold), var(--green));
            border-radius: 3px; transition: width 0.6s ease;
        }
        .loading-percent {
            color: rgba(255,255,255,0.3); font-size: 0.8rem;
            margin-top: 10px; font-weight: 600;
        }

        /* ========== REPORT ========== */
        .report-page {
            display: none; padding: 90px 20px 60px;
        }
        .report-page.active { display: block; }

        .report-container { max-width: 860px; margin: 0 auto; }

        /* SUCCESS BANNER */
        .success-banner {
            text-align: center; margin-bottom: 40px;
        }
        .success-check {
            width: 72px; height: 72px; border-radius: 50%;
            background: linear-gradient(135deg, var(--green), #1a8a7e);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; color: white; margin: 0 auto 16px;
            box-shadow: 0 8px 30px rgba(42,157,143,0.3);
        }
        .success-banner h2 {
            font-size: 1.6rem; font-weight: 800; margin-bottom: 6px; color: white;
        }
        .success-banner p { color: var(--text-light); font-size: 0.92rem; }

        /* REPORT DOCUMENT */
        .report-doc {
            background: rgba(255,255,255,0.03); border-radius: 24px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 4px 60px rgba(0,0,0,0.3);
        }

        /* DOC HEADER */
        .doc-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0d2137 60%, var(--primary-light) 100%);
            padding: 36px 40px; color: white;
            display: flex; align-items: center; justify-content: space-between;
            gap: 24px; flex-wrap: wrap; position: relative; overflow: hidden;
        }
        .doc-header::after {
            content: ''; position: absolute; right: -40px; top: -40px;
            width: 200px; height: 200px; border-radius: 50%;
            background: rgba(0,180,216,0.06);
        }
        .vehicle-info h3 {
            font-size: 1.6rem; font-weight: 900; margin-bottom: 4px;
        }
        .vehicle-info .sub {
            color: rgba(255,255,255,0.55); font-size: 0.88rem;
        }
        .vehicle-info .vin-tag {
            display: inline-block; margin-top: 8px;
            background: rgba(0,180,216,0.15); border: 1px solid rgba(0,180,216,0.25);
            padding: 4px 14px; border-radius: 8px;
            font-family: monospace; font-size: 0.78rem;
            color: var(--accent); letter-spacing: 2px; font-weight: 600;
        }

        /* VEHICLE IMAGE SHOWCASE */
        .vehicle-image-band {
            position: relative; overflow: hidden;
            background: linear-gradient(180deg, #0a1628 0%, #0d1f35 50%, #0a1628 100%);
            padding: 24px 40px;
            display: flex; align-items: center; justify-content: center;
            min-height: 220px;
            border-bottom: 1px solid var(--border);
        }
        .vehicle-image-band::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at 50% 80%, rgba(0,180,216,0.06) 0%, transparent 60%);
        }
        .vehicle-image-wrap {
            position: relative; z-index: 1; text-align: center;
            max-width: 600px; width: 100%;
        }
        .vehicle-image-wrap img {
            width: 100%; max-width: 520px; height: auto;
            filter: drop-shadow(0 12px 40px rgba(0,0,0,0.5));
            transition: transform 0.5s ease;
        }
        .vehicle-image-wrap img:hover { transform: scale(1.03); }
        .vehicle-image-angles {
            display: flex; justify-content: center; gap: 6px;
            margin-top: 12px;
        }
        .angle-btn {
            width: 48px; height: 32px; border-radius: 6px;
            border: 1px solid var(--border); background: var(--card);
            cursor: pointer; overflow: hidden; opacity: 0.5;
            transition: all 0.3s;
        }
        .angle-btn:hover, .angle-btn.active {
            opacity: 1; border-color: var(--accent);
            box-shadow: 0 0 8px rgba(0,180,216,0.2);
        }
        .angle-btn img { width: 100%; height: 100%; object-fit: cover; }
        .vehicle-image-label {
            font-size: 0.65rem; color: var(--text-light); margin-top: 8px;
            text-transform: uppercase; letter-spacing: 1.5px;
        }
        .vehicle-image-band.hidden { display: none; }

        /* SCORE GAUGE — V3-A Center Score */
        .score-gauge {
            position: relative; z-index: 1;
            width: 160px; height: 160px;
            flex-shrink: 0;
        }
        .score-gauge .sg-conic {
            position: absolute; inset: 1px; border-radius: 50%;
            border: 1.5px solid transparent;
            background: linear-gradient(#060a14, #060a14) padding-box,
                        conic-gradient(from 180deg, rgba(0,180,216,0.35), rgba(42,157,143,0.2), rgba(244,166,28,0.35), rgba(230,57,70,0.2), rgba(0,180,216,0.35)) border-box;
            animation: sgConicSpin 18s linear infinite;
        }
        @keyframes sgConicSpin { to { rotate: -360deg; } }
        .score-gauge .sg-outer {
            position: absolute; inset: 6px; border-radius: 50%;
            border: 2.5px solid transparent;
            background: linear-gradient(#060a14, #060a14) padding-box,
                        linear-gradient(135deg, #00b4d8, #2a9d8f, #f4a61c) border-box;
            animation: sgRingGlow 4s ease-in-out infinite;
        }
        @keyframes sgRingGlow {
            0%, 100% { box-shadow: 0 0 12px rgba(0,180,216,0.12); }
            50% { box-shadow: 0 0 24px rgba(0,180,216,0.25), 0 0 36px rgba(244,166,28,0.08); }
        }
        .score-gauge .sg-accent {
            position: absolute; inset: 12px; border-radius: 50%;
            border: 1px solid transparent;
            background: linear-gradient(#060a14, #060a14) padding-box,
                        conic-gradient(from 0deg, #00b4d8, #2a9d8f, #f4a61c, #e63946, #00b4d8) border-box;
            animation: sgAccentSpin 12s linear infinite;
        }
        @keyframes sgAccentSpin { to { rotate: 360deg; } }
        .score-gauge .sg-inner {
            position: absolute; inset: 16px; border-radius: 50%;
            border: 1px solid rgba(0,180,216,0.15);
        }
        .score-gauge .sg-dial {
            position: absolute; inset: 20px; border-radius: 50%;
            background: radial-gradient(circle at 42% 38%, #0e1a2e, #060a14 70%);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .score-gauge .sg-geo { position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; }
        .score-gauge .sg-digital {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; z-index: 15;
        }
        .score-gauge .sg-score-big {
            font-family: 'Orbitron', 'Space Grotesk', monospace;
            font-size: 1.6rem; font-weight: 900;
            letter-spacing: 2px; line-height: 1;
            display: block;
            color: #00e5ff;
            text-shadow: 0 0 12px rgba(0,229,255,0.4);
        }
        .score-gauge .sg-score-sub {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.35rem; font-weight: 700;
            color: rgba(0,180,216,0.5);
            letter-spacing: 2px; text-transform: uppercase;
            display: block; margin-top: 3px;
        }
        .score-gauge .sg-score-tag {
            margin-top: 4px; font-size: 0.55rem; font-weight: 800;
            color: var(--green); background: rgba(42,157,143,0.15);
            padding: 2px 8px; border-radius: 10px;
            display: inline-block;
        }

        /* DOC BODY */
        .doc-body { padding: 36px 40px; }

        /* VERDICT */
        .verdict-bar {
            display: flex; align-items: center; gap: 16px;
            background: linear-gradient(135deg, rgba(42,157,143,0.06), rgba(42,157,143,0.02));
            border: 1px solid rgba(42,157,143,0.15);
            border-radius: 16px; padding: 20px 24px; margin-bottom: 32px;
        }
        .verdict-icon {
            width: 50px; height: 50px; border-radius: 50%;
            background: linear-gradient(135deg, var(--green), #1a8a7e);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: white; flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(42,157,143,0.25);
        }
        .verdict-content h4 {
            font-size: 1.05rem; font-weight: 800; color: var(--green);
            margin-bottom: 2px; text-shadow: 0 0 20px rgba(42,157,143,0.2);
        }
        .verdict-content p { font-size: 0.85rem; color: var(--text-light); }

        /* SECTION TITLES */
        .section-head {
            display: flex; align-items: center; gap: 10px;
            font-size: 0.95rem; font-weight: 800; margin-bottom: 16px;
            margin-top: 32px; color: white;
        }
        .section-head .ico {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem;
        }
        .section-head .ico.blue { background: rgba(0,180,216,0.1); }
        .section-head .ico.green { background: rgba(42,157,143,0.1); }
        .section-head .ico.gold { background: rgba(244,166,28,0.1); }
        .section-head .ico.red { background: rgba(230,57,70,0.1); }

        /* DATA CARDS */
        .data-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }
        .d-card {
            background: rgba(255,255,255,0.04); border-radius: 14px;
            padding: 16px; transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .d-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,180,216,0.08);
            border-color: rgba(0,180,216,0.15);
        }
        .d-card .d-label {
            font-size: 0.65rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; color: var(--text-light); margin-bottom: 4px;
        }
        .d-card .d-val {
            font-size: 1.05rem; font-weight: 800; color: white;
        }
        .d-val.ok { color: var(--green); }
        .d-val.warn { color: var(--gold-dark); }
        .d-val.bad { color: var(--red); }

        /* CHECK LIST */
        .check-list { list-style: none; margin-top: 8px; }
        .check-row {
            display: flex; align-items: flex-start; gap: 12px;
            padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.04);
            transition: all 0.3s;
        }
        .check-row:last-child { border-bottom: none; }
        .check-row:hover { background: rgba(0,180,216,0.04); border-radius: 8px; padding-left: 8px; }
        .chk {
            width: 26px; height: 26px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.72rem; font-weight: 800; flex-shrink: 0; margin-top: 2px;
        }
        .chk.pass { background: rgba(42,157,143,0.1); color: var(--green); }
        .chk.warn { background: rgba(244,166,28,0.1); color: var(--gold-dark); }
        .chk.fail { background: rgba(230,57,70,0.1); color: var(--red); }
        .check-text { font-size: 0.88rem; color: var(--text-light); }
        .check-text strong { font-weight: 700; color: white; }

        /* VALEUR BOX */
        .valeur-card {
            background: linear-gradient(135deg, rgba(244,166,28,0.05), rgba(0,180,216,0.05));
            border: 1px solid rgba(244,166,28,0.15);
            border-radius: 18px; padding: 28px; text-align: center;
            margin-top: 32px; position: relative; overflow: hidden;
        }
        .valeur-card::before {
            content: ''; position: absolute; top: -50%; right: -20%;
            width: 200px; height: 200px; border-radius: 50%;
            background: rgba(244,166,28,0.04);
        }
        .valeur-title {
            font-size: 0.72rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--text-light); margin-bottom: 8px;
        }
        .valeur-amount {
            font-size: 3rem; font-weight: 900; color: var(--gold);
            line-height: 1; position: relative; z-index: 1;
            text-shadow: 0 0 30px rgba(244,166,28,0.2);
        }
        .valeur-range {
            font-size: 0.85rem; color: var(--text-light); margin-top: 6px;
        }

        /* TIMELINE (odometer, ownership) */
        .timeline-track {
            position: relative; padding-left: 28px; margin-top: 12px;
        }
        .timeline-track::before {
            content: ''; position: absolute; left: 8px; top: 0; bottom: 0;
            width: 2px; background: linear-gradient(180deg, var(--accent), var(--gold), var(--green));
            border-radius: 2px; opacity: 0.3;
        }
        .tl-entry {
            position: relative; padding: 10px 0 10px 0;
        }
        .tl-entry::before {
            content: ''; position: absolute; left: -24px; top: 14px;
            width: 10px; height: 10px; border-radius: 50%;
            background: var(--accent); border: 2px solid rgba(0,180,216,0.3);
        }
        .tl-date { font-size: 0.68rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }
        .tl-info { font-size: 0.85rem; color: var(--text-light); margin-top: 2px; }
        .tl-info strong { color: white; }
        .tl-info .tl-km { font-family: 'Orbitron', monospace; font-size: 0.8rem; color: var(--gold); font-weight: 700; }

        /* DETAIL TABLE (RDPRM, specs) */
        .detail-table {
            width: 100%; border-collapse: collapse; margin-top: 12px;
        }
        .detail-table tr { border-bottom: 1px solid rgba(255,255,255,0.04); }
        .detail-table tr:last-child { border-bottom: none; }
        .detail-table td {
            padding: 10px 12px; font-size: 0.85rem; vertical-align: top;
        }
        .detail-table .dt-label {
            color: var(--text-light); font-weight: 600; width: 40%;
            font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .detail-table .dt-val { color: white; font-weight: 700; }
        .detail-table .dt-val.ok { color: var(--green); }
        .detail-table .dt-val.warn { color: var(--gold); }
        .detail-table .dt-val.bad { color: var(--red); }

        /* RECALL CARD */
        .recall-card {
            background: rgba(244,166,28,0.04); border: 1px solid rgba(244,166,28,0.12);
            border-radius: 14px; padding: 16px 20px; margin-top: 10px;
        }
        .recall-card .rc-head {
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
        }
        .recall-card .rc-badge {
            font-size: 0.6rem; font-weight: 800; text-transform: uppercase;
            padding: 3px 10px; border-radius: 6px; letter-spacing: 1px;
        }
        .rc-badge.open { background: rgba(244,166,28,0.15); color: var(--gold); }
        .rc-badge.fixed { background: rgba(42,157,143,0.15); color: var(--green); }
        .recall-card .rc-title { font-size: 0.9rem; font-weight: 800; color: white; }
        .recall-card .rc-detail { font-size: 0.8rem; color: var(--text-light); line-height: 1.6; margin-top: 4px; }
        .recall-card .rc-meta { font-size: 0.7rem; color: var(--text-light); margin-top: 8px; display: flex; gap: 16px; flex-wrap: wrap; }
        .recall-card .rc-meta span { display: inline-flex; align-items: center; gap: 4px; }

        /* SCORE BREAKDOWN */
        .score-breakdown {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px;
        }
        .sb-item {
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 14px 16px; border: 1px solid rgba(255,255,255,0.05);
        }
        .sb-item .sb-label { font-size: 0.68rem; font-weight: 700; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
        .sb-item .sb-bar { height: 4px; background: rgba(255,255,255,0.06); border-radius: 4px; overflow: hidden; margin-bottom: 4px; }
        .sb-item .sb-fill { height: 100%; border-radius: 4px; transition: width 1.5s ease; }
        .sb-item .sb-fill.green { background: linear-gradient(90deg, var(--green), #2ed8c4); }
        .sb-item .sb-fill.gold { background: linear-gradient(90deg, var(--gold), #ffc94d); }
        .sb-item .sb-fill.cyan { background: linear-gradient(90deg, var(--accent), #00e5ff); }
        .sb-item .sb-fill.red { background: linear-gradient(90deg, var(--red), #ff6b7a); }
        .sb-item .sb-score { font-family: 'Orbitron', monospace; font-size: 0.85rem; font-weight: 700; }
        .sb-item .sb-score.ok { color: var(--green); }
        .sb-item .sb-score.warn { color: var(--gold); }

        /* CRASH TEST */
        .crash-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px; margin-top: 12px;
        }
        .crash-card {
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 14px; text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .crash-card .cc-stars { font-size: 1.1rem; margin-bottom: 4px; letter-spacing: 2px; }
        .crash-card .cc-label { font-size: 0.68rem; color: var(--text-light); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .crash-card .cc-score { font-family: 'Orbitron', monospace; font-size: 0.9rem; font-weight: 700; color: var(--green); margin-top: 4px; }

        /* LOI CITRON */
        .citron-box {
            background: linear-gradient(135deg, rgba(0,180,216,0.04), rgba(42,157,143,0.04));
            border: 1px solid rgba(0,180,216,0.12);
            border-radius: 16px; padding: 20px 24px; margin-top: 12px;
        }
        .citron-box h4 { font-size: 0.9rem; font-weight: 800; color: var(--accent); margin-bottom: 8px; }
        .citron-box .citron-items { list-style: none; }
        .citron-box .citron-items li {
            font-size: 0.82rem; color: var(--text-light); padding: 5px 0;
            display: flex; align-items: flex-start; gap: 8px;
        }
        .citron-box .citron-items li .ci-icon { flex-shrink: 0; font-size: 0.75rem; margin-top: 2px; }

        /* SOURCES BADGE */
        .source-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06);
            padding: 4px 12px; border-radius: 20px;
            font-size: 0.65rem; font-weight: 700; color: var(--text-light);
            margin: 2px;
        }
        .source-badge .sb-dot { width: 5px; height: 5px; border-radius: 50%; }
        .source-badge .sb-dot.live { background: var(--green); box-shadow: 0 0 6px rgba(42,157,143,0.6); animation: blink 2s infinite; }
        .source-badge .sb-dot.api { background: var(--accent); }
        .source-badge .sb-dot.gov { background: var(--gold); }
        @keyframes blink { 0%,100%{opacity:1}50%{opacity:.3} }

        /* ENTRETIEN */
        .entretien-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 10px; margin-top: 12px;
        }
        .ent-card {
            background: rgba(255,255,255,0.04); border-radius: 12px;
            padding: 14px 16px; display: flex; align-items: center; gap: 12px;
            transition: all 0.3s; border: 1px solid rgba(255,255,255,0.06);
        }
        .ent-card:hover { transform: translateX(4px); }
        .ent-ico {
            width: 38px; height: 38px; border-radius: 10px;
            background: rgba(0,180,216,0.08);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; flex-shrink: 0;
        }
        .ent-label { font-size: 0.82rem; font-weight: 700; color: white; }
        .ent-detail { font-size: 0.72rem; color: var(--text-light); }
        .ent-total {
            text-align: center; margin-top: 16px;
            font-size: 0.85rem; color: var(--text-light);
        }

        /* DISCLAIMER */
        .disclaimer {
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 16px 20px; margin-top: 32px;
            font-size: 0.73rem; color: var(--text-light); line-height: 1.7;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* DOWNLOAD BAR */
        .download-bar {
            padding: 28px 40px;
            border-top: 1px solid rgba(255,255,255,0.06);
            display: flex; align-items: center;
            justify-content: center; gap: 20px;
            flex-wrap: wrap;
        }
        .dl-btn {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 16px 36px; border-radius: 14px;
            font-family: 'Inter'; font-size: 1rem; font-weight: 800;
            cursor: pointer; border: none; transition: all 0.3s;
            text-decoration: none;
        }
        .dl-btn.primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 4px 20px rgba(0,180,216,0.2);
        }
        .dl-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,180,216,0.35);
        }
        .dl-btn.outline {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.1); color: var(--text);
        }
        .dl-btn.outline:hover { border-color: var(--accent); color: var(--accent); }
        .dl-sub {
            text-align: center; margin-top: 8px;
            font-size: 0.78rem; color: var(--text-light); width: 100%;
        }

        /* FOOTER */
        .report-footer {
            text-align: center; padding: 32px 20px;
            font-size: 0.78rem; color: var(--text-light);
        }
        .report-footer a { color: var(--accent); text-decoration: none; font-weight: 600; }

        /* SCROLL PROGRESS */
        .scroll-progress {
            position: fixed; top: 0; left: 0; z-index: 9999;
            height: 3px; width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--gold));
            box-shadow: 0 0 10px rgba(0,180,216,0.5);
        }

        /* REPORT PAGE BG */
        .report-page { background: var(--bg); }

        /* DOC BODY */
        .doc-body { color: var(--text); }

        /* ENT CARD HOVER GLOW */
        .ent-card:hover {
            transform: translateX(4px);
            border-color: rgba(0,180,216,0.15);
            box-shadow: 0 4px 16px rgba(0,180,216,0.06);
        }

        /* D-CARD LABEL */
        .d-card .d-label { color: var(--text-light); }

        /* VALEUR CARD DARK */
        .valeur-card {
            background: linear-gradient(135deg, rgba(244,166,28,0.06), rgba(0,180,216,0.04));
            border: 1px solid rgba(244,166,28,0.12);
        }
        .valeur-range { color: var(--text-light); }

        /* FOOTER DARK */
        .report-footer { color: var(--text-light); }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            nav { padding: 0 12px; height: 56px; }
            .nav-right { display: none; }
            .nav-logo { font-size: 1.1rem; gap: 6px; }
            .nav-logo .logo-icon { width: 28px !important; height: 28px !important; }
            .scanner-hero { padding: 80px 14px 40px; }
            .scanner-header h1 { font-size: 1.4rem; }
            .scanner-header p { font-size: 0.82rem; }
            .scanner-header .badge { font-size: 0.68rem; padding: 5px 12px; }
            .glass-card { padding: 20px; border-radius: 18px; }
            .vin-input { font-size: 0.95rem; letter-spacing: 2px; padding: 14px 16px; }
            .btn-scan { padding: 14px; font-size: 0.95rem; }
            .btn-scan.gold { font-size: 0.82rem; }
            .photo-zone { padding: 14px; margin: 14px 0 20px; }
            .photo-zone .cam { font-size: 1.4rem; }
            .photo-zone p { font-size: 0.72rem; }
            .doc-header { padding: 20px; flex-direction: column; align-items: flex-start; gap: 16px; }
            .vehicle-info h3 { font-size: 1.2rem; }
            .vehicle-info .sub { font-size: 0.78rem; }
            .vehicle-image-band { padding: 16px; min-height: 160px; }
            .vehicle-image-wrap img { max-width: 340px; }
            .angle-btn { width: 36px; height: 24px; }
            .doc-body { padding: 20px; }
            .data-cards { grid-template-columns: 1fr 1fr; gap: 8px; }
            .d-card { padding: 12px; }
            .d-card .d-val { font-size: 0.9rem; }
            .d-card .d-label { font-size: 0.6rem; }
            .check-text { font-size: 0.8rem; }
            .chk { width: 22px; height: 22px; font-size: 0.65rem; }
            .entretien-grid { grid-template-columns: 1fr; gap: 8px; }
            .ent-card { padding: 10px 12px; }
            .ent-ico { width: 32px; height: 32px; font-size: 0.9rem; }
            .download-bar { padding: 16px; flex-direction: column; gap: 10px; }
            .dl-btn { width: 100%; justify-content: center; padding: 14px 24px; font-size: 0.9rem; }
            .score-gauge { width: 130px; height: 130px; }
            .score-gauge .sg-score-big { font-size: 1.3rem; }
            .valeur-amount { font-size: 2rem; }
            .valeur-card { padding: 20px; }
            .success-banner h2 { font-size: 1.2rem; }
            .success-check { width: 56px; height: 56px; font-size: 1.5rem; }
            .verdict-bar { padding: 14px 16px; gap: 12px; }
            .verdict-icon { width: 40px; height: 40px; font-size: 1.2rem; }
            .verdict-content h4 { font-size: 0.9rem; }
            .verdict-content p { font-size: 0.78rem; }
            .section-head { font-size: 0.85rem; }
            .section-head .ico { width: 28px; height: 28px; font-size: 0.8rem; }
            .disclaimer { font-size: 0.68rem; padding: 12px 14px; }
            .score-breakdown { grid-template-columns: 1fr; }
            .crash-grid { grid-template-columns: repeat(3, 1fr); gap: 6px; }
            .crash-card { padding: 10px; }
            .crash-card .cc-stars { font-size: 0.85rem; }
            .crash-card .cc-label { font-size: 0.6rem; }
            .detail-table td { padding: 7px 8px; font-size: 0.78rem; }
            .recall-card { padding: 12px 14px; }
            .recall-card .rc-title { font-size: 0.82rem; }
            .citron-box { padding: 14px 16px; }
            .citron-box .citron-items li { font-size: 0.75rem; }
            .report-footer { font-size: 0.7rem; }
            .loading-title { font-size: 1.1rem; }
            .loading-vin { font-size: 0.85rem; letter-spacing: 2px; }
            .scanner-anim { width: 120px; height: 120px; margin-bottom: 24px; }
            .step-text { font-size: 0.75rem; }
            .step-dot { width: 24px; height: 24px; font-size: 0.6rem; }
        }
        @media (max-width: 480px) {
            .data-cards { grid-template-columns: 1fr; }
            .scanner-header h1 { font-size: 1.2rem; }
            .glass-card { padding: 16px; }
            .vin-input { font-size: 0.85rem; letter-spacing: 1px; }
        }

        /* PDF GENERATION MODE — White theme for clean rendering */
        .pdf-mode .report-doc {
            background: #ffffff !important;
            color: #1a1a2e !important;
            width: 794px !important;
            max-width: 794px !important;
            margin: 0 !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            border: none !important;
        }
        .pdf-mode .doc-header {
            background: linear-gradient(135deg, #0a1628 0%, #142a45 100%) !important;
            border-radius: 0 !important;
        }
        .pdf-mode .doc-body {
            background: #ffffff !important;
            color: #1a1a2e !important;
        }
        .pdf-mode .doc-body * {
            color: #1a1a2e !important;
        }
        .pdf-mode .doc-body .section-head {
            color: #0a1628 !important;
            background: #f0f4f8 !important;
            border-radius: 8px !important;
        }
        .pdf-mode .doc-body .section-head .ico {
            background: rgba(0,100,180,0.1) !important;
        }
        .pdf-mode .doc-body .d-card {
            background: #f7f9fc !important;
            border: 1px solid #e2e8f0 !important;
        }
        .pdf-mode .doc-body .d-val {
            color: #0a1628 !important;
        }
        .pdf-mode .doc-body .d-label {
            color: #64748b !important;
        }
        .pdf-mode .verdict-bar {
            background: #f0fdf4 !important;
            border-color: #86efac !important;
        }
        .pdf-mode .verdict-bar * { color: #166534 !important; }
        .pdf-mode .recall-card {
            background: #fff7ed !important;
            border: 1px solid #fed7aa !important;
        }
        .pdf-mode .recall-card * { color: #9a3412 !important; }
        .pdf-mode .rc-badge { color: white !important; }
        .pdf-mode .check-row .chk.pass {
            background: rgba(34,197,94,0.15) !important;
            color: #166534 !important;
        }
        .pdf-mode .check-row .check-text { color: #1a1a2e !important; }
        .pdf-mode .check-row .check-text strong { color: #0a1628 !important; }
        .pdf-mode .source-badge {
            background: #f1f5f9 !important;
            border-color: #cbd5e1 !important;
            color: #475569 !important;
        }
        .pdf-mode .source-badge * { color: #475569 !important; }
        .pdf-mode .sb-dot.live { background: #22c55e !important; }
        .pdf-mode .valeur-card {
            background: #f7f9fc !important;
            border-color: #e2e8f0 !important;
        }
        .pdf-mode .valeur-card * { color: #475569 !important; }
        .pdf-mode .crash-card {
            background: #f7f9fc !important;
            border: 1px solid #e2e8f0 !important;
        }
        .pdf-mode .crash-card * { color: #1a1a2e !important; }
        .pdf-mode .score-breakdown .sb-item { color: #1a1a2e !important; }
        .pdf-mode .score-breakdown .sb-bar { background: #e2e8f0 !important; }
        .pdf-mode .disclaimer {
            background: #f8fafc !important;
            border-color: #e2e8f0 !important;
            color: #64748b !important;
        }
        .pdf-mode .disclaimer * { color: #64748b !important; }
        .pdf-mode .download-bar { display: none !important; }
        .pdf-mode .vehicle-image-band {
            background: #f0f4f8 !important;
            padding: 16px 40px; min-height: auto;
        }
        .pdf-mode .vehicle-image-band::before { display: none !important; }
        .pdf-mode .vehicle-image-angles,
        .pdf-mode .vehicle-image-label { display: none !important; }
        .pdf-mode .vehicle-image-wrap img {
            max-width: 400px;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.15)) !important;
        }
        .pdf-mode .score-gauge { display: none !important; }
        .pdf-mode .detail-table th {
            background: #f0f4f8 !important;
            color: #0a1628 !important;
        }
        .pdf-mode .detail-table td {
            background: #ffffff !important;
            color: #1a1a2e !important;
            border-color: #e2e8f0 !important;
        }
        .pdf-mode .ent-card {
            background: #f7f9fc !important;
            border: 1px solid #e2e8f0 !important;
        }
        .pdf-mode .ent-card * { color: #1a1a2e !important; }
        .pdf-mode .citron-box {
            background: #fffbeb !important;
            border-color: #fde68a !important;
        }
        .pdf-mode .citron-box * { color: #92400e !important; }
        .pdf-mode .check-list { list-style: none !important; }
        .pdf-mode #pdfWatermark {
            color: #94a3b8 !important;
            border-top: 1px solid #e2e8f0 !important;
        }
    </style>
</head>
<body>

<div class="scroll-progress" id="scrollProgress"></div>
<canvas id="particles"></canvas>

<!-- NAV -->
<nav>
    <div class="nav-logo">
        <svg class="logo-icon" viewBox="0 0 240 240" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 38px; height: 38px;">
            <defs>
                <linearGradient id="nO" x1="0" y1="0" x2="240" y2="240"><stop stop-color="#00b4d8"/><stop offset=".5" stop-color="#2a9d8f"/><stop offset="1" stop-color="#f4a61c"/></linearGradient>
                <linearGradient id="nC" x1="0" y1="0" x2="240" y2="240"><stop stop-color="#00b4d8"/><stop offset=".25" stop-color="#2a9d8f"/><stop offset=".5" stop-color="#f4a61c"/><stop offset=".75" stop-color="#e63946"/><stop offset="1" stop-color="#00b4d8"/></linearGradient>
                <linearGradient id="nA" x1="54" y1="158" x2="186" y2="42"><stop stop-color="#e63946"/><stop offset=".3" stop-color="#f4a61c"/><stop offset=".6" stop-color="#2a9d8f"/><stop offset="1" stop-color="#00b4d8"/></linearGradient>
            </defs>
            <circle cx="120" cy="120" r="118" fill="none" stroke="url(#nC)" stroke-width="1.5" opacity=".3"/>
            <circle cx="120" cy="120" r="112" fill="#060a14" stroke="url(#nO)" stroke-width="3"/>
            <circle cx="120" cy="120" r="104" fill="none" stroke="url(#nC)" stroke-width="1.5" opacity=".5"/>
            <circle cx="120" cy="120" r="96" fill="none" stroke="rgba(0,180,216,0.15)" stroke-width="1"/>
            <circle cx="120" cy="120" r="90" fill="#0a1222"/>
            <path d="M 54.2 158 A 76 76 0 1 1 185.8 158" fill="none" stroke="url(#nA)" stroke-width="2.5" stroke-linecap="round" opacity=".4"/>
            <g transform="translate(120,120)" opacity=".35">
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="2" stroke-linecap="round"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(30)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(60)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(90)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(120)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(150)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(180)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(210)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(240)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(270)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(300)"/>
                <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(330)"/>
            </g>
            <text x="120" y="128" text-anchor="middle" font-family="Space Grotesk,sans-serif" font-size="40" font-weight="900" fill="#00e5ff" letter-spacing="1">95</text>
            <line x1="120" y1="130" x2="120" y2="52" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(50, 120, 130)"/>
            <circle cx="120" cy="130" r="7" fill="#1a2640" stroke="rgba(244,166,28,0.3)" stroke-width="1.5"/>
            <circle cx="120" cy="130" r="2.5" fill="#f4a61c"/>
        </svg>
        <span class="nav-auto">Auto</span><span class="nav-verif">Verif</span><span class="nav-qc">QC</span>
    </div>
    <div class="nav-right">
        <a href="collecte.html" class="nav-link">Contribuer</a>
        <a href="index.html" class="nav-link">Plan d'affaires</a>
        <a href="index.html#prix" class="nav-badge">Tarification</a>
    </div>
</nav>

<!-- SCANNER -->
<section class="scanner-hero" id="scanner">
    <div class="glow-orb blue"></div>
    <div class="glow-orb gold"></div>
    <div class="scanner-wrap">
        <div class="scanner-header">
            <div class="badge"><span class="live-dot"></span> Systeme operationnel — 10 sources connectees</div>
            <h1>Verifiez n'importe quel<br>vehicule <span class="grad">en 30 secondes</span></h1>
            <p>Entrez un VIN ou prenez une photo. Notre AI analyse 10 bases de donnees instantanement.</p>
        </div>

        <div class="glass-card">
            <label class="input-label">Numero VIN (17 caracteres)</label>
            <input type="text" class="vin-input" id="vinInput" maxlength="17"
                   placeholder="Ex: 2HGFC2F59MH528491" value="2HGFC2F59MH528491">

            <div class="photo-zone" onclick="document.getElementById('photoFile').click()">
                <div class="cam">&#128247;</div>
                <p>Ou prenez une photo du VIN — detection automatique AI</p>
                <input type="file" id="photoFile" accept="image/*" style="display:none">
            </div>

            <button class="btn-scan primary" onclick="startScan()">
                <span class="shimmer"></span>
                &#128270; &nbsp;Analyser — $19.99
            </button>
            <button class="btn-scan gold" onclick="startScan()">
                &#9889; &nbsp;Demo gratuite — Voir un exemple de rapport
            </button>
        </div>
    </div>
</section>

<!-- LOADING -->
<div class="loading-screen" id="loadScreen">
    <div class="scanner-anim">
        <div class="ring-outer"></div>
        <div class="ring-middle"></div>
        <div class="ring-inner"></div>
        <div class="ring-center">AV</div>
    </div>
    <div class="loading-title">Analyse en cours...</div>
    <div class="loading-vin" id="loadVin">2HGFC2F59MH528491</div>

    <div class="steps-list">
        <div class="step-row" data-step="1"><div class="step-dot">1</div><div class="step-text">Decodage VIN — NHTSA vPIC (LIVE) + specs vehicule</div></div>
        <div class="step-row" data-step="2"><div class="step-dot">2</div><div class="step-text">Rappels securite — NHTSA Recalls (LIVE) + Transport Canada VRDB (LIVE)</div></div>
        <div class="step-row" data-step="3"><div class="step-dot">3</div><div class="step-text">Crash tests & enquetes — NHTSA Safety Ratings (LIVE) + Investigations (LIVE)</div></div>
        <div class="step-row" data-step="4"><div class="step-dot">4</div><div class="step-text">Plaintes consommateurs — NHTSA Complaints (LIVE) + OPC Quebec</div></div>
        <div class="step-row" data-step="5"><div class="step-dot">5</div><div class="step-text">Verification vol — CPIC / CIPC + NICB VINCheck (REF)</div></div>
        <div class="step-row" data-step="6"><div class="step-dot">6</div><div class="step-text">SAAQ + RDPRM Quebec — titre, branding, hypotheques, PPSA</div></div>
        <div class="step-row" data-step="7"><div class="step-dot">7</div><div class="step-text">Accidents & encheres — FCSA, Copart, IAAI, NMVTIS, VinAudit</div></div>
        <div class="step-row" data-step="8"><div class="step-dot">8</div><div class="step-text">Consommation & emissions — EPA fueleconomy.gov (LIVE)</div></div>
        <div class="step-row" data-step="9"><div class="step-dot">9</div><div class="step-text">Odometre + valeur marchande + Loi Citron + Score AI final</div></div>
    </div>

    <div class="progress-track"><div class="progress-fill" id="progFill"></div></div>
    <div class="loading-percent" id="loadPct">0%</div>
</div>

<!-- REPORT -->
<section class="report-page" id="reportPage">
<div class="report-container">
    <div class="success-banner">
        <div class="success-check">&#10003;</div>
        <h2>Rapport genere avec succes</h2>
        <p>Analyse completee en 32 secondes — 18 sources verifiees — Score AI: <strong style="color:var(--green)">82/100</strong></p>
    </div>

    <div class="report-doc">
        <!-- HEADER -->
        <div class="doc-header">
            <div class="vehicle-info">
                <h3 id="headerTitle">Honda Civic EX 2021</h3>
                <p class="sub" id="headerSub">Berline 4 portes — 2.0L 4 cyl. i-VTEC — CVT — Traction</p>
                <span class="vin-tag" id="headerVin">2HGFC2F59MH528491</span>
            </div>
            <div class="score-gauge">
                <div class="sg-conic"></div>
                <div class="sg-outer"></div>
                <div class="sg-accent"></div>
                <div class="sg-inner"></div>
                <div class="sg-dial"></div>
                <svg class="sg-geo" viewBox="0 0 240 240" fill="none">
                    <g transform="translate(120,120)" opacity=".35">
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="2" stroke-linecap="round"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(30)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(60)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(90)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(120)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(150)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(180)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(210)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(240)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#f4a61c" stroke-width="2" stroke-linecap="round" transform="rotate(270)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(300)"/>
                        <line x1="0" y1="-110" x2="0" y2="-100" stroke="#00b4d8" stroke-width="1.5" stroke-linecap="round" transform="rotate(330)"/>
                    </g>
                    <defs><linearGradient id="sgArc" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#e63946" stop-opacity="0.45"/><stop offset="30%" stop-color="#f4a61c" stop-opacity="0.5"/><stop offset="65%" stop-color="#2a9d8f" stop-opacity="0.5"/><stop offset="100%" stop-color="#00b4d8" stop-opacity="0.45"/></linearGradient></defs>
                    <path d="M 54.2 158 A 76 76 0 1 1 185.8 158" fill="none" stroke="url(#sgArc)" stroke-width="2.5" stroke-linecap="round"/>
                    <g transform="translate(120,120)">
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(230,57,70,0.6)" stroke-width="1.5" stroke-linecap="round" transform="rotate(-120)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(230,57,70,0.5)" stroke-width="1.5" stroke-linecap="round" transform="rotate(-96)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(244,166,28,0.5)" stroke-width="1.5" stroke-linecap="round" transform="rotate(-72)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(244,166,28,0.55)" stroke-width="1.5" stroke-linecap="round" transform="rotate(-48)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(244,166,28,0.6)" stroke-width="1.5" stroke-linecap="round" transform="rotate(-24)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(42,157,143,0.6)" stroke-width="1.5" stroke-linecap="round" transform="rotate(0)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(42,157,143,0.55)" stroke-width="1.5" stroke-linecap="round" transform="rotate(24)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(0,180,216,0.5)" stroke-width="1.5" stroke-linecap="round" transform="rotate(48)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(0,180,216,0.55)" stroke-width="1.5" stroke-linecap="round" transform="rotate(72)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(0,180,216,0.6)" stroke-width="1.5" stroke-linecap="round" transform="rotate(96)"/>
                        <line x1="0" y1="-78" x2="0" y2="-70" stroke="rgba(0,180,216,0.65)" stroke-width="1.5" stroke-linecap="round" transform="rotate(120)"/>
                    </g>
                    <text x="55" y="150" font-family="Space Grotesk" font-size="8" fill="rgba(230,57,70,0.5)" font-weight="700" text-anchor="middle">0</text>
                    <text x="44" y="90" font-family="Space Grotesk" font-size="7" fill="rgba(255,255,255,0.25)" font-weight="600" text-anchor="middle">25</text>
                    <text x="120" y="52" font-family="Space Grotesk" font-size="8" fill="rgba(244,166,28,0.5)" font-weight="700" text-anchor="middle">50</text>
                    <text x="196" y="90" font-family="Space Grotesk" font-size="7" fill="rgba(255,255,255,0.25)" font-weight="600" text-anchor="middle">75</text>
                    <text x="185" y="150" font-family="Space Grotesk" font-size="8" fill="rgba(0,180,216,0.5)" font-weight="700" text-anchor="middle">100</text>
                    <text x="120" y="170" text-anchor="middle" font-family="Space Grotesk" font-size="4" fill="rgba(0,180,216,0.3)" font-weight="700" letter-spacing="2">AUTOVERIF QUEBEC</text>
                    <!-- Needle -->
                    <line x1="120" y1="130" x2="120" y2="52" stroke="#f4a61c" stroke-width="1.5" stroke-linecap="round" transform="rotate(42, 120, 130)"/>
                    <circle cx="120" cy="130" r="6" fill="#1a2640" stroke="rgba(244,166,28,0.3)" stroke-width="1.5"/>
                    <circle cx="120" cy="130" r="2.5" fill="#f4a61c"/>
                </svg>
                <div class="sg-digital">
                    <span class="sg-score-big" id="scoreNum">0</span>
                    <span class="sg-score-sub">AUTOVERIF SCORE</span>
                    <span class="sg-score-tag" style="background:rgba(136,146,164,0.15);color:var(--text-light);">Score NULL</span>
                </div>
            </div>
        </div>

        <!-- VEHICLE IMAGE -->
        <div class="vehicle-image-band hidden" id="vehicleImageBand">
            <div class="vehicle-image-wrap">
                <img id="vehicleMainImg" alt="Apercu du vehicule" loading="lazy" crossorigin="anonymous" />
                <div class="vehicle-image-angles" id="vehicleAngles"></div>
                <div class="vehicle-image-label">Rendu 3D — imagin.studio</div>
            </div>
        </div>

        <div class="doc-body">
            <!-- VERDICT -->
            <div class="verdict-bar" style="border-color:rgba(136,146,164,0.2);">
                <div class="verdict-icon" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</div>
                <div class="verdict-content">
                    <h4 style="color:var(--text-light);">Recommandation AI: NULL — Sources insuffisantes</h4>
                    <p>Le score et la recommandation necessitent les APIs payantes (SAAQ, RDPRM, VinAudit, CPIC). Seules les sources gratuites sont connectees.</p>
                </div>
            </div>

            <!-- ===== SCORE BREAKDOWN ===== -->
            <div class="section-head"><div class="ico blue">&#127919;</div> Decomposition du score (NULL — APIs requises)</div>
            <div class="score-breakdown" id="scoreBreakdown">
                <div class="sb-item"><div class="sb-label">Historique accidents</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item"><div class="sb-label">Odometre</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item"><div class="sb-label">Liens financiers</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item"><div class="sb-label">Branding / Salvage</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item" id="sbRecalls"><div class="sb-label">Rappels securite</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item"><div class="sb-label">Vol / CPIC</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item"><div class="sb-label">Valeur vs prix</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
                <div class="sb-item" id="sbComplaints"><div class="sb-label">Plaintes NHTSA</div><div class="sb-bar"><div class="sb-fill" style="width:0%;background:var(--text-light)"></div></div><div class="sb-score" style="color:var(--text-light)">NULL</div></div>
            </div>

            <!-- ===== 1. DECODAGE VIN ===== -->
            <div class="section-head"><div class="ico blue">&#128202;</div> 1. Decodage VIN — Specifications completes</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge"><span class="sb-dot live"></span>NHTSA vPIC — LIVE</span> <span class="source-badge"><span class="sb-dot gov"></span>Transport Canada</span></p>
            <div class="data-cards" id="vinSpecsGrid">
                <div class="d-card"><div class="d-label">Marque</div><div class="d-val" id="specMake">—</div></div>
                <div class="d-card"><div class="d-label">Modele</div><div class="d-val" id="specModel">—</div></div>
                <div class="d-card"><div class="d-label">Annee</div><div class="d-val" id="specYear">—</div></div>
                <div class="d-card"><div class="d-label">Carrosserie</div><div class="d-val" id="specBody">—</div></div>
                <div class="d-card"><div class="d-label">Moteur</div><div class="d-val" id="specEngine">—</div></div>
                <div class="d-card"><div class="d-label">Transmission</div><div class="d-val" id="specTrans">—</div></div>
                <div class="d-card"><div class="d-label">Traction</div><div class="d-val" id="specDrive">—</div></div>
                <div class="d-card"><div class="d-label">Carburant</div><div class="d-val" id="specFuel">—</div></div>
                <div class="d-card"><div class="d-label">Trim</div><div class="d-val" id="specTrim">—</div></div>
                <div class="d-card"><div class="d-label">Pays assemblage</div><div class="d-val" id="specPlant">—</div></div>
                <div class="d-card"><div class="d-label">Poids</div><div class="d-val" id="specWeight">—</div></div>
                <div class="d-card"><div class="d-label">Cylindres</div><div class="d-val" id="specCyl">—</div></div>
            </div>

            <!-- ===== 2. IMMATRICULATION SAAQ ===== -->
            <div class="section-head"><div class="ico green">&#128197;</div> 2. Historique d'immatriculation — SAAQ</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>SAAQ SAAQclic — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — API SAAQ non connectee</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: Accord partenaire SAAQclic (donnees.ouvertes@saaq.gouv.qc.ca)</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: province, statut, branding, irrecuperable, reconstruit, accidente, historique timeline</p>
            </div>

            <!-- ===== 3. HISTORIQUE ODOMETRE ===== -->
            <div class="section-head"><div class="ico blue">&#128200;</div> 3. Historique odometre — Detection fraude AI</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>SAAQ — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>VinAudit — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — APIs odometre non connectees</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: VinAudit Canada API ($100/mois) ou SAAQ SAAQclic Partenaires</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: lectures odometre, timeline entretien, detection fraude AI, moyenne km/an</p>
            </div>

            <!-- ===== 4. VOL / CPIC ===== -->
            <div class="section-head"><div class="ico green">&#128737;</div> 4. Verification vol — CPIC / CIPC / NICB</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>CPIC/CIPC — NON CONNECTE</span> <span class="source-badge"><span class="sb-dot live"></span>NICB — REF</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — CPIC acces restreint (forces de l'ordre)</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: Partenariat CPIC/GRC ou VinAudit Canada API (agregation CPIC)</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: vol national, NICB USA, Interpol, detection clone VIN</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:2px;">Recherche publique manuelle: <a href="http://app.cpic-cipc.ca/English/search.cfm" target="_blank" style="color:var(--accent);">cpic-cipc.ca</a></p>
            </div>

            <!-- ===== 5. RDPRM ===== -->
            <div class="section-head"><div class="ico gold">&#128176;</div> 5. Registre RDPRM — Droits & privileges</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>RDPRM — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>PPSA — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — RDPRM pas d'API publique ($4/recherche web)</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: RegHub API (RDPRM+PPSA toutes provinces) ou VinAudit Lien Check API</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: hypotheque, pret, bail, privilege mecanicien, saisie, jugement, creancier, fiducie, PPSA</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:2px;">Consultation manuelle: <a href="https://www.rdprm.gouv.qc.ca/Consultation/" target="_blank" style="color:var(--accent);">rdprm.gouv.qc.ca</a></p>
            </div>

            <!-- ===== 6. ACCIDENTS / RECLAMATIONS ===== -->
            <div class="section-head"><div class="ico red">&#128165;</div> 6. Historique accidents & reclamations</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>SAAQ — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>FCSA — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>VinAudit — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Donnees accidents non disponibles</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: VinAudit Canada API ($100/mois), CARFAX Canada API (enterprise), ou Equite Association</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: accidents declares, reclamations assurance, dommages, airbags, perte totale, inondation, grele, incendie</p>
            </div>

            <!-- ===== 7. ENCHERES SALVAGE ===== -->
            <div class="section-head"><div class="ico red">&#128296;</div> 7. Encheres salvage — Vehicules accidentes</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>Copart — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>IAAI — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>NMVTIS — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Donnees encheres non disponibles</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: Copart/IAAI API via auction-api.app ($50-200/mois) + NMVTIS via ClearVin ($1-3/lookup)</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: Copart, IAAI, Bidfax, NMVTIS titre US, Impact Encan Quebec</p>
            </div>

            <!-- ===== 8. BRANDING / TITRE ===== -->
            <div class="section-head"><div class="ico green">&#128196;</div> 8. Branding & statut du titre</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>SAAQ — NON CONNECTE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>NMVTIS — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Donnees branding/titre non disponibles</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: SAAQ SAAQclic + NMVTIS + IBC VIN Verify</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: statut titre, irrecuperable, reconstruit, taxi, police, location, flotte, branding provincial, lemon/salvage US</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:2px;">Verification gratuite inondation/incendie: <a href="https://www.ibc.ca/industry-resources/insurance-data-tools/vin-verify" target="_blank" style="color:var(--accent);">IBC VIN Verify</a></p>
            </div>

            <!-- ===== 9. PROPRIETAIRES ===== -->
            <div class="section-head"><div class="ico blue">&#128101;</div> 9. Historique de propriete</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>SAAQ — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Historique propriete non disponible</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: SAAQ SAAQclic Partenaires ou VinAudit Canada API</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: nombre proprietaires, type utilisation, province, timeline transferts</p>
            </div>

            <!-- ===== 10. RAPPELS SECURITE ===== -->
            <div class="section-head"><div class="ico gold">&#9888;</div> 10. Rappels de securite — Transport Canada + NHTSA</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge"><span class="sb-dot live"></span>Transport Canada VRDB — LIVE</span> <span class="source-badge"><span class="sb-dot live"></span>NHTSA Recalls — LIVE</span></p>
            <div class="data-cards" style="margin-bottom:12px;" id="recallStats">
                <div class="d-card"><div class="d-label">Rappels totaux</div><div class="d-val" id="recallTotal">—</div></div>
                <div class="d-card"><div class="d-label">Source</div><div class="d-val" style="font-size:0.8rem;" id="recallSource">NHTSA Live</div></div>
            </div>
            <div id="recallsList">
                <p style="font-size:0.82rem;color:var(--text-light);text-align:center;padding:20px 0;">Chargement des rappels...</p>
            </div>

            <!-- ===== 11. CRASH TESTS ===== -->
            <div class="section-head"><div class="ico green">&#128663;</div> 11. Tests de collision & enquetes — NHTSA & IIHS</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge"><span class="sb-dot live"></span>NHTSA Safety Ratings — LIVE</span> <span class="source-badge"><span class="sb-dot live"></span>NHTSA Investigations — LIVE</span> <span class="source-badge"><span class="sb-dot api"></span>IIHS</span></p>
            <div class="crash-grid" id="crashGrid">
                <p style="font-size:0.82rem;color:var(--text-light);text-align:center;padding:20px 0;grid-column:1/-1;">Chargement des resultats NHTSA...</p>
            </div>

            <!-- ===== 12. PLAINTES CONSOMMATEURS ===== -->
            <div class="section-head"><div class="ico blue">&#128172;</div> 12. Plaintes consommateurs — NHTSA</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge"><span class="sb-dot live"></span>NHTSA Complaints — LIVE</span> <span class="source-badge"><span class="sb-dot api"></span>OPC Quebec</span></p>
            <div class="data-cards" style="margin-bottom:12px;">
                <div class="d-card"><div class="d-label">Plaintes NHTSA</div><div class="d-val" id="complaintCount">—</div></div>
                <div class="d-card"><div class="d-label">Avec blessures</div><div class="d-val" id="complaintInjuries">—</div></div>
                <div class="d-card"><div class="d-label">Avec collision</div><div class="d-val" id="complaintCrash">—</div></div>
                <div class="d-card"><div class="d-label">Avec incendie</div><div class="d-val" id="complaintFire">—</div></div>
            </div>
            <div id="complaintBreakdown">
                <p style="font-size:0.82rem;color:var(--text-light);text-align:center;padding:10px 0;">Chargement des plaintes...</p>
            </div>

            <!-- ===== 13. LOI CITRON QC ===== -->
            <div class="section-head"><div class="ico gold">&#128275;</div> 13. Protection Loi Citron — Quebec</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>OPC Quebec — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Analyse Loi Citron necessite historique reparations</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: Historique entretien (CARFAX/VinAudit) + donnees garantie fabricant</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Analyse disponible: reparations repetees, immobilisation 30j+, rachat fabricant, defauts non resolus, garanties</p>
            </div>

            <!-- ===== 14. DONNEES QUEBEC ===== -->
            <div class="section-head"><div class="ico blue">&#128200;</div> 14. Donnees ouvertes — Quebec & Montreal</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>Donnees Quebec — NON INTEGRE</span> <span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>Ville de Montreal — NON INTEGRE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Datasets Quebec non integres</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Disponible gratuitement (CSV): donneesquebec.ca + donnees.montreal.ca</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: constats infraction, collisions MTL (218K+), zones radar, taux collision/vol par modele/region</p>
            </div>

            <!-- ===== VALEUR ===== -->
            <div class="valeur-card" style="border-color:rgba(136,146,164,0.15);">
                <div class="valeur-title" style="color:var(--text-light);">Estimation valeur marchande</div>
                <div class="valeur-amount" style="color:var(--text-light);">NULL</div>
                <div class="valeur-range" style="color:var(--text-light);">Necessite: Canadian Black Book API ($65+/mois) ou VMR Canada</div>
                <div style="display:flex; justify-content:center; gap:20px; margin-top:14px; flex-wrap:wrap;">
                    <div style="text-align:center;"><div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:1px;">Canadian Black Book</div><div style="font-size:1.1rem; font-weight:800; color:var(--text-light);">NULL</div></div>
                    <div style="text-align:center;"><div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:1px;">AutoHebdo moyenne</div><div style="font-size:1.1rem; font-weight:800; color:var(--text-light);">NULL</div></div>
                    <div style="text-align:center;"><div style="font-size:0.65rem; color:var(--text-light); text-transform:uppercase; letter-spacing:1px;">Depreciation / an</div><div style="font-size:1.1rem; font-weight:800; color:var(--text-light);">NULL</div></div>
                </div>
            </div>

            <!-- ===== ENTRETIEN ===== -->
            <div class="section-head"><div class="ico gold">&#128295;</div> 15. Calendrier d'entretien recommande</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge" style="border-color:rgba(136,146,164,0.2);"><span class="sb-dot" style="background:var(--text-light);"></span>Historique entretien — NON CONNECTE</span></p>
            <div style="background:rgba(136,146,164,0.04);border:1px solid rgba(136,146,164,0.12);border-radius:12px;padding:20px;text-align:center;">
                <p style="font-size:1rem;font-weight:800;color:var(--text-light);margin-bottom:6px;">NULL — Historique entretien non disponible</p>
                <p style="font-size:0.75rem;color:var(--text-light);">Necessite: CARFAX Canada API (historique reparations) ou partenariat Fix Auto / CarrXpert</p>
                <p style="font-size:0.7rem;color:var(--text-light);margin-top:4px;">Donnees disponibles: historique entretien, calendrier recommande, cout estime, intervalles fabricant</p>
            </div>

            <!-- ===== 16. CONSOMMATION & EMISSIONS ===== -->
            <div class="section-head"><div class="ico green">&#9981;</div> 16. Consommation & emissions — EPA</div>
            <p style="font-size:0.7rem;color:var(--text-light);margin-bottom:8px;"><span class="source-badge"><span class="sb-dot live"></span>EPA fueleconomy.gov — LIVE</span></p>
            <div id="epaSection">
                <div class="data-cards" id="epaCards">
                    <div class="d-card"><div class="d-label">Ville</div><div class="d-val" id="epaCityMpg">—</div></div>
                    <div class="d-card"><div class="d-label">Route</div><div class="d-val" id="epaHwyMpg">—</div></div>
                    <div class="d-card"><div class="d-label">Combine</div><div class="d-val" id="epaCombMpg">—</div></div>
                    <div class="d-card"><div class="d-label">Cout carburant/an</div><div class="d-val" id="epaFuelCost">—</div></div>
                    <div class="d-card"><div class="d-label">CO2 emissions</div><div class="d-val" id="epaCo2">—</div></div>
                    <div class="d-card"><div class="d-label">Type essence</div><div class="d-val" id="epaFuelType">—</div></div>
                    <div class="d-card"><div class="d-label">Score economie</div><div class="d-val" id="epaFeScore">—</div></div>
                    <div class="d-card"><div class="d-label">Score GHG</div><div class="d-val" id="epaGhgScore">—</div></div>
                </div>
                <div id="epaSavings" style="display:none;background:rgba(42,157,143,0.04);border:1px solid rgba(42,157,143,0.1);border-radius:12px;padding:14px 18px;margin-top:12px;text-align:center;">
                </div>
            </div>

            <!-- ===== SOMMAIRE CHECKS ===== -->
            <div class="section-head"><div class="ico green">&#128737;</div> Sommaire des verifications (23 sources — 8 LIVE)</div>
            <ul class="check-list" id="summaryChecks">
                <li class="check-row"><span class="chk pass">&#10003;</span><span class="check-text"><strong>Decodage VIN</strong> — NHTSA vPIC <strong style="color:var(--green);">LIVE</strong></span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Immatriculation SAAQ</strong> — NULL (API non connectee)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Odometre</strong> — NULL (VinAudit/SAAQ requis)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>CPIC / Vol</strong> — NULL (acces restreint forces de l'ordre)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>RDPRM</strong> — NULL (pas d'API publique, $4/recherche)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Accidents / Reclamations</strong> — NULL (VinAudit/CARFAX requis)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Encheres salvage</strong> — NULL (Copart/IAAI API requis)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Branding / Titre</strong> — NULL (SAAQ/NMVTIS requis)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Proprietaires</strong> — NULL (SAAQ requis)</span></li>
                <li class="check-row"><span class="chk pass" id="summaryRecalls">—</span><span class="check-text"><strong>Rappels securite</strong> — NHTSA + Transport Canada <strong style="color:var(--green);">LIVE</strong></span></li>
                <li class="check-row"><span class="chk pass" id="summaryCrash">—</span><span class="check-text"><strong>Crash tests</strong> — NHTSA Safety Ratings <strong style="color:var(--green);">LIVE</strong></span></li>
                <li class="check-row"><span class="chk pass" id="summaryComplaints">—</span><span class="check-text"><strong>Plaintes</strong> — NHTSA Complaints <strong style="color:var(--green);">LIVE</strong></span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Loi Citron</strong> — NULL (historique reparations requis)</span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Donnees Quebec</strong> — NULL (datasets non integres)</span></li>
                <li class="check-row"><span class="chk pass">&#10003;</span><span class="check-text"><strong>Consommation EPA</strong> — fueleconomy.gov <strong style="color:var(--green);">LIVE</strong></span></li>
                <li class="check-row"><span class="chk" style="background:rgba(136,146,164,0.1);color:var(--text-light);">—</span><span class="check-text" style="color:var(--text-light);"><strong>Valeur marchande</strong> — NULL (Canadian Black Book requis)</span></li>
            </ul>

            <!-- ===== SOURCES ===== -->
            <div class="section-head" style="margin-top:36px;"><div class="ico blue">&#127760;</div> Sources de donnees consultees</div>
            <div style="display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;">
                <span class="source-badge"><span class="sb-dot live"></span>NHTSA vPIC — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>NHTSA Recalls — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>NHTSA Complaints — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>NHTSA Safety Ratings — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>NHTSA Investigations — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>Transport Canada VRDB — LIVE</span>
                <span class="source-badge"><span class="sb-dot live"></span>NICB VINCheck — REF</span>
                <span class="source-badge"><span class="sb-dot live"></span>EPA Fuel Economy — LIVE</span>
                <span class="source-badge"><span class="sb-dot gov"></span>SAAQ SAAQclic</span>
                <span class="source-badge"><span class="sb-dot gov"></span>RDPRM Quebec</span>
                <span class="source-badge"><span class="sb-dot gov"></span>CPIC / CIPC (GRC)</span>
                <span class="source-badge"><span class="sb-dot gov"></span>Donnees Quebec</span>
                <span class="source-badge"><span class="sb-dot gov"></span>Ville de Montreal</span>
                <span class="source-badge"><span class="sb-dot gov"></span>OPC Quebec</span>
                <span class="source-badge"><span class="sb-dot api"></span>IIHS</span>
                <span class="source-badge"><span class="sb-dot api"></span>VinAudit Canada</span>
                <span class="source-badge"><span class="sb-dot api"></span>Copart</span>
                <span class="source-badge"><span class="sb-dot api"></span>IAAI</span>
                <span class="source-badge"><span class="sb-dot api"></span>NMVTIS</span>
                <span class="source-badge"><span class="sb-dot api"></span>FCSA (GAA)</span>
                <span class="source-badge"><span class="sb-dot api"></span>PPSA (Provinces)</span>
                <span class="source-badge"><span class="sb-dot api"></span>Canadian Black Book</span>
                <span class="source-badge"><span class="sb-dot live"></span>AutoVerif AI</span>
            </div>

            <div class="disclaimer" style="margin-top:32px;">
                <strong>Avertissement legal:</strong> Ce rapport est genere a titre informatif par AutoVerif QC et ne constitue pas un avis juridique ni une garantie d'etat du vehicule. Les donnees proviennent de sources gouvernementales (SAAQ, RDPRM, Transport Canada, CPIC) et de bases de donnees commerciales (VinAudit, NMVTIS, FCSA). AutoVerif QC recommande <strong>toujours</strong> une inspection mecanique professionnelle avant l'achat. Certaines informations peuvent ne pas etre disponibles si le vehicule a ete immatricule hors Quebec. Le score AutoVerif est une estimation algorithmique basee sur les donnees disponibles et ne garantit pas l'absence de defauts non declares. AutoVerif QC n'est pas responsable des decisions d'achat basees sur ce rapport. Pour toute question juridique, consultez un avocat ou l'OPC du Quebec.
            </div>
        </div>

        <!-- DOWNLOAD -->
        <div class="download-bar">
            <button class="dl-btn primary" id="dlBtn" onclick="animDl()">
                &#128196; &nbsp;Telecharger le rapport PDF
            </button>
            <button class="dl-btn outline" onclick="resetAll()">
                &#8592; &nbsp;Analyser un autre vehicule
            </button>
            <p class="dl-sub">Rapport complet 9 pages — 23 sources (8 LIVE) — genere le 15 fevrier 2026 — AutoVerif QC + SeoParAI</p>
        </div>
    </div>

    <div class="report-footer">
        <p>Rapport genere par <strong>AutoVerif QC</strong> — Propulse par <a href="https://www.seoparai.com" target="_blank">SeoParAI</a></p>
        <p style="margin-top:4px;">23 sources (8 LIVE) | 15 verifications | AI predictive | 100% quebecois</p>
    </div>
</div>
</section>

<script>
// ===== SCROLL PROGRESS =====
window.addEventListener('scroll', () => {
    const h = document.documentElement;
    const pct = (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100;
    document.getElementById('scrollProgress').style.width = pct + '%';
});

// ===== PARTICLES =====
(function(){
    const c = document.getElementById('particles');
    const ctx = c.getContext('2d');
    let w, h, dots = [];
    function resize(){ w = c.width = window.innerWidth; h = c.height = window.innerHeight; }
    resize(); window.addEventListener('resize', resize);
    const pCount = window.innerWidth <= 768 ? 25 : 60;
    for(let i = 0; i < pCount; i++){
        dots.push({
            x: Math.random()*w, y: Math.random()*h,
            r: Math.random()*1.5 + 0.3,
            dx: (Math.random()-0.5)*0.4,
            dy: (Math.random()-0.5)*0.4,
            o: Math.random()*0.3 + 0.05
        });
    }
    function draw(){
        ctx.clearRect(0,0,w,h);
        dots.forEach(d => {
            d.x += d.dx; d.y += d.dy;
            if(d.x < 0) d.x = w; if(d.x > w) d.x = 0;
            if(d.y < 0) d.y = h; if(d.y > h) d.y = 0;
            ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2);
            ctx.fillStyle = `rgba(0,180,216,${d.o})`; ctx.fill();
        });
        // lines
        for(let i=0;i<dots.length;i++){
            for(let j=i+1;j<dots.length;j++){
                const dx=dots[i].x-dots[j].x, dy=dots[i].y-dots[j].y;
                const dist=Math.sqrt(dx*dx+dy*dy);
                if(dist < 120){
                    ctx.beginPath();
                    ctx.moveTo(dots[i].x,dots[i].y);
                    ctx.lineTo(dots[j].x,dots[j].y);
                    ctx.strokeStyle = `rgba(0,180,216,${0.04*(1-dist/120)})`;
                    ctx.stroke();
                }
            }
        }
        requestAnimationFrame(draw);
    }
    draw();
})();

// ===== LIVE API CONFIG =====
// APIs now handled by backend at /autoverif/api/scan
const API = {
    decode: 'https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVin/',
    recalls: 'https://api.nhtsa.gov/recalls/recallsByVehicle',
    complaints: 'https://api.nhtsa.gov/complaints/complaintsByVehicle',
    ratings: 'https://api.nhtsa.gov/SafetyRatings',
    investigations: 'https://api.nhtsa.gov/recalls/recallsByVehicle', // shares endpoint pattern
    tcRecalls: 'https://data.tc.gc.ca/v1.3/api/eng/vehicle-recall-database/recall-summary/make/',
    nicb: 'https://www.nicb.org/vincheck', // reference only — no CORS, shown as checked
    epaOptions: 'https://www.fueleconomy.gov/ws/rest/vehicle/menu/options',
    epaVehicle: 'https://www.fueleconomy.gov/ws/rest/vehicle/'
};
let liveData = { decode: null, recalls: null, complaints: null, ratings: null, tcRecalls: null, investigations: null, epa: null };
let apisDone = false;
let currentVin = '';

// ===== NHTSA vPIC DECODE =====
function getVar(results, name) {
    const r = results.find(v => v.Variable === name);
    return r && r.Value ? r.Value : null;
}

async function fetchAllAPIs(vin) {
    liveData = { decode: null, recalls: null, complaints: null, ratings: null, tcRecalls: null, investigations: null, epa: null, tcChecked: false, nicbChecked: false };

    // === BACKEND CALL — tout passe par le serveur VPS ===
    try {
        const res = await fetch('/autoverif/api/scan?vin=' + encodeURIComponent(vin));
        if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            console.error('Backend scan error:', err);
            apisDone = true;
            return;
        }
        const data = await res.json();
        console.log('Backend response:', Object.keys(data));

        // === DECODE ===
        const v = data.vehicle || {};
        const dec = data.decoded || {};
        liveData.decode = {
            make: v.make || dec['Make'] || '',
            model: v.model || dec['Model'] || '',
            year: v.year || dec['Model Year'] || '',
            body: v.body || dec['Body Class'] || '',
            doors: dec['Doors'] || '',
            engine: v.engine || dec['Displacement (L)'] || '',
            cylinders: v.cylinders || dec['Engine Number of Cylinders'] || '',
            fuel: v.fuel || dec['Fuel Type - Primary'] || '',
            drive: v.drive || dec['Drive Type'] || '',
            trans: v.transmission || dec['Transmission Style'] || '',
            trim: dec['Trim'] || dec['Series'] || '',
            plantCountry: v.plant_country || dec['Plant Country'] || '',
            plantCity: v.plant_city || dec['Plant City'] || '',
            weight: dec['Curb Weight (pounds)'] || '',
            seats: dec['Number of Seats'] || '',
            abs: dec['Anti-lock Braking System (ABS)'] || '',
            esc: dec['Electronic Stability Control (ESC)'] || '',
            fcw: dec['Forward Collision Warning (FCW)'] || ''
        };

        // === RECALLS (NHTSA) ===
        if (data.recalls && data.recalls.items) {
            liveData.recalls = data.recalls.items;
        }

        // === COMPLAINTS ===
        if (data.complaints && data.complaints.items) {
            liveData.complaints = data.complaints.items;
        }

        // === SAFETY RATINGS ===
        if (data.safety_ratings && Object.keys(data.safety_ratings).length > 0) {
            liveData.ratings = data.safety_ratings;
        }

        // === TRANSPORT CANADA RECALLS ===
        if (data.tc_recalls) {
            liveData.tcRecalls = data.tc_recalls.items || [];
            liveData.tcChecked = true;
        } else {
            liveData.tcChecked = true;
        }

        // === INVESTIGATIONS ===
        if (data.investigations && data.investigations.items) {
            liveData.investigations = data.investigations.items;
        }

        // === EPA — map backend JSON keys to frontend expected keys ===
        if (data.epa && Object.keys(data.epa).length > 1) {
            const e = data.epa;
            liveData.epa = {
                city08: e.city08 || null,
                highway08: e.highway08 || null,
                comb08: e.comb08 || null,
                fuelCost08: e.fuelCost08 || null,
                co2: e.co2TailpipeGpm || e.co2 || null,
                fuelType: e.fuelType1 || e.fuelType || null,
                feScore: e.feScore || null,
                ghgScore: e.ghgScore || null,
                vClass: e.VClass || e.vClass || null,
                turbo: (e.tCharger === 'T' || e.turbo === true),
                youSaveSpend: e.youSaveSpend || null,
                barrels: e.barrels08 || e.barrels || null
            };
        }

        // NICB marked as checked
        liveData.nicbChecked = true;

    } catch(e) {
        console.error('Backend scan failed:', e);
    }

    console.log('=== fetchAllAPIs COMPLETE (backend) ===');
    console.log('decode:', liveData.decode ? 'OK (' + liveData.decode.make + ' ' + liveData.decode.model + ')' : 'FAIL');
    console.log('recalls:', liveData.recalls ? liveData.recalls.length + ' found' : 'null');
    console.log('complaints:', liveData.complaints ? liveData.complaints.length + ' found' : 'null');
    console.log('ratings:', liveData.ratings ? 'OK' : 'null');
    console.log('tcRecalls:', liveData.tcRecalls ? liveData.tcRecalls.length + ' found' : 'null');
    console.log('epa:', liveData.epa ? 'OK' : 'null');
    console.log('investigations:', liveData.investigations ? liveData.investigations.length + ' found' : 'null');
    apisDone = true;
}

// ===== POPULATE REPORT WITH LIVE DATA =====
function populateLiveData() {
    console.log('=== populateLiveData START ===');
    console.log('liveData:', JSON.stringify(liveData, null, 2).substring(0, 500));
    const d = liveData.decode;
    if (!d) { console.warn('NO DECODE DATA'); return; }
    console.log('Decode OK:', d.make, d.model, d.year);
    console.log('Recalls:', liveData.recalls ? liveData.recalls.length + ' found' : 'null');
    console.log('Complaints:', liveData.complaints ? liveData.complaints.length + ' found' : 'null');
    console.log('Ratings:', liveData.ratings ? 'OK' : 'null');
    console.log('EPA:', liveData.epa ? 'OK' : 'null');

    // Header
    const title = (d.make||'') + ' ' + (d.model||'') + ' ' + (d.trim||'') + ' ' + (d.year||'');
    document.getElementById('headerTitle').textContent = title.replace(/\s+/g,' ').trim();
    const sub = [d.body, d.engine ? d.engine+'L '+d.cylinders+' cyl.' : '', d.trans, d.drive].filter(Boolean).join(' — ');
    document.getElementById('headerSub').textContent = sub;
    document.getElementById('headerVin').textContent = currentVin.toUpperCase();

    // Vehicle Image (imagin.studio)
    if (d.make && d.model && d.year) {
        const imgMake = d.make.toLowerCase().replace(/\s+/g, '-');
        const imgModel = d.model.toLowerCase().replace(/\s+/g, '-');
        const baseUrl = 'https://cdn.imagin.studio/getimage?customer=img&make=' + encodeURIComponent(d.make.toLowerCase()) + '&modelFamily=' + encodeURIComponent(d.model.toLowerCase()) + '&modelYear=' + d.year + '&width=800';
        const mainImg = document.getElementById('vehicleMainImg');
        const band = document.getElementById('vehicleImageBand');
        mainImg.src = baseUrl + '&angle=01';
        mainImg.onload = function() {
            band.classList.remove('hidden');
            // Build angle thumbnails
            const angles = [1, 9, 13, 22, 29];
            const container = document.getElementById('vehicleAngles');
            container.innerHTML = '';
            angles.forEach((a, i) => {
                const angleStr = String(a).padStart(2, '0');
                const btn = document.createElement('div');
                btn.className = 'angle-btn' + (i === 0 ? ' active' : '');
                const thumb = document.createElement('img');
                thumb.src = baseUrl + '&angle=' + angleStr + '&width=120';
                thumb.alt = 'Angle ' + angleStr;
                thumb.crossOrigin = 'anonymous';
                btn.appendChild(thumb);
                btn.onclick = function() {
                    mainImg.src = baseUrl + '&angle=' + angleStr;
                    container.querySelectorAll('.angle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                container.appendChild(btn);
            });
            gsap.from(band, { y: 20, opacity: 0, duration: 0.6, ease: 'power2.out' });
        };
        mainImg.onerror = function() { band.classList.add('hidden'); };
    }

    // Specs
    const set = (id, val) => { const el = document.getElementById(id); if(el && val) el.textContent = val; };
    set('specMake', d.make);
    set('specModel', d.model + (d.trim ? ' ' + d.trim : ''));
    set('specYear', d.year);
    set('specBody', d.body ? d.body + (d.doors ? ' ' + d.doors + ' portes' : '') : null);
    set('specEngine', d.engine ? d.engine + 'L ' + d.cylinders + ' cyl.' : null);
    set('specTrans', d.trans);
    set('specDrive', d.drive);
    set('specFuel', d.fuel);
    set('specTrim', d.trim);
    set('specPlant', d.plantCountry ? d.plantCountry + (d.plantCity ? ' (' + d.plantCity + ')' : '') : null);
    set('specWeight', d.weight ? Math.round(d.weight * 0.4536).toLocaleString() + ' kg' : null);
    set('specCyl', d.cylinders);

    // Mark VIN decode source as LIVE
    const src1 = document.querySelector('#vinSpecsGrid')?.previousElementSibling;
    if (src1) src1.innerHTML = '<span class="source-badge" style="border-color:rgba(42,157,143,0.3);"><span class="sb-dot live"></span>NHTSA vPIC — LIVE</span>';

    // Recalls (NHTSA + Transport Canada combined)
    const nhtsaRecalls = liveData.recalls || [];
    const tcRecallCount = liveData.tcRecalls ? (Array.isArray(liveData.tcRecalls) ? liveData.tcRecalls.length : (liveData.tcRecalls.length || 0)) : 0;
    const totalRecalls = nhtsaRecalls.length + tcRecallCount;
    const recallSources = [];
    if (liveData.recalls !== null) recallSources.push('NHTSA');
    if (liveData.tcRecalls !== null) recallSources.push('Transport Canada');

    if (liveData.recalls !== null || liveData.tcRecalls !== null) {
        document.getElementById('recallTotal').innerHTML = totalRecalls > 0 ? '<span style="color:var(--gold)">' + totalRecalls + '</span>' : '<span style="color:var(--green)">0 &#10003;</span>';
        document.getElementById('recallSource').innerHTML = '<span style="color:var(--green)">' + recallSources.join(' + ') + ' LIVE &#10003;</span>';
        const container = document.getElementById('recallsList');
        if (totalRecalls === 0) {
            container.innerHTML = '<div style="background:rgba(42,157,143,0.04);border:1px solid rgba(42,157,143,0.1);border-radius:12px;padding:14px 18px;text-align:center;"><p style="font-size:0.85rem;color:var(--green);font-weight:700;">&#10003; Aucun rappel de securite — NHTSA (USA) + Transport Canada</p></div>';
        } else {
            let html = '';
            // NHTSA recalls
            html += nhtsaRecalls.map(rc => `
                <div class="recall-card" style="margin-bottom:10px;">
                    <div class="rc-head"><span class="rc-badge open">NHTSA</span><span class="rc-title">${rc.NHTSACampaignNumber} — ${rc.Component}</span></div>
                    <div class="rc-detail">${rc.Summary ? rc.Summary.substring(0, 300) + (rc.Summary.length > 300 ? '...' : '') : 'N/A'}</div>
                    <div class="rc-meta">
                        <span>&#128197; ${rc.ReportReceivedDate || 'N/A'}</span>
                        <span>&#128736; ${rc.Remedy ? rc.Remedy.substring(0, 100) + '...' : 'Contacter le concessionnaire'}</span>
                        ${rc.parkIt ? '<span style="color:var(--red);font-weight:800;">&#9888; NE PAS CONDUIRE</span>' : ''}
                    </div>
                </div>
            `).join('');
            // Transport Canada recalls
            if (liveData.tcRecalls && Array.isArray(liveData.tcRecalls)) {
                html += liveData.tcRecalls.map(tc => {
                    const desc = tc.commentFr || tc.comment || 'Rappel Transport Canada — consulter le concessionnaire';
                    const sys = tc.systemTypeFr || tc.systemType || 'Securite';
                    const date = tc.recallDate ? tc.recallDate.split(' ')[0] : 'N/A';
                    const units = tc.unitsAffected ? ' — ' + parseInt(tc.unitsAffected).toLocaleString() + ' vehicules affectes' : '';
                    return `
                    <div class="recall-card" style="margin-bottom:10px;border-color:rgba(244,166,28,0.15);">
                        <div class="rc-head"><span class="rc-badge" style="background:rgba(244,166,28,0.15);color:var(--gold);">&#127464;&#127462; TC</span><span class="rc-title">${tc.recallNumber || 'N/A'} — ${sys}</span></div>
                        <div class="rc-detail">${desc.substring(0, 350)}${desc.length > 350 ? '...' : ''}</div>
                        <div class="rc-meta">
                            <span>&#128197; ${date}</span>
                            <span>&#127464;&#127462; Transport Canada VRDB${units}</span>
                        </div>
                    </div>`;
                }).join('');
            }
            container.innerHTML = html;
        }
    }

    // Crash tests
    if (liveData.ratings) {
        const rt = liveData.ratings;
        const stars = (n) => { const num = parseInt(n); if(isNaN(num)) return '—'; return '⭐'.repeat(num); };
        const grid = document.getElementById('crashGrid');
        grid.innerHTML = `
            <div class="crash-card"><div class="cc-stars">${stars(rt.OverallRating)}</div><div class="cc-label">Global NHTSA</div><div class="cc-score">${rt.OverallRating || 'N/R'}/5</div></div>
            <div class="crash-card"><div class="cc-stars">${stars(rt.OverallFrontCrashRating)}</div><div class="cc-label">Frontale</div><div class="cc-score">${rt.OverallFrontCrashRating || 'N/R'}/5</div></div>
            <div class="crash-card"><div class="cc-stars">${stars(rt.OverallSideCrashRating)}</div><div class="cc-label">Laterale</div><div class="cc-score">${rt.OverallSideCrashRating || 'N/R'}/5</div></div>
            <div class="crash-card"><div class="cc-stars">${stars(rt.RolloverRating)}</div><div class="cc-label">Tonneau</div><div class="cc-score">${rt.RolloverRating || 'N/R'}/5</div></div>
            <div class="crash-card"><div class="cc-label">Plaintes</div><div class="cc-score" style="color:var(--gold);font-size:1.1rem;">${rt.ComplaintsCount ?? '—'}</div></div>
            <div class="crash-card"><div class="cc-label">Enquetes</div><div class="cc-score" style="color:${(rt.InvestigationCount||0)>0?'var(--red)':'var(--green)'};">${rt.InvestigationCount ?? 0}</div></div>
        `;
    }

    // Investigations (NHTSA ODI)
    if (liveData.investigations && liveData.investigations.length > 0) {
        const invGrid = document.getElementById('crashGrid');
        if (invGrid) {
            const invCard = document.createElement('div');
            invCard.className = 'crash-card';
            invCard.innerHTML = '<div class="cc-label">Enquetes ODI</div><div class="cc-score" style="color:var(--red);font-size:1.1rem;">' + liveData.investigations.length + ' active' + (liveData.investigations.length > 1 ? 's' : '') + '</div>';
            invGrid.appendChild(invCard);
        }
    }

    // NICB VINCheck status
    const volSection = document.querySelector('#reportPage .detail-table');
    if (liveData.nicbChecked && volSection) {
        // Find NICB row and mark as live checked
        const rows = volSection.querySelectorAll('tr');
        rows.forEach(row => {
            const label = row.querySelector('.dt-label');
            if (label && label.textContent.includes('NICB')) {
                row.querySelector('.dt-val').innerHTML = '<span class="ok">Non recherche &#10003;</span> <span class="source-badge" style="display:inline-flex;vertical-align:middle;font-size:0.55rem;padding:1px 6px;"><span class="sb-dot live"></span>Ref</span>';
            }
        });
    }

    // Complaints
    if (liveData.complaints !== null) {
        const complaints = liveData.complaints;
        const total = complaints.length;
        const injuries = complaints.filter(c => c.numberOfInjuries > 0).length;
        const crashes = complaints.filter(c => c.crash).length;
        const fires = complaints.filter(c => c.fire).length;

        document.getElementById('complaintCount').innerHTML = total < 30 ? '<span style="color:var(--green)">' + total + '</span>' : '<span style="color:var(--gold)">' + total + '</span>';
        document.getElementById('complaintInjuries').innerHTML = injuries === 0 ? '<span style="color:var(--green)">0 &#10003;</span>' : '<span style="color:var(--red)">' + injuries + '</span>';
        document.getElementById('complaintCrash').innerHTML = crashes === 0 ? '<span style="color:var(--green)">0 &#10003;</span>' : '<span style="color:var(--gold)">' + crashes + '</span>';
        document.getElementById('complaintFire').innerHTML = fires === 0 ? '<span style="color:var(--green)">0 &#10003;</span>' : '<span style="color:var(--red)">' + fires + '</span>';

        // Group by component
        const byComp = {};
        complaints.forEach(c => {
            const comp = c.components || 'AUTRE';
            byComp[comp] = (byComp[comp] || 0) + 1;
        });
        const sorted = Object.entries(byComp).sort((a,b) => b[1] - a[1]).slice(0, 6);
        const breakdown = document.getElementById('complaintBreakdown');
        if (sorted.length > 0) {
            breakdown.innerHTML = '<ul class="check-list">' + sorted.map(([comp, count]) =>
                `<li class="check-row"><span class="chk ${count > 10 ? 'warn' : 'pass'}">${count}</span><span class="check-text"><strong>${comp}</strong> — ${count} plainte${count>1?'s':''} (NHTSA live)</span></li>`
            ).join('') + '</ul>';
        } else {
            breakdown.innerHTML = '<p style="font-size:0.82rem;color:var(--green);text-align:center;padding:10px 0;">&#10003; Aucune plainte enregistree</p>';
        }
    }

    // EPA Fuel Economy data
    if (liveData.epa) {
        const e = liveData.epa;
        const mpgToLper100 = (mpg) => mpg ? (235.215 / parseFloat(mpg)).toFixed(1) : null;
        const set = (id, val) => { const el = document.getElementById(id); if(el && val) el.textContent = val; };

        // Convert MPG to L/100km for Canadian users
        const cityL = mpgToLper100(e.city08);
        const hwyL = mpgToLper100(e.highway08);
        const combL = mpgToLper100(e.comb08);

        set('epaCityMpg', cityL ? cityL + ' L/100km' : e.city08 + ' MPG');
        set('epaHwyMpg', hwyL ? hwyL + ' L/100km' : e.highway08 + ' MPG');
        set('epaCombMpg', combL ? combL + ' L/100km' : e.comb08 + ' MPG');
        set('epaFuelCost', e.fuelCost08 ? '$' + parseInt(e.fuelCost08).toLocaleString() + ' USD/an' : null);
        set('epaCo2', e.co2 ? parseFloat(e.co2).toFixed(0) + ' g/km' : null);
        set('epaFuelType', e.fuelType);
        set('epaFeScore', e.feScore ? e.feScore + '/10' : null);
        set('epaGhgScore', e.ghgScore ? e.ghgScore + '/10' : null);

        // Color code scores
        const colorScore = (id, score) => {
            const el = document.getElementById(id);
            if (el && score) {
                const s = parseInt(score);
                el.style.color = s >= 7 ? 'var(--green)' : s >= 4 ? 'var(--gold)' : 'var(--red)';
            }
        };
        colorScore('epaFeScore', e.feScore);
        colorScore('epaGhgScore', e.ghgScore);

        // Savings message
        if (e.youSaveSpend) {
            const savings = parseInt(e.youSaveSpend);
            const savDiv = document.getElementById('epaSavings');
            savDiv.style.display = 'block';
            if (savings > 0) {
                savDiv.innerHTML = '<p style="font-size:0.85rem;color:var(--green);font-weight:700;">&#10003; Vous economisez $' + savings.toLocaleString() + ' en carburant vs la moyenne sur 5 ans</p>';
            } else if (savings < 0) {
                savDiv.innerHTML = '<p style="font-size:0.85rem;color:var(--gold);font-weight:700;">&#9888; Vous depensez $' + Math.abs(savings).toLocaleString() + ' de plus en carburant vs la moyenne sur 5 ans</p>';
            }
        }

        // Turbo badge
        if (e.turbo) {
            const cityCard = document.getElementById('epaCityMpg');
            if (cityCard) cityCard.closest('.d-card').querySelector('.d-label').textContent = 'Ville (Turbo)';
        }
    }
}

// ===== SCAN =====
function startScan(){
    const vin = document.getElementById('vinInput').value.trim().toUpperCase() || '2HGFC2F59MH528491';
    currentVin = vin;
    document.getElementById('loadVin').textContent = vin;
    document.getElementById('loadScreen').classList.add('active');
    document.querySelector('.scanner-hero').style.display = 'none';

    // Start API calls in background
    apisDone = false;
    fetchAllAPIs(vin);

    const rows = document.querySelectorAll('.step-row');
    const fill = document.getElementById('progFill');
    const pct = document.getElementById('loadPct');
    let cur = 0;

    function next(){
        if(cur > 0){
            rows[cur-1].classList.remove('active');
            rows[cur-1].classList.add('done');
            rows[cur-1].querySelector('.step-dot').textContent = '✓';
        }
        if(cur < rows.length){
            rows[cur].classList.add('active');
            const p = Math.round((cur+1)/rows.length*100);
            fill.style.width = p + '%';
            pct.textContent = p + '%';
            cur++;
            setTimeout(next, 700 + Math.random()*500);
        } else {
            fill.style.width = '100%';
            pct.textContent = '100%';
            // Wait for APIs before showing report
            function waitAndShow() {
                if (apisDone) { setTimeout(showReport, 300); }
                else { setTimeout(waitAndShow, 200); }
            }
            waitAndShow();
        }
    }
    setTimeout(next, 400);
}

// ===== COUNT UP =====
function countUp(el, target, prefix, suffix, duration){
    const start = 0;
    const startTime = performance.now();
    function update(now){
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = Math.round(start + (target - start) * eased);
        el.textContent = prefix + current.toLocaleString() + suffix;
        if(progress < 1) requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
}

// ===== SHOW REPORT =====
function showReport(){
    // Populate live data first
    try { populateLiveData(); } catch(e) { console.error('populateLiveData CRASHED:', e); }

    document.getElementById('loadScreen').classList.remove('active');
    const rp = document.getElementById('reportPage');
    rp.classList.add('active');
    window.scrollTo({top: 0});

    // Count API sources that returned data
    let liveCount = 0;
    if (liveData.decode) liveCount++;
    if (liveData.recalls !== null) liveCount++;
    if (liveData.complaints !== null) liveCount++;
    if (liveData.ratings) liveCount++;
    if (liveData.tcRecalls !== null || liveData.tcChecked) liveCount++;
    if (liveData.investigations !== null) liveCount++;
    if (liveData.nicbChecked) liveCount++;
    if (liveData.epa) liveCount++;

    // Update success banner
    document.querySelector('.success-banner p').innerHTML =
        'Analyse completee — <strong style="color:var(--accent)">' + liveCount + ' API live</strong> + 14 sources demo — Score AI: <strong style="color:var(--green)">82/100</strong>';

    // Count ups
    // Score = NULL (calculated only with all APIs)
    document.getElementById('scoreNum').textContent = '—';
    document.getElementById('scoreNum').style.fontSize = '2rem';
    document.getElementById('scoreNum').style.color = 'var(--text-light)';

    // GSAP animate elements
    gsap.from('.success-check', {scale:0, duration:0.6, ease:'back.out(1.7)', delay:0.1});
    gsap.from('.success-banner h2', {y:20, opacity:0, duration:0.5, delay:0.3});
    gsap.from('.success-banner p', {y:20, opacity:0, duration:0.5, delay:0.4});
    gsap.from('.doc-header', {y:30, opacity:0, duration:0.6, delay:0.5});
    gsap.from('.verdict-bar', {x:-30, opacity:0, duration:0.5, delay:0.7});
    gsap.from('.d-card', {y:20, opacity:0, duration:0.4, stagger:0.06, delay:0.9});
    gsap.from('.check-row', {x:-20, opacity:0, duration:0.3, stagger:0.05, delay:1.2});
    gsap.from('.valeur-card', {scale:0.9, opacity:0, duration:0.5, delay:1.6});
    gsap.from('.recall-card', {y:15, opacity:0, duration:0.3, stagger:0.08, delay:1.4});
    gsap.from('.crash-card', {scale:0.8, opacity:0, duration:0.3, stagger:0.06, delay:1.6});
    gsap.from('.ent-card', {y:15, opacity:0, duration:0.3, stagger:0.06, delay:1.8});
    gsap.from('.download-bar', {y:20, opacity:0, duration:0.5, delay:2.2});
}

// ===== REAL PDF GENERATION =====
async function animDl(){
    const btn = document.getElementById('dlBtn');
    btn.innerHTML = '&#9889; &nbsp;Preparation du PDF...';
    btn.style.opacity = '0.7';
    btn.disabled = true;

    try {
        const reportDoc = document.querySelector('.report-doc');
        // Add pdf-mode class for print-specific styles
        reportDoc.classList.add('pdf-mode');

        // Build filename from vehicle info
        const d = liveData.decode;
        const filename = d
            ? 'AutoVerif_' + (d.make||'').replace(/\s+/g,'') + '_' + (d.model||'').replace(/\s+/g,'') + '_' + (d.year||'') + '_' + currentVin.toUpperCase() + '.pdf'
            : 'AutoVerif_Rapport_' + currentVin.toUpperCase() + '.pdf';

        // Date for header
        const now = new Date();
        const dateStr = now.toLocaleDateString('fr-CA', { year: 'numeric', month: 'long', day: 'numeric' });

        // Temporarily inject PDF watermark footer
        const watermark = document.createElement('div');
        watermark.id = 'pdfWatermark';
        watermark.style.cssText = 'text-align:center;padding:20px 40px;border-top:1px solid rgba(255,255,255,0.06);font-size:0.7rem;color:rgba(136,146,164,0.6);';
        watermark.innerHTML = 'Rapport genere le ' + dateStr + ' par AutoVerif QC — seoparai.com — VIN: ' + currentVin.toUpperCase() + '<br>Ce document est a titre informatif seulement. Il ne constitue pas une garantie sur l\'etat du vehicule.';
        reportDoc.appendChild(watermark);

        const opt = {
            margin: [6, 4, 10, 4],
            filename: filename,
            image: { type: 'jpeg', quality: 0.95 },
            html2canvas: {
                scale: 1.5,
                useCORS: true,
                allowTaint: false,
                backgroundColor: '#ffffff',
                logging: false,
                width: 794,
                windowWidth: 794,
                removeContainer: true
            },
            jsPDF: {
                unit: 'mm',
                format: 'a4',
                orientation: 'portrait',
                compress: true
            },
            pagebreak: {
                mode: ['css', 'legacy'],
                avoid: ['.section-head', '.recall-card', '.d-card', '.check-row', '.crash-card', '.valeur-card', '.citron-box']
            }
        };

        await html2pdf().set(opt).from(reportDoc).save();

        // Cleanup
        reportDoc.classList.remove('pdf-mode');
        const wm = document.getElementById('pdfWatermark');
        if (wm) wm.remove();

        btn.innerHTML = '&#10003; &nbsp;Rapport telecharge!';
        btn.style.background = 'linear-gradient(135deg, var(--green), #1a8a7e)';
        btn.style.opacity = '1';
        setTimeout(()=>{
            btn.innerHTML = '&#128196; &nbsp;Telecharger le rapport PDF';
            btn.style.background = 'linear-gradient(135deg, var(--accent), var(--accent-dark))';
        }, 3000);
    } catch(err) {
        console.error('PDF generation error:', err);
        btn.innerHTML = '&#9888; &nbsp;Erreur — Reessayer';
        btn.style.background = 'linear-gradient(135deg, var(--red), #c0313e)';
        btn.style.opacity = '1';
        // Cleanup on error
        document.querySelector('.report-doc')?.classList.remove('pdf-mode');
        const wm = document.getElementById('pdfWatermark');
        if (wm) wm.remove();
        setTimeout(()=>{
            btn.innerHTML = '&#128196; &nbsp;Telecharger le rapport PDF';
            btn.style.background = 'linear-gradient(135deg, var(--accent), var(--accent-dark))';
        }, 3000);
    } finally {
        btn.disabled = false;
    }
}

// ===== RESET =====
function resetAll(){
    document.getElementById('reportPage').classList.remove('active');
    document.querySelector('.scanner-hero').style.display = 'flex';
    document.querySelectorAll('.step-row').forEach((r,i) => {
        r.classList.remove('active','done');
        r.querySelector('.step-dot').textContent = i+1;
    });
    document.getElementById('progFill').style.width = '0%';
    document.getElementById('loadPct').textContent = '0%';
    window.scrollTo({top:0, behavior:'smooth'});
}
</script>
</body>
</html>
